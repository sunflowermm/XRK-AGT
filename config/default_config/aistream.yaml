# ============================================
# AI工作流配置（全局配置）
# ============================================
# 此配置文件为AI工作流系统配置，不随服务器端口变化

# ----------------------------------------
# 工作流系统开关
# ----------------------------------------
enabled: true

# ----------------------------------------
# 工作流目录路径（相对于项目根目录）
# ----------------------------------------
streamDir: "core/stream"

# ----------------------------------------
# 工作流全局设置
# ----------------------------------------
global:
  # 最大执行超时时间（毫秒）
  maxTimeout: 360000
  
  # 是否启用调试日志
  debug: false
  
  # 并发执行限制
  maxConcurrent: 5

# ----------------------------------------
# 工作流缓存设置
# ----------------------------------------
cache:
  # 是否启用缓存
  enabled: true
  
  # 缓存过期时间（秒）
  ttl: 300
  
  # 最大缓存条数
  maxSize: 100

# ----------------------------------------
# LLM 工厂运营商选择
# ----------------------------------------
# 文本 LLM 配置分别位于 data/server_bots/{port}/god.yaml、volcengine_llm.yaml、xiaomimimo_llm.yaml
llm:
  Provider: gptgod
  # LLM请求超时时间（毫秒），默认360000（6分钟）
  # 如果请求超过此时间，会触发"operation was aborted"错误
  timeout: 360000
  # LLM请求重试配置
  retry:
    # 是否启用重试
    enabled: true
    # 最大重试次数
    maxAttempts: 3
    # 重试延迟（毫秒）
    delay: 2000
    # 重试条件：哪些错误应该重试（timeout/network/5xx/all）
    retryOn: ["timeout", "network", "5xx"]

# ----------------------------------------
# 识图工厂运营商选择
# ----------------------------------------
# 一个工厂一个配置文件：god_vision.yaml、volcengine_vision.yaml
# 注意：工作流不直接调用识图工厂，而是由 LLM 在检测到图片时调用
vision:
  Provider: gptgod

# ----------------------------------------
# ASR 工厂运营商选择
# ----------------------------------------
# 详细配置位于 data/server_bots/{port}/volcengine_asr.yaml
asr:
  Provider: volcengine
  # ASR识别结果调用的工作流名称（工作流内部会自动选择LLM工厂）
  workflow: device

# ----------------------------------------
# TTS 工厂运营商选择
# ----------------------------------------
# 详细配置位于 data/server_bots/{port}/volcengine_tts.yaml
tts:
  Provider: volcengine
  # 是否只有ASR触发才有TTS（false表示所有消息事件都能触发TTS）
  onlyForASR: true

# ----------------------------------------
# Embedding 配置
# ----------------------------------------
# 简化：仅支持本地和远程两种模式
embedding:
  enabled: true
  mode: local  # local: 本地 lightweight 算法 | remote: 远程 API 接口
  # 本地模式配置（lightweight BM25算法，无需额外配置）
  # 远程模式配置（标准 OpenAI 兼容接口）
  remote:
    apiUrl: ""      # API 地址，如 https://api.openai.com/v1/embeddings
    apiKey: ""      # API 密钥
    apiModel: "text-embedding-3-small"  # 模型名称
  # 通用配置
  maxContexts: 5              # 最大上下文条数
  similarityThreshold: 0.6    # 相似度阈值
  cacheExpiry: 86400          # 缓存时长（秒）

# ----------------------------------------
# 设备运行参数
# ----------------------------------------
device:
  heartbeatInterval: 30
  heartbeatTimeout: 180
  commandTimeout: 10000
  maxDevices: 100
  maxLogsPerDevice: 100
  messageQueueSize: 100
  wsPingIntervalMs: 30000
  wsPongTimeoutMs: 10000
  wsReconnectDelayMs: 2000
  wsMaxReconnectAttempts: 5
  enableDetailedLogs: true
  enablePerformanceLogs: true
  audioSaveDir: "./data/wav"

# ----------------------------------------
# 表情映射
# ----------------------------------------
emotions:
  keywords:
    开心: happy
    伤心: sad
    生气: angry
    惊讶: surprise
    爱: love
    酷: cool
    睡觉: sleep
    思考: think
    眨眼: wink
    大笑: laugh
  supported:
    - happy
    - sad
    - angry
    - surprise
    - love
    - cool
    - sleep
    - think
    - wink
    - laugh
