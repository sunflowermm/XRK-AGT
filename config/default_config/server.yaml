# ----------------------------------------
#            基础配置
# ----------------------------------------
server:
  # 服务器名称（将显示在日志中）
  name: "XRK Server"
  
  # 监听地址
  # - 0.0.0.0: 监听所有网络接口（允许外部访问）
  # - 127.0.0.1: 仅监听本地（仅本机可访问）
  host: "0.0.0.0"
  
  # 外部访问URL（可选）
  # 用于生成完整的访问链接，留空则自动检测
  # 示例: https://bot.example.com
  url: "http://127.0.0.1"

# ----------------------------------------
#          反向代理配置（新增）
# ----------------------------------------
proxy:
  # 是否启用反向代理功能
  # 启用后可以实现多域名解析、路径重写、负载均衡等
  enabled: false
  
  # HTTP监听端口（作为反向代理时建议使用80）
  httpPort: 80
  
  # HTTPS监听端口（作为反向代理时建议使用443）
  httpsPort: 443
  
  # 域名配置列表
  # 每个域名可以有不同的配置和处理方式
  # 注意：
  # - 已经通过 CDN 做 HTTPS 的域名：可以只在这里做 HTTP 反向代理，不需要在本机配置证书
  #   这种情况下直接配置 domain/target，省略 ssl 或将 ssl.enabled 设为 false 即可
  domains:
    # 主域名 + 本机证书配置示例（本机同时承担 TLS 终结）
    - domain: "xrkk.cc"
      # 静态文件根目录（可选）
      # 如果不配置，使用默认的www目录
      staticRoot: "./www"
      
      # 是否启用SSL（需要在本机配置证书）
      # 如果该域名已经交给 CDN 做 HTTPS，请删除整个 ssl 段或将 enabled 设为 false
      ssl:
        enabled: false
        # 本机终结 TLS 时才需要配置 certificate
        # certificate:
        #   key: "/path/to/xrkk.cc.key"
        #   cert: "/path/to/xrkk.cc.cert"
        #   ca: ""  # CA证书链（可选）

      # 目标服务器（如果需要代理到其他服务）
      # 不配置则直接提供静态文件服务
      # 例如：仅做静态站，交给 CDN 调用本机 80 端口，则可不配置 target
      # target: "http://localhost:3000"
      
    # 路径重写规则（可选）
    # rewritePath:
    #   from: "/"
    #   to: "/"
    
    # 仅通过 CDN 做 HTTPS、在本机只做 HTTP 反代的示例：
    # - domain: "cdn.example.com"
    #   # 不需要 ssl 段，也不需要证书，CDN 直接回源到本机 httpPort
    #   # 将 /api/* 代理到本机 API 服务
    #   target: "http://localhost:3000"

# ----------------------------------------
#            HTTPS配置
# ----------------------------------------
https:
  # 是否启用HTTPS服务（全局默认证书）
  # 注意：现在每个域名可以有自己的证书
  enabled: false
  
  # 默认SSL证书配置（当域名没有配置专用证书时使用）
  certificate:
    # 私钥文件路径（必需）
    key: "/path/to/default/privkey.pem"
    
    # 证书文件路径（必需）
    cert: "/path/to/default/fullchain.pem"
    
    # CA证书链文件路径（可选）
    # 某些证书可能需要提供完整的证书链
    ca: ""
  
  # TLS配置
  tls:
    # 最低TLS版本（建议不低于TLSv1.2）
    minVersion: "TLSv1.2"
    
    # 是否启用HTTP/2协议（提升性能）
    http2: true
  
  # HSTS（HTTP严格传输安全）配置
  # 警告：启用后所有HTTP请求将强制重定向到HTTPS
  hsts:
    enabled: false
    # 有效期（秒），31536000 = 1年
    maxAge: 31536000
    # 是否包含子域名
    includeSubDomains: true
    # 是否允许预加载（需要提交到浏览器预加载列表）
    preload: false

# ----------------------------------------
#            静态文件服务
# ----------------------------------------
static:
  # 默认首页文件列表
  # 按顺序查找，返回第一个存在的文件
  index:
    - "index.html"
    - "index.htm"
    - "default.html"
  
  # 是否允许自动添加扩展名
  # 例如：/page 会尝试 /page.html
  extensions: false
  
  # 缓存时间设置
  cache:
    # 静态资源缓存时间（秒）
    # 86400 = 1天, 604800 = 7天
    static: 86400     # CSS/JS文件
    images: 604800    # 图片文件
  
  # 缓存总时间（适用于其他文件）
  # 支持格式：1d = 1天, 1h = 1小时
  cacheTime: "1d"

# ----------------------------------------
#            安全配置
# ----------------------------------------
security:
  # Helmet安全头配置
  # 自动添加安全相关的HTTP头部
  helmet:
    enabled: true
  
  # HSTS配置（需要HTTPS启用）
  hsts:
    enabled: false
    maxAge: 31536000
    includeSubDomains: true
    preload: false
  
  # 隐藏文件/目录模式
  # 匹配这些模式的文件将返回404
  # 注意：这些模式不会影响 /api/* 路径
  hiddenFiles:
    - "^\\..*"        # 所有点开头的文件
    - "node_modules"  # Node.js依赖目录
    - "\\.git"        # Git版本控制目录
    - "\\.env"        # 环境变量文件
    - "^/config/"     # 配置目录（仅根路径下的config）
    - "^/private/"    # 私有目录（仅根路径下的private）

# ----------------------------------------
#         跨域资源共享（CORS）
# ----------------------------------------
cors:
  # 是否启用CORS
  enabled: true
  
  # 允许的来源
  # - "*": 允许所有来源（不安全）
  # - 具体域名列表: ["https://example.com", "https://xrkk.cc"]
  origins: ["*"]
  
  # 允许的HTTP方法
  methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  
  # 允许的请求头
  headers: ["Content-Type", "Authorization", "X-API-Key"]
  
  # 是否允许携带凭证（cookies等）
  credentials: false
  
  # 预检请求缓存时间（秒）
  maxAge: 86400

# ----------------------------------------
#            认证配置
# ----------------------------------------
auth:
  # API密钥配置
  apiKey:
    # 是否启用API密钥认证
    enabled: true
    
    # 密钥存储文件路径
    file: "config/server_config/api_key.json"
    
    # 密钥长度（字符数）
    length: 64
  
  # 无需认证的路径（白名单）
  # 这些路径可以直接访问
  whitelist:
    - "/"              # 根目录
    - "/favicon.ico"   # 网站图标
    - "/health"        # 健康检查
    - "/status"        # 状态接口
    - "/robots.txt"    # 爬虫规则
    - "/xrk"           # 葵子的API接口测试页面
    - "/media/*"       # 媒体文件目录
    - "/uploads/*"     # 上传文件目录
    # 注意：静态文件默认允许访问

# ----------------------------------------
#            速率限制
# ----------------------------------------
rateLimit:
  # 是否启用速率限制（防止恶意请求）
  enabled: true
  
  # 全局限制（所有请求）
  global:
    windowMs: 900000  # 时间窗口：15分钟
    max: 1000         # 最大请求数
    message: "请求过于频繁，请稍后再试"
  
  # API接口限制（更严格）
  api:
    windowMs: 60000   # 时间窗口：1分钟
    max: 60           # 最大请求数
    message: "API请求过于频繁"

# ----------------------------------------
#            请求限制
# ----------------------------------------
limits:
  # 各种请求体大小限制
  urlencoded: "10mb"  # URL编码数据
  json: "10mb"        # JSON数据
  raw: "50mb"         # 原始数据
  text: "10mb"        # 文本数据
  fileSize: "100mb"   # 文件上传

# ----------------------------------------
#            压缩配置
# ----------------------------------------
compression:
  # 是否启用响应压缩（减少带宽使用）
  enabled: true
  
  # 压缩级别（0-9）
  # 0: 无压缩（最快）
  # 9: 最大压缩（最慢）
  # 推荐：6（平衡）
  level: 6
  
  # 最小压缩大小（字节）
  # 小于此大小的响应不会被压缩
  threshold: 1024

# ----------------------------------------
#            日志配置
# ----------------------------------------
logging:
  # 是否记录请求日志
  requests: true
  
  # 是否记录错误日志
  errors: true
  
  # 是否启用调试日志（详细）
  debug: false
  
  # 静默路径列表
  # 这些路径的请求不会记录日志（避免刷屏）
  quiet:
    - "/health"
    - "/favicon.ico"
    - "/robots.txt"

# ----------------------------------------
#            其他配置
# ----------------------------------------
misc:
  # 是否自动检测公网IP
  # 用于显示外网访问地址
  detectPublicIP: true
  
  # 404时的默认重定向路径
  defaultRoute: "/"