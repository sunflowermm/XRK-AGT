## XRK-AGT v1.0.0

XRK-AGT æ˜¯å‘æ—¥è‘µå·¥ä½œå®¤åŸºäº Node.js æ‰“é€ çš„ **å¤šå¹³å°ã€å¤šé€‚é…å™¨ã€å·¥ä½œæµé©±åŠ¨å‹æ™ºèƒ½ä½“å¹³å°**ï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒï¼š

- **å¤šå¹³å°æ¶ˆæ¯æ¥å…¥**ï¼šOneBotv11 / ComWeChat / è‡ªå®šä¹‰ Tasker
- **æ’ä»¶å·¥ä½œæµ**ï¼šæŒ‡ä»¤æ’ä»¶ + AI å·¥ä½œæµ (`AIStream`)
- **Web ä¸ HTTP/API æœåŠ¡**ï¼šå†…ç½® Web æ§åˆ¶å° + REST API + WebSocket
- **æ¸²æŸ“ä¸æˆªå›¾**ï¼šåŸºäº Puppeteer / Playwright çš„é¡µé¢æ¸²æŸ“ä¸å›¾ç‰‡è¾“å‡º

**å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦æœ¬é¡¹ç›®ï¼š**

- ä»…æƒ³**å…ˆè·‘èµ·æ¥**ï¼šç›´æ¥çœ‹ä¸‹é¢çš„ã€Œå¿«é€Ÿå¼€å§‹ã€
- æƒ³**äº†è§£æ•´ä½“æ¶æ„**ï¼šå…ˆçœ‹ã€Œæ¶æ„å±‚æ¬¡è¯´æ˜ã€å’Œ [`PROJECT_OVERVIEW.md`](PROJECT_OVERVIEW.md)
- æƒ³**åšäºŒæ¬¡å¼€å‘/å†™æ’ä»¶**ï¼šé˜…è¯» [`docs/å®Œæ•´æ–‡æ¡£.md`](docs/å®Œæ•´æ–‡æ¡£.md) - æ•´åˆäº†æ‰€æœ‰æ ¸å¿ƒæ–‡æ¡£

---

## æ¶æ„å±‚æ¬¡è¯´æ˜

XRK-AGT é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œå„å±‚èŒè´£æ˜ç¡®ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ï¼š

### ğŸ—ï¸ æ¶æ„å±‚æ¬¡å›¾

```mermaid
flowchart TB
    subgraph Clients["å¤–éƒ¨å®¢æˆ·ç«¯"]
      QQ["QQ / OneBotv11"]
      WeChat["ComWeChat"]
      WebUI["XRK Web æ§åˆ¶å°"]
      ThirdAPI["ç¬¬ä¸‰æ–¹ API è°ƒç”¨"]
    end

    subgraph Runtime["è¿è¡Œæ ¸å¿ƒå±‚"]
      Bot["Bot ä¸»ç±»<br/>src/bot.js<br/>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç»„ä»¶"]
    end

    subgraph Infrastructure["åŸºç¡€è®¾æ–½å±‚ï¼ˆè¾…åŠ©å±‚ï¼‰<br/>src/infrastructure/"]
      TaskerLoader["TaskerLoader<br/>ä»»åŠ¡å±‚åŠ è½½å™¨"]
      PluginsLoader["PluginsLoader<br/>æ’ä»¶åŠ è½½ä¸è°ƒåº¦"]
      ApiLoader["ApiLoader<br/>API åŠ è½½å™¨"]
      StreamLoader["StreamLoader<br/>å·¥ä½œæµåŠ è½½å™¨"]
      ListenerLoader["ListenerLoader<br/>äº‹ä»¶ç›‘å¬å™¨åŠ è½½å™¨"]
      BaseClasses["åŸºç±»åº“<br/>plugin/HttpApi/AIStream<br/>Renderer/ConfigBase/EventListener"]
    end

    subgraph Tasker["ä»»åŠ¡å±‚ï¼ˆTaskerï¼‰<br/>core/tasker/"]
      OneBotTasker["OneBotv11 Tasker"]
      ComWeChatTasker["ComWeChat Tasker"]
      StdinTasker["stdin Tasker"]
      CustomTasker["è‡ªå®šä¹‰ Tasker"]
    end

    subgraph EventSystem["äº‹ä»¶ç³»ç»Ÿ<br/>core/events/"]
      OneBotEvent["OneBot äº‹ä»¶ç›‘å¬å™¨"]
      DeviceEvent["Device äº‹ä»¶ç›‘å¬å™¨"]
      StdinEvent["Stdin äº‹ä»¶ç›‘å¬å™¨"]
    end

    subgraph Business["ä¸šåŠ¡å±‚<br/>core/"]
      Plugins["ä¸šåŠ¡æ’ä»¶<br/>core/plugin/"]
      HttpApis["HTTP API<br/>core/http/"]
      Streams["å·¥ä½œæµ<br/>core/stream/"]
    end

    Clients -->|åè®®è½¬æ¢| Tasker
    Tasker -->|Bot.em è§¦å‘äº‹ä»¶| EventSystem
    EventSystem -->|å»é‡/æ ‡è®°/é¢„å¤„ç†| PluginsLoader
    PluginsLoader -->|è§„åˆ™åŒ¹é…| Plugins
    
    WebUI -->|HTTP/WS| Bot
    ThirdAPI -->|HTTP/WS| Bot
    Bot --> ApiLoader
    ApiLoader --> HttpApis
    
    Plugins --> BaseClasses
    HttpApis --> BaseClasses
    Streams --> BaseClasses
    
    Bot --> Infrastructure
    Infrastructure --> Tasker
    Infrastructure --> EventSystem
    Infrastructure --> Business
```

### ğŸ“‹ å„å±‚èŒè´£è¯´æ˜

#### 1. **è¿è¡Œæ ¸å¿ƒå±‚** (`src/bot.js`)
- **èŒè´£**ï¼šç»Ÿä¸€ç®¡ç† HTTP/HTTPS/WebSocket æœåŠ¡ã€ä¸­é—´ä»¶ã€è®¤è¯ã€åå‘ä»£ç†ã€äº‹ä»¶æ€»çº¿ (`Bot.em`)
- **ç‰¹ç‚¹**ï¼šç³»ç»Ÿå…¥å£ï¼Œåè°ƒæ‰€æœ‰ç»„ä»¶

#### 2. **åŸºç¡€è®¾æ–½å±‚ï¼ˆè¾…åŠ©å±‚ï¼‰** (`src/infrastructure/`)
- **èŒè´£**ï¼šæä¾›æ‰€æœ‰åŸºç¡€è®¾æ–½å’ŒåŸºç±»ï¼Œä¸ºä¸šåŠ¡å±‚æä¾›é€šç”¨èƒ½åŠ›
- **åŒ…å«**ï¼š
  - **åŠ è½½å™¨**ï¼š`TaskerLoader`ã€`PluginsLoader`ã€`ApiLoader`ã€`StreamLoader`ã€`ListenerLoader`
  - **åŸºç±»åº“**ï¼š`plugin`ï¼ˆæ’ä»¶åŸºç±»ï¼‰ã€`HttpApi`ï¼ˆAPI åŸºç±»ï¼‰ã€`AIStream`ï¼ˆå·¥ä½œæµåŸºç±»ï¼‰ã€`Renderer`ï¼ˆæ¸²æŸ“å™¨åŸºç±»ï¼‰ã€`ConfigBase`ï¼ˆé…ç½®åŸºç±»ï¼‰ã€`EventListener`ï¼ˆäº‹ä»¶ç›‘å¬å™¨åŸºç±»ï¼‰
  - **æ•°æ®åº“å®¢æˆ·ç«¯**ï¼š`redis.js`ã€`mongodb.js`
  - **é…ç½®ç®¡ç†**ï¼š`config/`ã€`commonconfig/`
- **ç‰¹ç‚¹**ï¼šä¸åŒ…å«å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼Œåªæä¾›æŠ½è±¡å’Œå·¥å…·

#### 3. **ä»»åŠ¡å±‚ï¼ˆTaskerï¼‰** (`core/tasker/`)
- **èŒè´£**ï¼šå¯¹æ¥å„å¹³å°åè®®ï¼ˆQQ/å¾®ä¿¡/è‡ªå®šä¹‰ï¼‰ï¼Œå°†å¹³å°æ¶ˆæ¯è½¬æ¢ä¸ºç»Ÿä¸€äº‹ä»¶æ¨¡å‹ï¼Œé€šè¿‡ `Bot.em` è§¦å‘äº‹ä»¶
- **åŒ…å«**ï¼š`OneBotv11.js`ã€`ComWeChat.js`ã€`stdin.js` ç­‰
- **ç‰¹ç‚¹**ï¼šäº‹ä»¶ç”Ÿæˆå™¨ï¼Œè´Ÿè´£åè®®è½¬æ¢

#### 4. **äº‹ä»¶ç³»ç»Ÿ** (`core/events/`)
- **èŒè´£**ï¼šç›‘å¬ `Bot.em` äº‹ä»¶ï¼Œè¿›è¡Œå»é‡ã€æ ‡è®°ã€é¢„å¤„ç†ï¼Œç„¶åè°ƒç”¨ `PluginsLoader.deal(e)` åˆ†å‘åˆ°æ’ä»¶
- **åŒ…å«**ï¼š`onebot.js`ã€`device.js`ã€`stdin.js` ç­‰äº‹ä»¶ç›‘å¬å™¨
- **ç‰¹ç‚¹**ï¼šäº‹ä»¶æ ‡å‡†åŒ–å’Œé¢„å¤„ç†å±‚

#### 5. **ä¸šåŠ¡å±‚** (`core/`)
- **èŒè´£**ï¼šå®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘
- **åŒ…å«**ï¼š
  - **ä¸šåŠ¡æ’ä»¶** (`core/plugin/`)ï¼šåŒ…æ‹¬ `enhancer/`ï¼ˆå¢å¼ºæ’ä»¶ï¼‰å’Œ `example/`ï¼ˆç¤ºä¾‹æ’ä»¶ï¼‰
  - **HTTP API** (`core/http/`)ï¼šå…·ä½“çš„ REST/WebSocket API å®ç°
  - **å·¥ä½œæµ** (`core/stream/`)ï¼šåŸºäº `AIStream` çš„ä¸šåŠ¡å·¥ä½œæµå®ç°
- **ç‰¹ç‚¹**ï¼šåŸºäºåŸºç¡€è®¾æ–½å±‚çš„åŸºç±»å®ç°å…·ä½“åŠŸèƒ½

---

## æ¶æ„æ€»è§ˆå›¾ï¼ˆæ ¸å¿ƒç»„ä»¶å…³ç³»ï¼‰

```mermaid
flowchart LR
    subgraph Clients["å¤–éƒ¨å®¢æˆ·ç«¯"]
      QQ["QQ / OneBotv11"] -->|WS| Taskers
      WeChat["ComWeChat ç­‰"] -->|WS/HTTP| Taskers
      WebUI["XRK Web æ§åˆ¶å°"] -->|HTTP/WS| Express
      ThirdAPI["ç¬¬ä¸‰æ–¹è°ƒç”¨æ–¹"] -->|HTTP/WS| Express
    end

    subgraph Core["XRK-AGT æ ¸å¿ƒ"]
      Taskers["ä»»åŠ¡å±‚<br/>core/tasker"] -->|Bot.em äº‹ä»¶| EventSystem
      EventSystem["äº‹ä»¶ç³»ç»Ÿ<br/>core/events"] -->|å»é‡/æ ‡è®°| PluginsLoader
      Express["HTTP/HTTPS/WS æœåŠ¡<br/>src/bot.js"] --> ApiLoader
      ApiLoader["API åŠ è½½å™¨<br/>src/infrastructure/http"] --> HttpApis
      PluginsLoader["æ’ä»¶åŠ è½½å™¨<br/>src/infrastructure/plugins"] --> Plugins["ä¸šåŠ¡æ’ä»¶<br/>core/plugin"]
      Plugins --> AIStream["AI å·¥ä½œæµåŸºç±»<br/>src/infrastructure/aistream"]
      Plugins --> Renderer["æ¸²æŸ“å™¨åŸºç±»<br/>src/infrastructure/renderer"]
      Plugins --> Config["é…ç½®ç³»ç»Ÿ<br/>src/infrastructure/commonconfig"]
      Plugins --> Redis[("Redis")]
      Plugins --> MongoDB[("MongoDB")]
      HttpApis["HTTP API<br/>core/http"] --> AIStream
      HttpApis --> Renderer
      HttpApis --> Config
    end
```

---

## æ¨¡å—ä¸€è§ˆè¡¨ï¼ˆæŒ‰å±‚æ¬¡åˆ†ç±»ï¼‰

### è¿è¡Œæ ¸å¿ƒå±‚

| æ¨¡å— | ä¸»è¦æ–‡ä»¶/ç›®å½• | èŒè´£æ¦‚è¿° |
|------|---------------|----------|
| Bot ä¸»ç±» | `src/bot.js` | ç®¡ç† HTTP/HTTPS/WS æœåŠ¡ã€ä¸­é—´ä»¶ã€è®¤è¯ã€åå‘ä»£ç†ã€äº‹ä»¶æ€»çº¿ (`Bot.em`) åŠèµ„æºæ¸…ç† |

### åŸºç¡€è®¾æ–½å±‚ï¼ˆè¾…åŠ©å±‚ï¼‰

| æ¨¡å— | ä¸»è¦æ–‡ä»¶/ç›®å½• | èŒè´£æ¦‚è¿° |
|------|---------------|----------|
| Tasker åŠ è½½å™¨ | `src/infrastructure/tasker/loader.js` | æ‰«æå¹¶åŠ è½½ `core/tasker/` ä¸­çš„ Tasker |
| æ’ä»¶ç³»ç»ŸåŸºç¡€è®¾æ–½ | `src/infrastructure/plugins/` | æ’ä»¶åŸºç±» `plugin`ã€æ’ä»¶åŠ è½½å™¨ `PluginsLoader`ã€è¿è¡Œæ—¶ç®¡ç† |
| äº‹ä»¶ç›‘å¬å™¨åŸºç¡€è®¾æ–½ | `src/infrastructure/listener/` | äº‹ä»¶ç›‘å¬å™¨åŸºç±» `EventListener` å’ŒåŠ è½½å™¨ |
| HTTP/API åŸºç¡€è®¾æ–½ | `src/infrastructure/http/` | HTTP API åŸºç±» `HttpApi` å’Œ `ApiLoader` |
| AI å·¥ä½œæµåŸºç¡€è®¾æ–½ | `src/infrastructure/aistream/` | AI å·¥ä½œæµåŸºç±» `AIStream` å’ŒåŠ è½½å™¨ |
| æ¸²æŸ“å™¨åŸºç¡€è®¾æ–½ | `src/infrastructure/renderer/` | æ¸²æŸ“å™¨åŸºç±» `Renderer` å’ŒåŠ è½½å™¨ |
| é…ç½®ç³»ç»ŸåŸºç¡€è®¾æ–½ | `src/infrastructure/commonconfig/` | é…ç½®åŸºç±» `ConfigBase` å’Œé€šç”¨é…ç½®å°è£… |
| é…ç½®åŠ è½½å™¨ | `src/infrastructure/config/` | æœåŠ¡ç«¯é…ç½®ç®¡ç†ï¼ˆç«¯å£ã€HTTPSã€CORS ç­‰ï¼‰ |
| æ•°æ®åº“å®¢æˆ·ç«¯ | `src/infrastructure/redis.js`ã€`src/infrastructure/mongodb.js` | Redis å’Œ MongoDB å®¢æˆ·ç«¯å°è£… |

### ä»»åŠ¡å±‚ï¼ˆTaskerï¼‰

| æ¨¡å— | ä¸»è¦æ–‡ä»¶/ç›®å½• | èŒè´£æ¦‚è¿° |
|------|---------------|----------|
| ä»»åŠ¡å±‚ | `core/tasker/` | å¯¹æ¥å„å¹³å°åè®®ï¼Œå°†å¹³å°æ¶ˆæ¯è½¬æ¢ä¸ºç»Ÿä¸€äº‹ä»¶æ¨¡å‹ï¼Œé€šè¿‡ `Bot.em` è§¦å‘äº‹ä»¶ |

### äº‹ä»¶ç³»ç»Ÿ

| æ¨¡å— | ä¸»è¦æ–‡ä»¶/ç›®å½• | èŒè´£æ¦‚è¿° |
|------|---------------|----------|
| äº‹ä»¶ç›‘å¬å™¨ | `core/events/` | ç›‘å¬ `Bot.em` äº‹ä»¶ï¼Œè¿›è¡Œå»é‡ã€æ ‡è®°ã€é¢„å¤„ç†ï¼Œè°ƒç”¨ `PluginsLoader.deal(e)` |

### ä¸šåŠ¡å±‚

| æ¨¡å— | ä¸»è¦æ–‡ä»¶/ç›®å½• | èŒè´£æ¦‚è¿° |
|------|---------------|----------|
| ä¸šåŠ¡æ’ä»¶ | `core/plugin/` | å…·ä½“ä¸šåŠ¡æ’ä»¶å®ç°ï¼ˆåŒ…æ‹¬ `enhancer/` å¢å¼ºæ’ä»¶å’Œ `example/` ç¤ºä¾‹æ’ä»¶ï¼‰ |
| HTTP API | `core/http/` | å…·ä½“çš„ REST/WebSocket API å®ç° |
| å·¥ä½œæµ | `core/stream/` | åŸºäº `AIStream` çš„ä¸šåŠ¡å·¥ä½œæµå®ç° |

### å·¥å…·ä¸è¾…åŠ©

| æ¨¡å— | ä¸»è¦æ–‡ä»¶/ç›®å½• | èŒè´£æ¦‚è¿° |
|------|---------------|----------|
| å·¥å…·ç±» | `src/utils/botutil.js`ã€`src/utils/paths.js` | å°è£…é€šç”¨å·¥å…·æ–¹æ³•ä¸è·¯å¾„ç®¡ç† |
| æ¸²æŸ“å®ç° | `src/renderers/` | åŸºäº Puppeteer/Playwright çš„æ¸²æŸ“å®ç° |
| å·¥å‚ç±» | `src/factory/` | ASR/TTS/LLM å·¥å‚ç±» |

å„æ¨¡å—å¯¹åº”çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è§ [`docs/README.md`](docs/README.md) ä¸­çš„æ¨¡å—æ–‡æ¡£ç´¢å¼•ã€‚

---

## é¡¹ç›®ç»“æ„æ€»è§ˆï¼ˆç›®å½• & ä½œç”¨ï¼‰

> æ›´è¯¦ç»†çš„é€ç›®å½•è§£æï¼Œå¯å‚è€ƒ [`PROJECT_OVERVIEW.md`](PROJECT_OVERVIEW.md)ï¼›è¿™é‡Œç»™å‡ºç²¾ç®€ä½†å®Œæ•´çš„ä¸€çœ¼æ€»è§ˆã€‚

```text
XRK-AGT/
â”œâ”€ app.js / start.js          # å¯åŠ¨å¼•å¯¼ä¸ä¸»å…¥å£
â”œâ”€ package.json               # é¡¹ç›®ä¾èµ–ä¸è„šæœ¬
â”œâ”€ README.md                  # æ ¹ READMEï¼ˆå½“å‰æ–‡ä»¶ï¼‰
â”œâ”€ PROJECT_OVERVIEW.md        # æ¶æ„ & ç›®å½•è¯¦ç»†è¯´æ˜
â”œâ”€ docs/                      # æ¨¡å—æ–‡æ¡£ï¼ˆBot/æ’ä»¶/Tasker/äº‹ä»¶/API/AI/é…ç½®/æ¸²æŸ“/å·¥å…·ç­‰ï¼‰
â”‚
â”œâ”€ src/                       # è¿è¡Œæ ¸å¿ƒä¸åŸºç¡€è®¾æ–½
â”‚  â”œâ”€ bot.js                  # Bot ä¸»ç±»ï¼ˆè¿è¡Œæ ¸å¿ƒå±‚ï¼‰
â”‚  â”œâ”€ infrastructure/         # åŸºç¡€è®¾æ–½å±‚ï¼ˆè¾…åŠ©å±‚ï¼‰
â”‚  â”‚  â”œâ”€ tasker/loader.js    # TaskerLoaderï¼ŒåŠ è½½ core/tasker Tasker
â”‚  â”‚  â”œâ”€ plugins/             # æ’ä»¶ç³»ç»ŸåŸºç¡€è®¾æ–½ï¼ˆplugin åŸºç±»ã€PluginsLoaderï¼‰
â”‚  â”‚  â”œâ”€ listener/            # äº‹ä»¶ç›‘å¬å™¨åŸºç¡€è®¾æ–½ï¼ˆEventListener åŸºç±»ã€ListenerLoaderï¼‰
â”‚  â”‚  â”œâ”€ http/                # HTTP API åŸºç¡€è®¾æ–½ï¼ˆHttpApi åŸºç±»ã€ApiLoaderï¼‰
â”‚  â”‚  â”œâ”€ aistream/            # AI å·¥ä½œæµåŸºç¡€è®¾æ–½ï¼ˆAIStream åŸºç±»ã€StreamLoaderï¼‰
â”‚  â”‚  â”œâ”€ renderer/            # æ¸²æŸ“å™¨åŸºç¡€è®¾æ–½ï¼ˆRenderer åŸºç±»ã€RendererLoaderï¼‰
â”‚  â”‚  â”œâ”€ commonconfig/        # é…ç½®ç³»ç»ŸåŸºç¡€è®¾æ–½ï¼ˆConfigBase åŸºç±»ï¼‰
â”‚  â”‚  â”œâ”€ config/              # é…ç½®åŠ è½½å™¨ï¼ˆæœåŠ¡ç«¯é…ç½®ç®¡ç†ï¼‰
â”‚  â”‚  â”œâ”€ redis.js             # Redis å®¢æˆ·ç«¯å°è£…
â”‚  â”‚  â””â”€ mongodb.js           # MongoDB å®¢æˆ·ç«¯å°è£…
â”‚  â”œâ”€ factory/                # å·¥å‚ç±»ï¼ˆASR/TTS/LLMï¼‰
â”‚  â”œâ”€ modules/                # ä¸šåŠ¡æ¨¡å—ï¼ˆoicq/ç³»ç»Ÿç›‘æ§ç­‰ï¼‰
â”‚  â”œâ”€ renderers/              # æ¸²æŸ“å®ç°ï¼ˆpuppeteer/playwrightï¼‰
â”‚  â””â”€ utils/                  # å·¥å…·å‡½æ•°ï¼ˆpaths/botutil ç­‰ï¼‰
â”‚
â”œâ”€ core/                      # ä¸šåŠ¡å±‚ä¸ä»»åŠ¡å±‚
â”‚  â”œâ”€ tasker/                 # ä»»åŠ¡å±‚ï¼ˆTaskerï¼‰- å„å¹³å°é€‚é…å™¨
â”‚  â”‚  â”œâ”€ OneBotv11.js         # OneBotv11 Tasker
â”‚  â”‚  â”œâ”€ ComWeChat.js         # ComWeChat Tasker
â”‚  â”‚  â”œâ”€ stdin.js             # stdin Tasker
â”‚  â”‚  â””â”€ ...                  # å…¶ä»– Tasker
â”‚  â”œâ”€ events/                 # äº‹ä»¶ç³»ç»Ÿ - äº‹ä»¶ç›‘å¬å™¨
â”‚  â”‚  â”œâ”€ onebot.js            # OneBot äº‹ä»¶ç›‘å¬å™¨
â”‚  â”‚  â”œâ”€ device.js            # Device äº‹ä»¶ç›‘å¬å™¨
â”‚  â”‚  â””â”€ stdin.js             # Stdin äº‹ä»¶ç›‘å¬å™¨
â”‚  â”œâ”€ plugin/                 # ä¸šåŠ¡å±‚ - ä¸šåŠ¡æ’ä»¶
â”‚  â”‚  â”œâ”€ enhancer/            # å¢å¼ºæ’ä»¶ï¼ˆTasker ç‰¹å®šåŠŸèƒ½å¢å¼ºï¼‰
â”‚  â”‚  â””â”€ example/             # ç¤ºä¾‹æ’ä»¶
â”‚  â”œâ”€ http/                   # ä¸šåŠ¡å±‚ - HTTP API
â”‚  â”‚  â”œâ”€ ai.js                # AI ç›¸å…³ API
â”‚  â”‚  â”œâ”€ bot.js               # Bot ç›¸å…³ API
â”‚  â”‚  â”œâ”€ config.js            # é…ç½®ç›¸å…³ API
â”‚  â”‚  â””â”€ ...                  # å…¶ä»– API
â”‚  â””â”€ stream/                 # ä¸šåŠ¡å±‚ - å·¥ä½œæµ
â”‚     â”œâ”€ chat.js              # èŠå¤©å·¥ä½œæµ
â”‚     â””â”€ device.js            # è®¾å¤‡å·¥ä½œæµ
â”‚
â”œâ”€ config/                    # é»˜è®¤é…ç½®ã€å‘½ä»¤è¡Œå·¥å…·é…ç½®
â”‚  â”œâ”€ default_config/         # bot/server/redis/mongodb/device/renderer ç­‰é»˜è®¤ YAML
â”‚  â””â”€ cmd/                    # å‘½ä»¤è¡Œå·¥å…·å®šä¹‰
â”‚
â”œâ”€ data/                      # è¿è¡ŒæœŸæ•°æ® & æœåŠ¡å™¨é…ç½®
â”‚  â”œâ”€ bots/                   # å„è´¦å·è¿è¡Œæ—¶æ•°æ®ï¼ˆicqq ç­‰ï¼‰
â”‚  â”œâ”€ server_bots/            # æŒ‰ç«¯å£æ‹†åˆ†çš„æœåŠ¡å™¨ YAML é…ç½®
â”‚  â”œâ”€ backups/                # å¤‡ä»½æ–‡ä»¶
â”‚  â””â”€ importsJson/            # åŠ¨æ€ imports é…ç½®ç‰‡æ®µ
â”‚
â”œâ”€ www/                       # å‰ç«¯é™æ€èµ„æºæ ¹ç›®å½•
â”‚  â””â”€ xrk/                    # XRK Web æ§åˆ¶å°ï¼ˆindex.html + app.js + stylesï¼‰
â”‚
â”œâ”€ resources/                 # æ¸²æŸ“æ¨¡æ¿ä¸é™æ€èµ„æºï¼ˆå­—ä½“/HTML æ¨¡æ¿/å›¾ç‰‡ç­‰ï¼‰
â”œâ”€ temp/                      # è¿è¡Œä¸­ç”Ÿæˆçš„ HTML/å›¾ç‰‡ç­‰ä¸´æ—¶æ–‡ä»¶
â””â”€ trash/                     # Bot å®šæœŸæ¸…ç†çš„å›æ”¶ç«™ç›®å½•
```

### å±‚æ¬¡å…³ç³»è¯´æ˜

- **è¿è¡Œæ ¸å¿ƒå±‚** (`src/bot.js`)ï¼šç³»ç»Ÿå…¥å£ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç»„ä»¶
- **åŸºç¡€è®¾æ–½å±‚** (`src/infrastructure/`)ï¼šæä¾›åŸºç±»å’ŒåŠ è½½å™¨ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- **ä»»åŠ¡å±‚** (`core/tasker/`)ï¼šåè®®è½¬æ¢ï¼Œç”Ÿæˆç»Ÿä¸€äº‹ä»¶
- **äº‹ä»¶ç³»ç»Ÿ** (`core/events/`)ï¼šäº‹ä»¶æ ‡å‡†åŒ–å’Œé¢„å¤„ç†
- **ä¸šåŠ¡å±‚** (`core/plugin/`ã€`core/http/`ã€`core/stream/`)ï¼šå…·ä½“ä¸šåŠ¡å®ç°

è‹¥ä½ æƒ³ **æ”¹é€ åº•å±‚** æˆ– **åšäºŒæ¬¡å¼€å‘**ï¼Œæ¨èé¡ºåºæ˜¯ï¼š

1. å¿«é€Ÿæ‰«ä¸€éä¸Šé¢çš„ç»“æ„æ ‘ï¼Œäº†è§£ç›®å½•å¸ƒå±€
2. é˜…è¯»ã€Œæ¶æ„å±‚æ¬¡è¯´æ˜ã€ç†è§£å„å±‚èŒè´£
3. é˜…è¯» [`PROJECT_OVERVIEW.md`](PROJECT_OVERVIEW.md) ä¸­çš„è¯¦ç»†ç›®å½•è§£æ
4. å†è¿›å…¥ [`docs/README.md`](docs/README.md) ä¸å¯¹åº”æ¨¡å—æ–‡æ¡£æ·±å…¥å…·ä½“åŸºç±»å’Œå¯¹è±¡

---

## ä½¿ç”¨æ–¹æ³•æ¦‚è§ˆï¼ˆä½ èƒ½æ‹¿å®ƒå¹²ä»€ä¹ˆï¼‰

### åŸºç¡€è¿è¡Œç¯å¢ƒ

- Windows / Linux + Chrome / Chromium / Edgeï¼ˆç”¨äºæ¸²æŸ“åŠŸèƒ½ï¼‰
- Node.js â‰¥ **18.14.0**
- Redis â‰¥ **5.0.0**
- MongoDB â‰¥ **4.0.0**ï¼ˆå¯é€‰ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨ï¼‰

### å…¸å‹ä½¿ç”¨åœºæ™¯

- æ­å»º QQ æ™ºèƒ½ä½“ï¼ˆèŠå¤©æœºå™¨äººã€ä»»åŠ¡åŠ©æ‰‹ã€æ•°æ®ç›‘æ§ç­‰ï¼‰
- åœ¨å†œä¸šç­‰å‚ç›´åœºæ™¯ä¸­è½åœ°ã€Œä»»åŠ¡æµ + AI + æ¸²æŸ“ã€çš„è‡ªåŠ¨åŒ–å·¥ä½œæµ
- ä½œä¸ºä¸€ä¸ªå¯æ‰©å±•çš„ Bot å¹³å°ï¼Œå¯¹æ¥è‡ªå®šä¹‰ API ä¸å‰ç«¯æ§åˆ¶å°

è¯¦ç»†æ¶æ„ä¸å¯¹è±¡è¯´æ˜è¯·å‚è§ï¼š

- **é¡¹ç›®ä¸»æ–‡æ¡£**ï¼š[`PROJECT_OVERVIEW.md`](PROJECT_OVERVIEW.md)
- **å®Œæ•´æ–‡æ¡£**ï¼š[`docs/å®Œæ•´æ–‡æ¡£.md`](docs/å®Œæ•´æ–‡æ¡£.md) - æ•´åˆäº†æ‰€æœ‰æ ¸å¿ƒæ–‡æ¡£å’Œ API å‚è€ƒ

---

## å¿«é€Ÿå¼€å§‹ï¼ˆ5 åˆ†é’Ÿè·‘èµ·æ¥ï¼‰

### å…‹éš†é¡¹ç›®

```sh
# ä½¿ç”¨ Github
git clone --depth=1 https://github.com/sunflowermm/XRK-AGT.git
# ä½¿ç”¨ Gitcode
git clone --depth=1 https://gitcode.com/Xrkseek/XRK-AGT.git
cd XRK-AGT
```

### å®‰è£…ä¾èµ–

> å¤–ç½‘ç¯å¢ƒå¯å…ˆæ ¹æ®éœ€è¦è°ƒæ•´æœ¬åœ° `.npmrc`ï¼ˆå¦‚åˆ‡æ¢ä¸ºå®˜æ–¹æºï¼‰ï¼Œå†å®‰è£…ä¾èµ–ã€‚  

```sh
# æ¨èï¼špnpmï¼Œä¸”ä»…æ”¯æŒpnpm
pnpm install
```

### è¿è¡Œä¸ç™»å½•

> é¦–æ¬¡è¿è¡ŒæŒ‰ç»ˆç«¯æç¤ºå®Œæˆç™»å½•ã€‚  
> æ”¯æŒå¤šå¼€çª—å£ç™»å½•ï¼Œæ¨¡ä»¿ QQ å®¢æˆ·ç«¯çš„å¤šå®ä¾‹å¤„ç†æ–¹å¼ï¼Œä¿è¯å¤š Bot å›å¤çš„å…¼å®¹æ€§ã€‚   
> æœåŠ¡å™¨ç™»å½•ç›¸å…³æ’ä»¶é…ç½®ä½äº `config/server_config/`ï¼Œä¾¿äºè¿ç§»ã€‚

å¯åŠ¨è„šæœ¬ï¼š

```sh
node app   # æˆ– node start.js
```

å¯åŠ¨åå¯é€šè¿‡æµè§ˆå™¨è®¿é—®é…ç½®ä¸­çš„æœåŠ¡åœ°å€ï¼ˆé»˜è®¤ 2537 ç«¯å£ï¼‰ï¼Œå…·ä½“è®¿é—® URL ä¼šåœ¨å¯åŠ¨æ—¥å¿—ä¸­æ‰“å°ã€‚

---

## æ ¸å¿ƒç‰¹æ€§ï¼ˆä¸ºä»€ä¹ˆé€‰ XRK-AGTï¼‰

### åˆ†å±‚æ¶æ„è®¾è®¡

- **æ¸…æ™°çš„å±‚æ¬¡åˆ’åˆ†**ï¼šè¿è¡Œæ ¸å¿ƒå±‚ã€åŸºç¡€è®¾æ–½å±‚ã€ä»»åŠ¡å±‚ã€äº‹ä»¶ç³»ç»Ÿã€ä¸šåŠ¡å±‚èŒè´£æ˜ç¡®
- **åŸºç¡€è®¾æ–½ä¸ä¸šåŠ¡åˆ†ç¦»**ï¼šåŸºç¡€è®¾æ–½å±‚æä¾›é€šç”¨èƒ½åŠ›ï¼Œä¸šåŠ¡å±‚ä¸“æ³¨å…·ä½“å®ç°
- **æ˜“äºæ‰©å±•**ï¼šåŸºäºåŸºç±»è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°çš„ Taskerã€æ’ä»¶ã€API å’Œå·¥ä½œæµ

### æ¨¡å—åŒ–æ¶æ„

- **è¿è¡Œæ ¸å¿ƒ** (`src/bot.js`)ï¼šç»Ÿä¸€ç®¡ç† HTTP/HTTPS/WebSocketã€åå‘ä»£ç†ã€ä¸­é—´ä»¶ä¸è®¤è¯
- **ä»»åŠ¡å±‚** (`core/tasker/`)ï¼šäº‹ä»¶ç”Ÿæˆå™¨ï¼Œå°†å„å¹³å°åè®®è½¬æ¢ä¸ºç»Ÿä¸€äº‹ä»¶æ¨¡å‹
- **äº‹ä»¶ç³»ç»Ÿ** (`core/events/`)ï¼šäº‹ä»¶æ ‡å‡†åŒ–ã€å»é‡ã€æ ‡è®°å’Œé¢„å¤„ç†
- **æ’ä»¶ç³»ç»Ÿ** (`src/infrastructure/plugins/` + `core/plugin/`)ï¼šæ’ä»¶åŠ è½½ä¸äº‹ä»¶è°ƒåº¦æ ¸å¿ƒ
- **AI å·¥ä½œæµ** (`src/infrastructure/aistream/` + `core/stream/`)ï¼šAI å·¥ä½œæµæŠ½è±¡å±‚ä¸ä¸šåŠ¡å®ç°
- **HTTP/API** (`src/infrastructure/http/` + `core/http/`)ï¼šAPI æ¨¡å—ä¸åŠ è½½å™¨

### æ’ä»¶ä¸å·¥ä½œæµ

- å…¼å®¹ Yunzai é£æ ¼æ’ä»¶å¼€å‘ä½“éªŒï¼ˆè§„åˆ™åŒ¹é…ã€æƒé™æ§åˆ¶ã€ä¸Šä¸‹æ–‡ç®¡ç†ï¼‰
- å†…å»ºå·¥ä½œæµåŸºç±» `AIStream`ï¼Œæ”¯æŒå¤šç§ Embedding ä¸å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰
- æ”¯æŒå¢å¼ºæ’ä»¶ï¼ˆEnhancerï¼‰ï¼Œä¸ºç‰¹å®š Tasker æä¾›åŠŸèƒ½å¢å¼º

### æ€§èƒ½ä¼˜åŒ–

- å¹¶è¡Œä¾èµ–æ£€æŸ¥ï¼šä½¿ç”¨ `Promise.all` æ‰¹é‡æ£€æŸ¥ä¾èµ–ï¼Œæå‡å¯åŠ¨é€Ÿåº¦
- å¹¶è¡Œæ’ä»¶ä¾èµ–å®‰è£…ï¼šåŒæ—¶å¤„ç†å¤šä¸ªæ’ä»¶çš„ä¾èµ–æ£€æŸ¥ä¸å®‰è£…
- æ‰¹é‡æ—¥å¿—å†™å…¥ï¼šä¼˜åŒ–æ—¥å¿—é˜Ÿåˆ—åˆ·æ–°æœºåˆ¶ï¼Œä½¿ç”¨æ‰¹é‡å†™å…¥å’Œå¼‚æ­¥å¤„ç†
- é«˜æ•ˆç«¯å£æ‰«æï¼šä¼˜åŒ–ç«¯å£åˆ—è¡¨è·å–ç®—æ³•ï¼Œå‡å°‘æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

### ç”Ÿäº§çº§èƒ½åŠ›

- åå‘ä»£ç†ï¼šå¤šåŸŸå + SNI + HTTP/2
- å®‰å…¨ä¸è§‚æµ‹ï¼šCORS / Helmet / é€Ÿç‡é™åˆ¶ / è¯·æ±‚æ—¥å¿—
- èµ„æºç®¡ç†ï¼šè‡ªåŠ¨æ¸…ç† `trash/` ç›®å½•ä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼Œé€‚åˆé•¿æœŸç¨³å®šè¿è¡Œ

æ›´å¤šè¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š

- [`docs/bot.md`](docs/bot.md)ï¼š`Bot` ä¸»ç±»ä¸ç”Ÿå‘½å‘¨æœŸ
- [`docs/plugins-loader.md`](docs/plugins-loader.md) / [`docs/plugin-base.md`](docs/plugin-base.md)ï¼šæ’ä»¶åŠ è½½å™¨ä¸æ’ä»¶åŸºç±»
- [`docs/aistream.md`](docs/aistream.md)ï¼šAI å·¥ä½œæµä¸ä¸Šä¸‹æ–‡æ£€ç´¢
- [`docs/äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£.md`](docs/äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£.md)ï¼šäº‹ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜

---

## æ–‡æ¡£ä¸å¼€å‘æŒ‡å—

### ğŸ“š å®Œæ•´æ–‡æ¡£

**[`docs/å®Œæ•´æ–‡æ¡£.md`](docs/å®Œæ•´æ–‡æ¡£.md)** - **æ¨èä»è¿™é‡Œå¼€å§‹**

æ•´åˆäº†æ‰€æœ‰æ ¸å¿ƒæ–‡æ¡£ï¼ŒåŒ…å«ï¼š
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- æ¶æ„æ€»è§ˆ
- æ ¸å¿ƒæ¨¡å—è¯¦ç»†è¯´æ˜ï¼ˆBotã€æ’ä»¶ã€Taskerã€äº‹ä»¶ã€APIã€AIã€é…ç½®ã€æ¸²æŸ“ã€å·¥å…·ï¼‰
- å¼€å‘æŒ‡å—ï¼ˆç¼–å†™æ’ä»¶ã€åˆ›å»º Taskerã€å¼€å‘ API ç­‰ï¼‰
- API å‚è€ƒ
- æœ€ä½³å®è·µ

### ğŸ“– å…¶ä»–æ–‡æ¡£

#### è¿è¡Œæ ¸å¿ƒä¸åŸºç¡€è®¾æ–½
- [`PROJECT_OVERVIEW.md`](PROJECT_OVERVIEW.md)ï¼šé¡¹ç›®æ•´ä½“æ¶æ„ä¸ç›®å½•ç»“æ„è¯¦ç»†è¯´æ˜
- [`docs/bot.md`](docs/bot.md)ï¼šBot ä¸»ç±»è¯¦ç»†æ–‡æ¡£

#### ä»»åŠ¡å±‚ä¸äº‹ä»¶ç³»ç»Ÿ
- [`docs/tasker-base-spec.md`](docs/tasker-base-spec.md)ï¼šTasker åº•å±‚è§„èŒƒï¼ˆäº‹ä»¶ç”Ÿæˆå™¨è§„èŒƒï¼‰
- [`docs/tasker-onebotv11.md`](docs/tasker-onebotv11.md)ï¼šOneBot Tasker è¯¦ç»†æ–‡æ¡£
- [`docs/tasker-loader.md`](docs/tasker-loader.md)ï¼šTasker åŠ è½½å™¨æ–‡æ¡£
- [`docs/äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£.md`](docs/äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£.md)ï¼šäº‹ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜
- [`docs/äº‹ä»¶ç›‘å¬å™¨å¼€å‘æŒ‡å—.md`](docs/äº‹ä»¶ç›‘å¬å™¨å¼€å‘æŒ‡å—.md)ï¼šäº‹ä»¶ç›‘å¬å™¨å¼€å‘æŒ‡å—

#### æ’ä»¶ç³»ç»Ÿ
- [`docs/plugin-base.md`](docs/plugin-base.md)ï¼šæ’ä»¶åŸºç±»è¯¦ç»†æ–‡æ¡£
- [`docs/plugins-loader.md`](docs/plugins-loader.md)ï¼šæ’ä»¶åŠ è½½å™¨è¯¦ç»†æ–‡æ¡£

#### HTTP/API
- [`docs/http-api.md`](docs/http-api.md)ï¼šHTTP API åŸºç±»æ–‡æ¡£
- [`docs/api-loader.md`](docs/api-loader.md)ï¼šAPI åŠ è½½å™¨æ–‡æ¡£

#### AI å·¥ä½œæµ
- [`docs/aistream.md`](docs/aistream.md)ï¼šAI å·¥ä½œæµè¯¦ç»†æ–‡æ¡£

#### é…ç½®ä¸æ¸²æŸ“
- [`docs/config-base.md`](docs/config-base.md)ï¼šé…ç½®ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£
- [`docs/renderer.md`](docs/renderer.md)ï¼šæ¸²æŸ“ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£

#### å·¥å…·ç±»
- [`docs/botutil.md`](docs/botutil.md)ï¼šå·¥å…·ç±»è¯¦ç»†æ–‡æ¡£
- [`docs/app-dev.md`](docs/app-dev.md)ï¼šåº”ç”¨å¼€å‘è¯¦ç»†æ–‡æ¡£

---

## XRK-AGT åç»­è®¡åˆ’ï¼ˆèŠ‚é€‰ï¼‰

### å·²å®Œæˆ

- PM2 å¯åŠ¨æ–¹å¼æ”¯æŒ
- å¼€æºå¯¹æ¥ä»»åŠ¡å¤„ç†å™¨ï¼ˆå¯¹æ¥ MySQLã€å¾®ä¿¡å…¬ä¼—å·ç­‰ï¼‰
- æŠ•å…¥å†œä¸šåœºæ™¯å®è·µä½¿ç”¨
- å‰¥ç¦» icqq ç­‰åº•å±‚ä»¥ä¾¿ç±»å‹æ‰©å±•ä¸äºŒæ¬¡å¼€å‘
- è§„èŒƒåŒ–ä»»åŠ¡å¤„ç†é€»è¾‘ä¸ç±»å‹å®šä¹‰
- åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ˜ç¡®åŸºç¡€è®¾æ–½å±‚ä¸ä¸šåŠ¡å±‚èŒè´£

### è§„åˆ’æ–¹å‘

- ä¸°å¯Œå®˜æ–¹æ’ä»¶ä¸ AI å·¥ä½œæµç¤ºä¾‹
- æä¾›æ›´å®Œå–„çš„ Web æ§åˆ¶å°ä¸å¯è§†åŒ–é…ç½®å·¥å…·
- ä¼˜åŒ–äº‹ä»¶ç³»ç»Ÿæ€§èƒ½
- å¢å¼º Tasker æ‰©å±•èƒ½åŠ›

---

## è‡´è°¢

- **å‘æ—¥è‘µå·¥ä½œå®¤å¼€å‘ä¸æµ‹è¯•å›¢é˜Ÿ**ï¼šæŒç»­æ‰“ç£¨æ¶æ„ä¸è¿è¡Œç¨³å®šæ€§
- **æ‰€æœ‰æäº¤ Issue / PR çš„ç¤¾åŒºæˆå‘˜**ï¼šä¸º XRK-AGT å¸¦æ¥äº†çœŸå®åœºæ™¯çš„éœ€æ±‚å’Œæ”¹è¿›å»ºè®®
- **å¼€æºç”Ÿæ€ä¸­çš„ä¼˜ç§€ç»„ä»¶ä½œè€…**ï¼šåŒ…æ‹¬ Node.jsã€Redisã€MongoDBã€Puppeteer/Playwright ç­‰ï¼Œä¸ºæœ¬é¡¹ç›®æä¾›äº†åšå®åŸºç¡€
