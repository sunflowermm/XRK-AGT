# XRK-AGT å®Œæ•´æ–‡æ¡£

> æœ¬æ–‡æ¡£æ•´åˆäº†æ¡†æ¶çš„æ‰€æœ‰æ ¸å¿ƒæ–‡æ¡£ï¼Œæä¾›å®Œæ•´çš„å¼€å‘æŒ‡å—å’ŒAPIå‚è€ƒã€‚

## ğŸ“‘ ç›®å½•å¯¼èˆª

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
  - [Botä¸»ç±»](#botä¸»ç±»)
  - [æ’ä»¶ç³»ç»Ÿ](#æ’ä»¶ç³»ç»Ÿ)
  - [é€‚é…å™¨ç³»ç»Ÿ](#é€‚é…å™¨ç³»ç»Ÿ)
  - [äº‹ä»¶ç³»ç»Ÿ](#äº‹ä»¶ç³»ç»Ÿ)
  - [HTTP/APIå±‚](#httpapiå±‚)
  - [AIå·¥ä½œæµ](#aiå·¥ä½œæµ)
  - [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
  - [æ¸²æŸ“ç³»ç»Ÿ](#æ¸²æŸ“ç³»ç»Ÿ)
  - [å·¥å…·ç±»](#å·¥å…·ç±»)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [APIå‚è€ƒ](#apiå‚è€ƒ)

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¸è¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Xrkseek/XRK-AGT.git
cd XRK-AGT

# å®‰è£…ä¾èµ–
pnpm install

# è¿è¡Œ
node app
```

### é¡¹ç›®ç»“æ„

```
XRK-AGT/
â”œâ”€ app.js / start.js          # å¯åŠ¨å…¥å£
â”œâ”€ src/                       # æ ¸å¿ƒä»£ç 
â”‚  â”œâ”€ bot.js                  # Botä¸»ç±»
â”‚  â”œâ”€ infrastructure/         # åŸºç¡€è®¾æ–½å±‚
â”‚  â””â”€ utils/                  # å·¥å…·å‡½æ•°
â”œâ”€ core/                      # ä¸šåŠ¡ä»£ç 
â”‚  â”œâ”€ adapter/                # é€‚é…å™¨
â”‚  â”œâ”€ plugin/                 # æ’ä»¶
â”‚  â”œâ”€ http/                   # HTTP API
â”‚  â”œâ”€ events/                 # äº‹ä»¶ç›‘å¬å™¨
â”‚  â””â”€ stream/                 # AIå·¥ä½œæµ
â”œâ”€ config/                    # é…ç½®æ–‡ä»¶
â”œâ”€ docs/                      # æ–‡æ¡£
â””â”€ www/                       # Webå‰ç«¯
```

---

## æ¶æ„æ€»è§ˆ

### æ ¸å¿ƒç»„ä»¶å…³ç³»

```
å¤–éƒ¨å®¢æˆ·ç«¯ â†’ é€‚é…å™¨å±‚ â†’ Bot.emäº‹ä»¶ â†’ æ’ä»¶ç³»ç»Ÿ â†’ AIå·¥ä½œæµ/æ¸²æŸ“å™¨
                â†“
            HTTP/APIæœåŠ¡ â†’ Express â†’ ä¸­é—´ä»¶ â†’ APIè·¯ç”±
```

### è¿è¡Œæµç¨‹

1. **å¯åŠ¨é˜¶æ®µ**
   - `app.js` æ£€æŸ¥ç¯å¢ƒã€å®‰è£…ä¾èµ–
   - `start.js` åˆ›å»ºBotå®ä¾‹
   - BotåŠ è½½é…ç½®ã€é€‚é…å™¨ã€æ’ä»¶ã€API

2. **è¿è¡Œé˜¶æ®µ**
   - é€‚é…å™¨æ¥æ”¶æ¶ˆæ¯ï¼Œé€šè¿‡`Bot.em`è§¦å‘äº‹ä»¶
   - äº‹ä»¶ç›‘å¬å™¨å¤„ç†å¹¶æ ‡å‡†åŒ–äº‹ä»¶
   - æ’ä»¶ç³»ç»ŸåŒ¹é…è§„åˆ™å¹¶æ‰§è¡Œæ’ä»¶
   - æ’ä»¶å¯è°ƒç”¨AIå·¥ä½œæµã€æ¸²æŸ“å™¨ç­‰

3. **HTTPæœåŠ¡**
   - Expresså¤„ç†HTTPè¯·æ±‚
   - APIè·¯ç”±å¤„ç†ä¸šåŠ¡é€»è¾‘
   - WebSocketæ”¯æŒå®æ—¶é€šä¿¡

---

## æ ¸å¿ƒæ¨¡å—

### Botä¸»ç±»

**æ–‡ä»¶**: `src/bot.js`

**èŒè´£**:
- HTTP/HTTPS/WebSocketæœåŠ¡ç®¡ç†
- ä¸­é—´ä»¶é…ç½®ï¼ˆCORSã€è®¤è¯ã€é™æµç­‰ï¼‰
- åå‘ä»£ç†æ”¯æŒ
- äº‹ä»¶æ´¾å‘ï¼ˆ`Bot.em`ï¼‰
- èµ„æºæ¸…ç†

**å…³é”®æ–¹æ³•**:
- `prepareEvent(data)`: è®¾ç½®äº‹ä»¶é€šç”¨å±æ€§
- `em(name, data)`: è§¦å‘äº‹ä»¶
- `run(options)`: å¯åŠ¨æœåŠ¡

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[Botä¸»ç±»è¯¦ç»†è¯´æ˜](#botä¸»ç±»è¯¦ç»†è¯´æ˜)

---

### æ’ä»¶ç³»ç»Ÿ

#### æ’ä»¶åŸºç±» (`plugin`)

**æ–‡ä»¶**: `src/infrastructure/plugins/plugin.js`

**æ ¸å¿ƒæ¦‚å¿µ**:
- `name`: æ’ä»¶åç§°
- `event`: ç›‘å¬çš„äº‹ä»¶ç±»å‹
- `priority`: ä¼˜å…ˆçº§ï¼ˆè¶Šå°è¶Šå…ˆæ‰§è¡Œï¼‰
- `rule`: è§„åˆ™æ•°ç»„
- `task`: å®šæ—¶ä»»åŠ¡

**acceptæ–¹æ³•**:
```javascript
async accept(e) {
  // å‰ç½®æ£€æŸ¥ï¼Œè¿”å›true/false/'return'
  // é€‚é…å™¨å¢å¼ºæ’ä»¶åœ¨æ­¤æŒ‚è½½ç‰¹å®šå±æ€§
  return true
}
```

**ä¸Šä¸‹æ–‡ç®¡ç†**:
- `setContext(type, isGroup, time)`: è®¾ç½®ä¸Šä¸‹æ–‡
- `getContext(type, isGroup)`: è·å–ä¸Šä¸‹æ–‡
- `finish(type, isGroup)`: ç»“æŸä¸Šä¸‹æ–‡

#### æ’ä»¶åŠ è½½å™¨ (`PluginsLoader`)

**æ–‡ä»¶**: `src/infrastructure/plugins/loader.js`

**èŒè´£**:
- æ‰«æå¹¶åŠ è½½`core/plugin`ç›®å½•
- è§„åˆ™åŒ¹é…ä¸æƒé™æ£€æŸ¥
- å†·å´ä¸èŠ‚æµç®¡ç†
- å®šæ—¶ä»»åŠ¡è°ƒåº¦

**äº‹ä»¶å¤„ç†æµç¨‹**:
1. `deal(e)` - å…¥å£
2. `initEvent(e)` - åˆå§‹åŒ–äº‹ä»¶
3. `preCheck(e)` - å‰ç½®æ£€æŸ¥
4. `initPlugins(e)` - åˆå§‹åŒ–æ’ä»¶
5. `accept(e)` - æ‰§è¡Œacceptæ–¹æ³•
6. `processRules()` - æ‰§è¡Œè§„åˆ™

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[æ’ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜](#æ’ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜)

---

### é€‚é…å™¨ç³»ç»Ÿ

#### é€‚é…å™¨åº•å±‚è§„èŒƒ

æ‰€æœ‰é€‚é…å™¨åº”å…·å¤‡çš„åŸºç¡€å±æ€§ï¼š

**äº‹ä»¶å¯¹è±¡åŸºç¡€å±æ€§**:
```javascript
{
  self_id: string,           // Bot ID
  adapter: string,           // é€‚é…å™¨ç±»å‹
  adapter_id: string,        // é€‚é…å™¨ID
  adapter_name: string,      // é€‚é…å™¨åç§°
  event_id: string,          // äº‹ä»¶ID
  time: number,              // æ—¶é—´æˆ³
  bot: BotInstance,         // Botå®ä¾‹
  user_id: string|number,    // ç”¨æˆ·ID
  sender: Object,            // å‘é€è€…ä¿¡æ¯
  reply: Function            // å›å¤æ–¹æ³•
}
```

**é€‚é…å™¨ç‰¹å®šå±æ€§**åº”ç”±å¢å¼ºæ’ä»¶å¤„ç†ï¼Œä¸åœ¨åº•å±‚è®¾ç½®ã€‚

#### é€‚é…å™¨åŠ è½½å™¨ (`AdapterLoader`)

**æ–‡ä»¶**: `src/infrastructure/adapter/loader.js`

**èŒè´£**:
- æ‰«æ`core/adapter`ç›®å½•
- åŠ¨æ€åŠ è½½é€‚é…å™¨æ–‡ä»¶
- é€‚é…å™¨é€šè¿‡`Bot.adapter.push()`æ³¨å†Œ

#### OneBotv11é€‚é…å™¨

**æ–‡ä»¶**: `core/adapter/OneBotv11.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- WebSocketæ¶ˆæ¯å¤„ç†
- äº‹ä»¶è½¬è¯‘ä¸æ ‡å‡†åŒ–
- å¯¹è±¡å°è£…ï¼ˆfriend/group/memberï¼‰

**å¯¹è±¡è®¿é—®**:
- `Bot[self_id].pickFriend(user_id)`: è·å–å¥½å‹å¯¹è±¡
- `Bot[self_id].pickGroup(group_id)`: è·å–ç¾¤å¯¹è±¡
- `Bot[self_id].pickMember(group_id, user_id)`: è·å–æˆå‘˜å¯¹è±¡

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[é€‚é…å™¨ç³»ç»Ÿè¯¦ç»†è¯´æ˜](#é€‚é…å™¨ç³»ç»Ÿè¯¦ç»†è¯´æ˜)

---

### äº‹ä»¶ç³»ç»Ÿ

#### äº‹ä»¶å‘½åè§„èŒƒ

**æ ¼å¼**: `{é€‚é…å™¨}.{äº‹ä»¶ç±»å‹}.{å­ç±»å‹}`

**ç¤ºä¾‹**:
- `onebot.message.group.normal`: OneBotç¾¤èŠæ™®é€šæ¶ˆæ¯
- `device.message`: è®¾å¤‡æ¶ˆæ¯
- `stdin.message`: æ ‡å‡†è¾“å…¥æ¶ˆæ¯

#### äº‹ä»¶åŒ¹é…è§„åˆ™

1. **å®Œå…¨åŒ¹é…**: `plugin.event === actualEvent`
2. **é€šé…ç¬¦åŒ¹é…**: `onebot.message.*`
3. **é€šç”¨äº‹ä»¶åŒ¹é…**: `message`åŒ¹é…æ‰€æœ‰é€‚é…å™¨çš„messageäº‹ä»¶
4. **å‰ç¼€åŒ¹é…**: `onebot.*`åŒ¹é…æ‰€æœ‰OneBotäº‹ä»¶

#### äº‹ä»¶å¤„ç†æµç¨‹

```
é€‚é…å™¨è§¦å‘äº‹ä»¶
  â†“
äº‹ä»¶ç›‘å¬å™¨æ¥æ”¶ (core/events/*.js)
  â†“
äº‹ä»¶å»é‡å’Œæ ‡å‡†åŒ–
  â†“
Bot.emè‡ªåŠ¨è°ƒç”¨Bot.prepareEvent
  â†“
æ’ä»¶åŠ è½½å™¨å¤„ç†
  â†“
æ‰§è¡Œacceptæ–¹æ³•ï¼ˆå¢å¼ºæ’ä»¶æŒ‚è½½å±æ€§ï¼‰
  â†“
æ‰§è¡Œæ’ä»¶è§„åˆ™
```

#### äº‹ä»¶ç›‘å¬å™¨å¼€å‘

**æ–‡ä»¶ä½ç½®**: `core/events/myadapter.js`

**åŸºæœ¬ç»“æ„**:
```javascript
export default class MyAdapterEvent {
  constructor() {
    this.plugins = PluginsLoader
    this.processedEvents = new Set()
  }

  async init() {
    Bot.on('myadapter.message', (e) => this.handleEvent(e, 'myadapter.message'))
  }

  async handleEvent(e, eventType) {
    // äº‹ä»¶å»é‡
    // è®¾ç½®åŸºç¡€å±æ€§
    // è°ƒç”¨plugins.deal(e)
  }
}
```

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[äº‹ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜](#äº‹ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜)

---

### HTTP/APIå±‚

#### HTTP APIåŸºç±» (`HttpApi`)

**æ–‡ä»¶**: `src/infrastructure/http/http.js`

**ä½¿ç”¨æ–¹å¼**:
```javascript
// core/http/example.js
export default {
  name: 'example-api',
  routes: [
    {
      method: 'GET',
      path: '/api/example/ping',
      handler: async (req, res, Bot) => {
        res.json({ success: true })
      }
    }
  ],
  ws: {
    '/ws/example': async (conn, req, Bot) => {
      // WebSocketå¤„ç†
    }
  }
}
```

#### APIåŠ è½½å™¨ (`ApiLoader`)

**æ–‡ä»¶**: `src/infrastructure/http/loader.js`

**åŠŸèƒ½**:
- è‡ªåŠ¨æ‰«æ`core/http`ç›®å½•
- æŒ‰ä¼˜å…ˆçº§æ’åº
- æ³¨å†Œè·¯ç”±å’ŒWebSocket
- æ”¯æŒçƒ­é‡è½½

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[HTTP/APIå±‚è¯¦ç»†è¯´æ˜](#httpapiå±‚è¯¦ç»†è¯´æ˜)

---

### AIå·¥ä½œæµ

#### AIStreamåŸºç±»

**æ–‡ä»¶**: `src/infrastructure/aistream/aistream.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- Chat Completionè°ƒç”¨
- Embeddingç”Ÿæˆä¸æ£€ç´¢
- å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰
- ä¸Šä¸‹æ–‡å¢å¼º

**ä½¿ç”¨æ–¹å¼**:
```javascript
// åœ¨æ’ä»¶ä¸­
const stream = this.getStream('chat')
const reply = await stream.process(this.e, question, config)
await this.reply(reply)
```

**æä¾›å•†æ”¯æŒ**:
- `generic`: OpenAIå…¼å®¹æ¥å£ï¼ˆé»˜è®¤ï¼‰
- `volcengine`: ç«å±±å¼•æ“è±†åŒ…

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[AIå·¥ä½œæµè¯¦ç»†è¯´æ˜](#aiå·¥ä½œæµè¯¦ç»†è¯´æ˜)

---

### é…ç½®ç³»ç»Ÿ

#### ConfigBaseåŸºç±»

**æ–‡ä»¶**: `src/infrastructure/commonconfig/commonconfig.js`

**åŠŸèƒ½**:
- YAML/JSONè¯»å†™
- è·¯å¾„æ“ä½œï¼ˆget/set/deleteï¼‰
- é…ç½®æ ¡éªŒ
- è‡ªåŠ¨å¤‡ä»½

**ä½¿ç”¨æ–¹å¼**:
```javascript
const config = new ServerConfig()
const data = await config.read()
await config.set('server.port', 8080)
```

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[é…ç½®ç³»ç»Ÿè¯¦ç»†è¯´æ˜](#é…ç½®ç³»ç»Ÿè¯¦ç»†è¯´æ˜)

---

### æ¸²æŸ“ç³»ç»Ÿ

#### RendereråŸºç±»

**æ–‡ä»¶**: `src/infrastructure/renderer/Renderer.js`

**åŠŸèƒ½**:
- HTMLæ¨¡æ¿æ¸²æŸ“
- æ–‡ä»¶ç›‘å¬ä¸è‡ªåŠ¨é‡è½½
- é™æ€èµ„æºè·¯å¾„å¤„ç†

**ä½¿ç”¨æ–¹å¼**:
```javascript
const renderer = Bot.renderer.puppeteer
const htmlPath = await renderer.dealTpl('status', {
  tplFile: 'resources/html/status.html',
  data: { title: 'çŠ¶æ€' }
})
const img = await renderer.renderImage({ htmlPath })
```

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[æ¸²æŸ“ç³»ç»Ÿè¯¦ç»†è¯´æ˜](#æ¸²æŸ“ç³»ç»Ÿè¯¦ç»†è¯´æ˜)

---

### å·¥å…·ç±»

#### BotUtil

**æ–‡ä»¶**: `src/utils/botutil.js`

**ä¸»è¦åŠŸèƒ½**:
- æ—¥å¿—å°è£…ï¼ˆ`makeLog`ï¼‰
- ç¼“å­˜ç®¡ç†ï¼ˆ`cache`ã€`getMap`ï¼‰
- æ–‡ä»¶æ“ä½œï¼ˆ`readFile`ã€`writeFile`ã€`Buffer`ï¼‰
- ç½‘ç»œè¯·æ±‚ï¼ˆ`Buffer`æ”¯æŒHTTPï¼‰
- å¼‚æ­¥æ§åˆ¶ï¼ˆ`retry`ã€`batch`ã€`sleep`ï¼‰
- æ—¶é—´æ ¼å¼åŒ–ï¼ˆ`formatDate`ã€`getTimeDiff`ï¼‰

**è¯¦ç»†æ–‡æ¡£**: è§ä¸‹æ–¹[å·¥å…·ç±»è¯¦ç»†è¯´æ˜](#å·¥å…·ç±»è¯¦ç»†è¯´æ˜)

---

## å¼€å‘æŒ‡å—

### ç¼–å†™æ’ä»¶

```javascript
export default class MyPlugin extends plugin {
  constructor() {
    super({
      name: 'æˆ‘çš„æ’ä»¶',
      event: 'message',
      priority: 5000,
      rule: [
        { reg: '^#æµ‹è¯•$', fnc: 'test' }
      ]
    })
  }

  async test(e) {
    await this.reply('æµ‹è¯•æˆåŠŸ')
  }
}
```

### åˆ›å»ºé€‚é…å™¨

```javascript
// core/adapter/MyAdapter.js
Bot.adapter.push(new class MyAdapter {
  id = 'myadapter'
  name = 'MyAdapter'
  path = this.name

  load() {
    Bot.wsf[this.path].push((ws) => {
      ws.on('message', (data) => this.handleMessage(data))
    })
  }

  handleMessage(data) {
    Bot.em('myadapter.message', {
      event_id: `myadapter_${Date.now()}`,
      user_id: data.user_id,
      message: [{ type: 'text', text: data.text }]
    })
  }
})
```

### åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨

è§ä¸Šæ–¹[äº‹ä»¶ç›‘å¬å™¨å¼€å‘](#äº‹ä»¶ç›‘å¬å™¨å¼€å‘)éƒ¨åˆ†ã€‚

### åˆ›å»ºHTTP API

è§ä¸Šæ–¹[HTTP APIåŸºç±»](#http-apiåŸºç±»-httpapi)éƒ¨åˆ†ã€‚

---

## è¯¦ç»†æ–‡æ¡£ç´¢å¼•

### Botä¸»ç±»è¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/bot.md`

**å†…å®¹**:
- Botç±»èŒè´£ä¸ç”Ÿå‘½å‘¨æœŸ
- å…³é”®æ–¹æ³•æ¦‚è§ˆ
- ä¸å…¶å®ƒæ ¸å¿ƒå¯¹è±¡çš„å…³ç³»
- å¼€å‘ä¸æ‰©å±•å»ºè®®

### æ’ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/plugin-base.md`ã€`docs/plugins-loader.md`

**å†…å®¹**:
- æ’ä»¶åŸºç±»å®Œæ•´API
- acceptæ–¹æ³•è¯¦è§£
- ä¸Šä¸‹æ–‡ç®¡ç†
- æ’ä»¶åŠ è½½å™¨æµç¨‹
- å†·å´ä¸èŠ‚æµæœºåˆ¶

### é€‚é…å™¨ç³»ç»Ÿè¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/adapter-base-spec.md`ã€`docs/adapter-loader.md`ã€`docs/adapter-onebotv11.md`

**å†…å®¹**:
- é€‚é…å™¨åº•å±‚è§„èŒƒ
- é€‚é…å™¨åŠ è½½å™¨æœºåˆ¶
- OneBotv11é€‚é…å™¨å®Œæ•´æ–‡æ¡£
- å¯¹è±¡å°è£…ä¸APIè°ƒç”¨

### äº‹ä»¶ç³»ç»Ÿè¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£.md`ã€`docs/äº‹ä»¶ç›‘å¬å™¨å¼€å‘æŒ‡å—.md`

**å†…å®¹**:
- äº‹ä»¶å‘½åè§„èŒƒ
- äº‹ä»¶åŒ¹é…è§„åˆ™
- äº‹ä»¶å¯¹è±¡æ ‡å‡†åŒ–
- acceptæ–¹æ³•è¯¦è§£
- äº‹ä»¶ç›‘å¬å™¨å¼€å‘æŒ‡å—

### HTTP/APIå±‚è¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/http-api.md`ã€`docs/api-loader.md`

**å†…å®¹**:
- HttpApiåŸºç±»API
- è·¯ç”±ä¸WebSocketæ³¨å†Œ
- APIåŠ è½½å™¨æœºåˆ¶
- çƒ­é‡è½½æ”¯æŒ

### AIå·¥ä½œæµè¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/aistream.md`

**å†…å®¹**:
- AIStreamåŸºç±»API
- Embeddingæä¾›å•†
- å‡½æ•°è°ƒç”¨æœºåˆ¶
- ä¸Šä¸‹æ–‡å¢å¼º

### é…ç½®ç³»ç»Ÿè¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/config-base.md`

**å†…å®¹**:
- ConfigBaseåŸºç±»API
- è·¯å¾„æ“ä½œ
- é…ç½®æ ¡éªŒ
- Schemaå®šä¹‰

### æ¸²æŸ“ç³»ç»Ÿè¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/renderer.md`

**å†…å®¹**:
- RendereråŸºç±»API
- æ¨¡æ¿å¤„ç†
- æ–‡ä»¶ç›‘å¬
- è‡ªå®šä¹‰æ¸²æŸ“å™¨å¼€å‘

### å·¥å…·ç±»è¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/botutil.md`

**å†…å®¹**:
- BotUtilå®Œæ•´API
- æ—¥å¿—ä¸å­—ç¬¦ä¸²å·¥å…·
- æ–‡ä»¶ä¸ç½‘ç»œæ“ä½œ
- å¼‚æ­¥æ§åˆ¶æ–¹æ³•

### åº”ç”¨å¼€å‘è¯¦ç»†è¯´æ˜

**æ–‡ä»¶**: `docs/app-dev.md`

**å†…å®¹**:
- å¯åŠ¨æµç¨‹è¯¦è§£
- é…ç½®ä½“ç³»è¯´æ˜
- Webæ§åˆ¶å°å¼€å‘
- å‰åç«¯åä½œ

---

## APIå‚è€ƒ

### Botå…¨å±€å¯¹è±¡

```javascript
Bot = {
  adapter: Array<Adapter>,        // é€‚é…å™¨åˆ—è¡¨
  [self_id]: BotInstance,         // Botå®ä¾‹
  uin: Array<string>,              // QQå·åˆ—è¡¨
  wsf: Object,                     // WebSocketå·¥å‚
  em(name, data): void,            // è§¦å‘äº‹ä»¶
  makeLog(level, msg, id?, err?): void  // æ—¥å¿—
}
```

### äº‹ä»¶å¯¹è±¡ (e)

```javascript
e = {
  // åŸºç¡€å±æ€§
  self_id: string,
  adapter: string,
  event_id: string,
  bot: BotInstance,
  
  // æ¶ˆæ¯ç›¸å…³
  message: Array,
  raw_message: string,
  msg: string,
  
  // ç”¨æˆ·ç›¸å…³
  user_id: string|number,
  sender: Object,
  
  // ç¾¤ç»„ç›¸å…³ï¼ˆç¾¤æ¶ˆæ¯æ—¶ï¼‰
  group_id: string|number,
  
  // OneBotç‰¹å®šï¼ˆç”±OneBotEnhanceræŒ‚è½½ï¼‰
  friend: FriendObject,
  group: GroupObject,
  member: MemberObject,
  isGroup: boolean,
  isPrivate: boolean,
  atBot: boolean,
  
  // å›å¤æ–¹æ³•
  reply(msg, quote?, data?): Promise
}
```

### æ’ä»¶åŸºç±»API

```javascript
class plugin {
  constructor(options)
  async accept(e): boolean|'return'
  reply(msg, quote?, data?): Promise
  getStream(name): AIStream
  setContext(type, isGroup?, time?): void
  getContext(type?, isGroup?): Object
  finish(type, isGroup?): void
}
```

---

## æœ€ä½³å®è·µ

1. **æ’ä»¶å¼€å‘**
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„`name`å’Œ`dsc`
   - åˆç†è®¾ç½®`priority`
   - ä½¿ç”¨`accept`è¿›è¡Œå‰ç½®æ£€æŸ¥
   - åŠæ—¶æ¸…ç†ä¸Šä¸‹æ–‡

2. **é€‚é…å™¨å¼€å‘**
   - åªè®¾ç½®åŸºç¡€å±æ€§
   - é€‚é…å™¨ç‰¹å®šå±æ€§ç”±å¢å¼ºæ’ä»¶å¤„ç†
   - ä½¿ç”¨`Bot.em`è§¦å‘äº‹ä»¶
   - ä¿æŒäº‹ä»¶ç»“æ„ç»Ÿä¸€

3. **äº‹ä»¶å¤„ç†**
   - å®ç°äº‹ä»¶å»é‡
   - è®¾ç½®é€‚é…å™¨æ ‡è¯†
   - ä½¿ç”¨try-catchæ•è·é”™è¯¯
   - é€‚é…å™¨ç‰¹å®šé€»è¾‘åœ¨å¢å¼ºæ’ä»¶ä¸­å¤„ç†

4. **APIå¼€å‘**
   - ä½¿ç”¨`HttpApi`åŸºç±»
   - ç»Ÿä¸€é”™è¯¯å¤„ç†
   - æ”¯æŒAPI-Keyè®¤è¯
   - æä¾›æ¸…æ™°çš„æ–‡æ¡£

---

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•è®©æ’ä»¶æ”¯æŒå¤šä¸ªé€‚é…å™¨ï¼Ÿ**
A: ä½¿ç”¨é€šç”¨äº‹ä»¶åï¼Œå¦‚`event: 'message'`

**Q: acceptæ–¹æ³•ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Ÿ**
A: åœ¨æ’ä»¶è§„åˆ™åŒ¹é…ä¹‹å‰ï¼Œæ‰€æœ‰åŒ¹é…äº‹ä»¶çš„æ’ä»¶éƒ½ä¼šå…ˆæ‰§è¡Œacceptæ–¹æ³•

**Q: å¦‚ä½•é˜»æ­¢å…¶ä»–æ’ä»¶å¤„ç†äº‹ä»¶ï¼Ÿ**
A: åœ¨acceptæ–¹æ³•ä¸­è¿”å›`'return'`

**Q: å¦‚ä½•æ·»åŠ æ–°çš„é€‚é…å™¨ï¼Ÿ**
A: 1. åˆ›å»ºé€‚é…å™¨æ–‡ä»¶ 2. åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨ 3. å¯é€‰ï¼šåˆ›å»ºå¢å¼ºæ’ä»¶

---

*æœ¬æ–‡æ¡£æ•´åˆäº†æ‰€æœ‰æ ¸å¿ƒæ–‡æ¡£ï¼Œå¦‚éœ€æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒå¯¹åº”çš„è¯¦ç»†æ–‡æ¡£ã€‚*

