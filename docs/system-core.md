# system-Core ç‰¹æ€§æ–‡æ¡£

> **æ–‡ä»¶ä½ç½®**: `core/system-Core/`  
> **è¯´æ˜**ï¼šsystem-Core æ˜¯ XRK-AGT çš„å†…ç½®æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†å®Œæ•´çš„ç³»ç»ŸåŠŸèƒ½ã€HTTP APIã€å·¥ä½œæµã€æ’ä»¶å’Œ Web æ§åˆ¶å°ã€‚

## ğŸ“– æ¦‚è¿°

system-Core æ˜¯ XRK-AGT çš„å†…ç½®æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†å¼€ç®±å³ç”¨çš„å®Œæ•´åŠŸèƒ½é›†ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **10ä¸ªHTTP APIæ¨¡å—**ï¼šæ ¸å¿ƒç³»ç»Ÿã€æœºå™¨äººç®¡ç†ã€é…ç½®ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ã€æ’ä»¶ç®¡ç†ã€AIæœåŠ¡ã€MCPæœåŠ¡ã€è®¾å¤‡ç®¡ç†ã€æ ‡å‡†è¾“å…¥ã€æ•°æ®ç¼–è¾‘
- âœ… **6ä¸ªå·¥ä½œæµ**ï¼šèŠå¤©ã€æ¡Œé¢ã€å·¥å…·ã€è®°å¿†ã€çŸ¥è¯†åº“ã€è®¾å¤‡ï¼ˆå…±53ä¸ªMCPå·¥å…·ï¼‰
- âœ… **4ä¸ªTasker**ï¼šOneBotv11ã€GSUIDCOREã€QBQBotã€stdin
- âœ… **Webæ§åˆ¶å°**ï¼šä¼ä¸šçº§ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç³»ç»Ÿç›‘æ§ã€APIè°ƒè¯•ã€é…ç½®ç®¡ç†

### åŠŸèƒ½ç‰¹ç‚¹

- **é›¶é…ç½®å¯åŠ¨**ï¼šæ‰€æœ‰åŠŸèƒ½å¼€ç®±å³ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®
- **è‡ªåŠ¨åŠ è½½**ï¼šæ‰€æœ‰æ¨¡å—é€šè¿‡åŠ è½½å™¨è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œ
- **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰APIéµå¾ªç»Ÿä¸€çš„æ¥å£è§„èŒƒ
- **å®Œæ•´æ–‡æ¡£**ï¼šæ¯ä¸ªæ¨¡å—éƒ½æœ‰è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜

---

## ğŸ“š ç›®å½•

- [HTTP API æ¨¡å—](#http-api-æ¨¡å—)
- [å·¥ä½œæµï¼ˆStreamï¼‰](#å·¥ä½œæµstream)
- [æ’ä»¶ï¼ˆPluginï¼‰](#æ’ä»¶plugin)
- [Tasker](#tasker)
- [Webæ§åˆ¶å°](#webæ§åˆ¶å°)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)

---

## HTTP API æ¨¡å—

system-Core æä¾›äº†10ä¸ªHTTP APIæ¨¡å—ï¼Œè¦†ç›–ç³»ç»Ÿç®¡ç†çš„å„ä¸ªæ–¹é¢ï¼š

### 1. æ ¸å¿ƒç³»ç»ŸAPI (`core.js`)

**ä¼˜å…ˆçº§**: 200

æä¾›ç³»ç»ŸçŠ¶æ€ã€æ¦‚è§ˆã€å¥åº·æ£€æŸ¥ç­‰åŸºç¡€åŠŸèƒ½ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | æŸ¥è¯¢å‚æ•° |
|------|------|------|----------|
| `/api/system/status` | GET | è·å–ç³»ç»ŸçŠ¶æ€è¯¦ç»†ä¿¡æ¯ | `hist` / `withHistory` - åŒ…å«24å°æ—¶å†å²æ•°æ® |
| `/api/system/overview` | GET | è·å–ç³»ç»Ÿæ¦‚è§ˆï¼ˆä»ªè¡¨ç›˜æ•°æ®ï¼‰ | `hist` / `withHistory` - åŒ…å«å†å²ç½‘ç»œæ•°æ® |
| `/api/status` | GET | è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼ˆç®€åŒ–ç‰ˆï¼‰ | - |
| `/api/config` | GET | è·å–ç³»ç»Ÿé…ç½®ä¿¡æ¯ | - |
| `/api/health` | GET | å¥åº·æ£€æŸ¥ï¼ˆæ£€æŸ¥å„æœåŠ¡çŠ¶æ€ï¼‰ | - |

**ç‰¹æ€§**ï¼š
- å®æ—¶ç³»ç»Ÿç›‘æ§ï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œæµé‡ï¼‰
- 24å°æ—¶å†å²æ•°æ®ç»Ÿè®¡
- ç½‘ç»œæµé‡é‡‡æ ·ï¼ˆWindows/Linux/macOS è·¨å¹³å°ï¼‰
- è¿›ç¨‹ç›‘æ§ï¼ˆTop 5 è¿›ç¨‹ï¼‰
- å·¥ä½œæµå’Œæœºå™¨äººçŠ¶æ€ç»Ÿè®¡

### 2. æœºå™¨äººç®¡ç†API (`bot.js`)

**ä¼˜å…ˆçº§**: 100

æä¾›æœºå™¨äººçŠ¶æ€æŸ¥è¯¢ã€æ¶ˆæ¯å‘é€ã€å¥½å‹ç¾¤ç»„åˆ—è¡¨ç­‰åŠŸèƒ½ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/bots` | GET | è·å–æ‰€æœ‰æœºå™¨äººåˆ—è¡¨ | `includeDevices` - æ˜¯å¦åŒ…å«è®¾å¤‡ |
| `/api/bot/:uin/friends` | GET | è·å–æŒ‡å®šæœºå™¨äººçš„å¥½å‹åˆ—è¡¨ | `uin` - æœºå™¨äººQQå· |
| `/api/bot/:uin/groups` | GET | è·å–æŒ‡å®šæœºå™¨äººçš„ç¾¤ç»„åˆ—è¡¨ | `uin` - æœºå™¨äººQQå· |
| `/api/message/send` | POST | å‘é€æ¶ˆæ¯ï¼ˆç§èŠ/ç¾¤èŠï¼‰ | `bot_id`, `type`, `target_id`, `message` |
| `/api/bot/:uin/control` | POST | æ§åˆ¶æœºå™¨äººï¼ˆå¼€æœº/å…³æœºï¼‰ | `uin` - æœºå™¨äººQQå·, `action` - æ“ä½œç±»å‹ |

**ç‰¹æ€§**ï¼š
- æ”¯æŒå¤šæœºå™¨äººç®¡ç†
- æ¶ˆæ¯å‘é€æ”¯æŒæ–‡æœ¬å’Œæ¶ˆæ¯æ®µæ•°ç»„
- æœºå™¨äººæ§åˆ¶ï¼ˆé€šè¿‡Rediså®ç°ï¼‰

### 3. é…ç½®ç®¡ç†API (`config.js`)

**ä¼˜å…ˆçº§**: 85

æä¾›ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶è¯»å†™æ¥å£ï¼Œæ”¯æŒè¡¨å•å’ŒJSONåŒæ¨¡å¼ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/config/list` | GET | è·å–æ‰€æœ‰é…ç½®åˆ—è¡¨ | - |
| `/api/config/:name/structure` | GET | è·å–é…ç½®ç»“æ„ï¼ˆSchemaï¼‰ | `name` - é…ç½®åç§° |
| `/api/config/:name/flat-structure` | GET | è·å–æ‰å¹³åŒ–é…ç½®ç»“æ„ | `name`, `path` - å­é…ç½®è·¯å¾„ |
| `/api/config/:name/flat` | GET | è·å–æ‰å¹³åŒ–é…ç½®æ•°æ® | `name`, `path` - å­é…ç½®è·¯å¾„ |
| `/api/config/:name/batch-set` | POST | æ‰¹é‡è®¾ç½®é…ç½®ï¼ˆæ‰å¹³åŒ–ï¼‰ | `name`, `flat`, `path`, `backup`, `validate` |
| `/api/config/:name/read` | GET | è¯»å–é…ç½® | `name`, `path` - å­é…ç½®è·¯å¾„ |
| `/api/config/:name/write` | POST | å†™å…¥é…ç½® | `name`, `data`, `path`, `backup`, `validate` |
| `/api/config/:name/validate` | POST | éªŒè¯é…ç½® | `name`, `data`, `path` |
| `/api/config/:name/backup` | POST | å¤‡ä»½é…ç½® | `name`, `path` |
| `/api/config/:name/reset` | POST | é‡ç½®é…ç½® | `name`, `path` |
| `/api/config/clear-cache` | POST | æ¸…é™¤é…ç½®ç¼“å­˜ | - |

**ç‰¹æ€§**ï¼š
- æ”¯æŒSystemConfigå­é…ç½®ï¼ˆé€šè¿‡`path`å‚æ•°ï¼‰
- æ‰å¹³åŒ–ç»“æ„ï¼ˆå‡å°‘å‰ç«¯åµŒå¥—æ“ä½œï¼‰
- è‡ªåŠ¨å¤‡ä»½å’ŒéªŒè¯
- é…ç½®ç¼“å­˜ç®¡ç†

### 4. æ–‡ä»¶ç®¡ç†API (`files.js`)

**ä¼˜å…ˆçº§**: 95

æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆç­‰åŠŸèƒ½ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/file/upload` | POST | ä¸Šä¼ æ–‡ä»¶ | `multipart/form-data` |
| `/api/file/:id` | GET | è·å–æ–‡ä»¶ï¼ˆé¢„è§ˆ/ä¸‹è½½ï¼‰ | `id` - æ–‡ä»¶ID, `download` - æ˜¯å¦ä¸‹è½½ |
| `/api/file/:id` | DELETE | åˆ é™¤æ–‡ä»¶ | `id` - æ–‡ä»¶ID |
| `/api/files` | GET | è·å–æ–‡ä»¶åˆ—è¡¨ | - |

**ç‰¹æ€§**ï¼š
- æ”¯æŒ`multipart/form-data`æ ¼å¼ä¸Šä¼ 
- æ–‡ä»¶IDæ˜ å°„ï¼ˆULIDï¼‰
- è‡ªåŠ¨åˆ†ç±»ï¼ˆuploads/mediaï¼‰
- è·¯å¾„éªŒè¯å’Œå®‰å…¨æ£€æŸ¥

### 5. æ’ä»¶ç®¡ç†API (`plugin.js`)

**ä¼˜å…ˆçº§**: 80

æä¾›æ’ä»¶åˆ—è¡¨æŸ¥è¯¢ã€é‡è½½ã€ä»»åŠ¡ç®¡ç†ç­‰åŠŸèƒ½ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/plugins` | GET | è·å–æ’ä»¶åˆ—è¡¨ | - |
| `/api/plugins/summary` | GET | è·å–æ’ä»¶ç»Ÿè®¡æ‘˜è¦ | - |
| `/api/plugin/:key/reload` | POST | é‡è½½æŒ‡å®šæ’ä»¶ | `key` - æ’ä»¶key |
| `/api/plugins/tasks` | GET | è·å–æ’ä»¶å®šæ—¶ä»»åŠ¡åˆ—è¡¨ | - |
| `/api/plugins/stats` | GET | è·å–æ’ä»¶ç»Ÿè®¡ä¿¡æ¯ | - |

**ç‰¹æ€§**ï¼š
- æ’ä»¶çƒ­é‡è½½
- å®šæ—¶ä»»åŠ¡ç®¡ç†
- æ’ä»¶ç»Ÿè®¡ï¼ˆåŠ è½½æ—¶é—´ã€è§„åˆ™æ•°é‡ç­‰ï¼‰

### 6. AIæœåŠ¡API (`ai.js`)

**ä¼˜å…ˆçº§**: 80

æä¾› AI èŠå¤©æ¥å£å’Œå·¥ä½œæµè°ƒç”¨ï¼Œè¯¦è§ [å·¥å‚ç³»ç»Ÿæ–‡æ¡£](factory.md#ai-http-api-è·¯ç”±)ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/v3/chat/completions` | POST | OpenAI å…¼å®¹çš„èŠå¤©æ¥å£ï¼ˆæ”¯æŒ JSON ä¸ multipart/form-dataï¼Œå¤šæ¨¡æ€ + å·¥å…·è°ƒç”¨ï¼‰ |
| `/api/v3/models` | GET | è·å–æ¨¡å‹åˆ—è¡¨ï¼ˆOpenAI æ ¼å¼ï¼‰ |
| `/api/ai/models` | GET | è·å–æ¨¡å‹å’Œå·¥ä½œæµåˆ—è¡¨ï¼ˆä»…æš´éœ²â€œå¸¦ MCP å·¥å…·â€çš„åŸºç¡€å·¥ä½œæµï¼Œä¾›å‰ç«¯å¤šé€‰ï¼‰ |
| `/api/ai/stream` | GET | SSE æµå¼è¾“å‡ºï¼ˆä½¿ç”¨å·¥ä½œæµç³»ç»Ÿï¼‰ |

> `/api/v3/chat/completions` ä¼šæŠŠå‰ç«¯é€‰æ‹©çš„ã€Œå¸¦ MCP å·¥å…·çš„å·¥ä½œæµã€æ•´ç†ä¸º `streams` ç™½åå•ï¼Œå¹¶é€ä¼ ç»™ LLM å·¥å‚å’Œ MCP å·¥å…·é€‚é…å™¨ï¼Œç¡®ä¿åªæœ‰è¿™äº›å·¥ä½œæµä¸‹çš„ MCP å·¥å…·ä¼šè¢«æ³¨å…¥å’Œè°ƒç”¨ï¼Œé¿å…â€œæœªåœ¨æ¥å£ä¸­å£°æ˜çš„å·¥å…·â€è¢«æ„å¤–ä½¿ç”¨ã€‚

### 7. MCPæœåŠ¡API (`mcp.js`)

**ä¼˜å…ˆçº§**: 100

æä¾›MCPå·¥å…·è°ƒç”¨æ¥å£ï¼Œè¯¦è§ [MCPå®Œæ•´æŒ‡å—](mcp-guide.md)ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/mcp/jsonrpc` | POST | JSON-RPCæ ‡å‡†æ¥å£ |
| `/api/mcp/jsonrpc/:stream` | POST | æŒ‰å·¥ä½œæµè¿‡æ»¤çš„JSON-RPC |
| `/api/mcp/tools` | GET | è·å–å·¥å…·åˆ—è¡¨ |
| `/api/mcp/tools/streams` | GET | è·å–å·¥ä½œæµåˆ†ç»„ |
| `/api/mcp/tools/stream/:streamName` | GET | è·å–æŒ‡å®šå·¥ä½œæµçš„å·¥å…· |
| `/api/mcp/tools/call` | POST | è°ƒç”¨MCPå·¥å…· |
| `/api/mcp/tools/:name` | GET | è·å–å•ä¸ªå·¥å…·è¯¦æƒ… |
| `/api/mcp/resources` | GET | è·å–èµ„æºåˆ—è¡¨ |
| `/api/mcp/resources/:uri` | GET | è·å–èµ„æºå†…å®¹ |
| `/api/mcp/prompts` | GET | è·å–æç¤ºè¯åˆ—è¡¨ |
| `/api/mcp/prompts/:name` | POST | è·å–æç¤ºè¯å†…å®¹ |
| `/api/mcp/connect` | GET | SSEè¿æ¥ |
| `/api/mcp/health` | GET | å¥åº·æ£€æŸ¥ |

### 8. è®¾å¤‡ç®¡ç†API (`device.js`)

**ä¼˜å…ˆçº§**: 90

æä¾›è®¾å¤‡æ³¨å†Œã€AIäº¤äº’ã€ASR/TTSä¼šè¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/device/register` | POST | æ³¨å†Œè®¾å¤‡ | `device_id`, `name`, `type`ç­‰ |
| `/api/device/:deviceId/ai` | POST | è®¾å¤‡AIäº¤äº’ | `deviceId`, `text`, `workflow`, `persona`, `profile` |
| `/api/devices` | GET | è·å–è®¾å¤‡åˆ—è¡¨ | - |
| `/api/device/:deviceId` | GET | è·å–è®¾å¤‡è¯¦æƒ… | `deviceId` |
| `/api/device/:deviceId/asr/sessions` | GET | è·å–ASRä¼šè¯åˆ—è¡¨ | `deviceId` |
| `/api/device/:deviceId/asr/recordings` | GET | è·å–å½•éŸ³æ–‡ä»¶åˆ—è¡¨ | `deviceId` |
| `/api/device/file/:fileId` | GET | è·å–è®¾å¤‡æ–‡ä»¶ | `fileId` - base64urlç¼–ç çš„æ–‡ä»¶è·¯å¾„ |
| `/api/trash/*` | GET | è·å–å›æ”¶ç«™æ–‡ä»¶ | æ–‡ä»¶è·¯å¾„ |

**ç‰¹æ€§**ï¼š
- è®¾å¤‡æ³¨å†Œå’Œç®¡ç†
- è¿ç»­å¯¹è¯æ”¯æŒ
- ASR/TTSä¼šè¯ç®¡ç†
- éŸ³é¢‘æ–‡ä»¶ç®¡ç†

### 9. æ ‡å‡†è¾“å…¥API (`stdin.js`)

**ä¼˜å…ˆçº§**: 85

æä¾›å‘½ä»¤æ‰§è¡Œå’Œäº‹ä»¶è§¦å‘åŠŸèƒ½ã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/stdin/status` | GET | è·å–stdinçŠ¶æ€ | - |
| `/api/stdin/command` | POST | å‘é€å‘½ä»¤ | `command`, `user_info`, `json`, `timeout` |
| `/api/stdin/event` | POST | è§¦å‘äº‹ä»¶ | `event_type`, `content`, `user_info`, `json`, `timeout` |

**WebSocket**: `/stdin` - ç›‘å¬stdinå‘½ä»¤å’Œè¾“å‡º

**ç‰¹æ€§**ï¼š
- å‘½ä»¤æ‰§è¡Œï¼ˆæ”¯æŒ JSON ç»“æ„åŒ–å“åº”ï¼‰
- äº‹ä»¶è§¦å‘ï¼ˆå¯ç›´æ¥å‘ `PluginsLoader` åŠå„ Tasker æ´¾å‘æ ‡å‡†äº‹ä»¶ï¼‰
- WebSocket å®æ—¶é€šä¿¡ï¼ˆè®¢é˜… stdin å‘½ä»¤ä¸è¾“å‡ºï¼‰

#### stdin ç”¨æˆ·ä¸ä¼šè¯æ¨¡å‹

stdin ä½“ç³»ç”± **Tasker + HTTP API + å¢å¼ºæ’ä»¶** å…±åŒç»„æˆï¼š

- **è™šæ‹Ÿ Bot æ³¨å†Œ**ï¼ˆ`core/system-Core/tasker/stdin.js`ï¼‰  
  - å¯åŠ¨æ—¶æ„é€ ä¸€ä¸ªå†…ç½® Botï¼š`Bot.stdin` / `Bot['stdin']`ï¼Œè´¦å·å›ºå®šä¸º `uin = 'stdin'`ï¼Œæ˜µç§°é»˜è®¤ä¸º `StdinBot`ã€‚  
  - è¯¥ Bot æä¾› `sendMsg/runCommand/pickFriend/pickGroup/fileToUrl` ç­‰æ–¹æ³•ï¼Œä½¿æ§åˆ¶å°/HTTP è¯·æ±‚ä¸æ™®é€š QQ/è®¾å¤‡æ¶ˆæ¯åœ¨æ’ä»¶å±‚è¡¨ç°ä¸€è‡´ã€‚
- **ç”¨æˆ·èº«ä»½ä¸æ³¨å†Œæ–¹å¼**ï¼š  
  - æ§åˆ¶å°è¾“å…¥ï¼š`StdinHandler.createEvent()` é»˜è®¤ä½¿ç”¨ `user_id = 'stdin'`ã€`nickname = 'stdin'`ï¼Œå¹¶å°† `role` è®¾ä¸º `master`ï¼Œç­‰ä»·äºã€Œæœ¬æœºè¶…çº§ç®¡ç†å‘˜ã€ã€‚  
  - HTTP æ¥å£ï¼š  
    - `/api/stdin/command` ä¸ `/api/stdin/event` æ¥æ”¶ `user_info` å‚æ•°ï¼ˆ`user_id/nickname/group_id/role/avatar` ç­‰ï¼‰ï¼Œç”±åç«¯ä¼ å…¥ `createEvent()`ï¼ŒåŠ¨æ€æ³¨å†Œ/æ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·æˆ–ç¾¤æˆå‘˜ã€‚  
    - è‹¥ä¸ä¼  `user_info`ï¼Œåˆ™åŒæ ·é»˜è®¤è§†ä¸º `master` èº«ä»½ï¼Œæ–¹ä¾¿è„šæœ¬è°ƒç”¨ã€‚  
  - äº‹ä»¶å¢å¼ºï¼š`StdinEnhancer` æ’ä»¶åŸºäº `EventNormalizer` ç»Ÿä¸€è¡¥é½ `isStdin/tasker/logText` ç­‰å­—æ®µï¼Œä½¿æ‰€æœ‰ stdin/API äº‹ä»¶åœ¨æ’ä»¶ä¸šåŠ¡å±‚è¡¨ç°ä¸ºæ ‡å‡†åŒ–äº‹ä»¶å¯¹è±¡ã€‚

> é€šè¿‡ä¸Šè¿°è®¾è®¡ï¼Œ**stdin ç”¨æˆ·ä¸éœ€è¦åœ¨æ•°æ®åº“å•ç‹¬æ³¨å†Œ**ï¼š  
> æ§åˆ¶å°ä¸ HTTP è¯·æ±‚ä¼šåœ¨ Tasker å±‚å³æ—¶æ„é€ äº‹ä»¶å’Œè™šæ‹Ÿç”¨æˆ·ï¼Œå¹¶åœ¨æ’ä»¶å±‚ä»¥ç»Ÿä¸€æ–¹å¼å¤„ç†ã€‚

### 10. æ•°æ®ç¼–è¾‘API (`write.js`)

**ä¼˜å…ˆçº§**: 75

æ”¯æŒJSONå’ŒYAMLæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/data/read` | GET | è¯»å–æ–‡ä»¶ | `filePath`, `encoding` |
| `/api/data/write` | POST | å†™å…¥æ–‡ä»¶ | `filePath`, `data`, `format`, `backup` |

**ç‰¹æ€§**ï¼š
- æ”¯æŒJSONå’ŒYAMLæ ¼å¼
- è‡ªåŠ¨å¤‡ä»½
- è·¯å¾„éªŒè¯å’Œå®‰å…¨æ£€æŸ¥

---

## å·¥ä½œæµï¼ˆStreamï¼‰

system-Core æä¾›äº†6ä¸ªå·¥ä½œæµï¼Œå…±53ä¸ªMCPå·¥å…·ï¼š

```mermaid
flowchart TB
    subgraph Streams["ğŸŒŠ å·¥ä½œæµç³»ç»Ÿ"]
        Chat["ğŸ’¬ chatå·¥ä½œæµ<br/>24ä¸ªMCPå·¥å…·"]
        Desktop["ğŸ–¥ï¸ desktopå·¥ä½œæµ<br/>17ä¸ªMCPå·¥å…·"]
        Tools["ğŸ”§ toolså·¥ä½œæµ<br/>4ä¸ªMCPå·¥å…·"]
        Memory["ğŸ§  memoryå·¥ä½œæµ<br/>4ä¸ªMCPå·¥å…·"]
        Database["ğŸ“š databaseå·¥ä½œæµ<br/>4ä¸ªMCPå·¥å…·"]
        Device["ğŸ“± deviceå·¥ä½œæµ<br/>è®¾å¤‡AIäº¤äº’"]
    end
    
    style Streams fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    style Chat fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    style Desktop fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    style Tools fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    style Memory fill:#E1F5FE,stroke:#0277BD,stroke-width:2px
    style Database fill:#E0F2F1,stroke:#00695C,stroke-width:2px
    style Device fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
```

### 1. chat å·¥ä½œæµ

**æ–‡ä»¶**: `core/system-Core/stream/chat.js`  
**ä¼˜å…ˆçº§**: 10  
**MCPå·¥å…·æ•°**: 24ä¸ª

**åŠŸèƒ½åˆ†ç±»**ï¼š
- **äº’åŠ¨åŠŸèƒ½**ï¼š`at`ã€`poke`ã€`reply`ã€`emojiReaction`ã€`thumbUp`ã€`sign`
- **ç¾¤ç®¡ç†**ï¼š`mute`/`unmute`ã€`muteAll`/`unmuteAll`ã€`setCard`ã€`setGroupName`
- **æƒé™ç®¡ç†**ï¼š`setAdmin`/`unsetAdmin`ã€`setTitle`ã€`kick`
- **æ¶ˆæ¯ç®¡ç†**ï¼š`setEssence`/`removeEssence`ã€`announce`ã€`recall`ã€`setGroupTodo`
- **ä¿¡æ¯æŸ¥è¯¢**ï¼š`getGroupInfoEx`ã€`getAtAllRemain`ã€`getBanList`

**ç‰¹æ€§**ï¼š
- âœ… æ”¯æŒè¡¨æƒ…åŒ…å’Œè¡¨æƒ…å›åº”
- âœ… å®Œæ•´çš„ç¾¤ç®¡ç†åŠŸèƒ½
- âœ… æ¶ˆæ¯å†å²ç¼“å­˜ï¼ˆ5åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// åœ¨æ’ä»¶ä¸­è°ƒç”¨ chat å·¥ä½œæµçš„ MCP å·¥å…·
const stream = await this.getStream('chat');
// é€šè¿‡ MCP å·¥å…·è°ƒç”¨ç¾¤ç®¡ç†åŠŸèƒ½
// ä¾‹å¦‚ï¼šatã€muteã€setAdmin ç­‰
```

### 2. desktop å·¥ä½œæµ

**æ–‡ä»¶**: `core/system-Core/stream/desktop.js`  
**ä¼˜å…ˆçº§**: 100  
**MCPå·¥å…·æ•°**: 17ä¸ª

**åŠŸèƒ½åˆ†ç±»**ï¼š
- **ç³»ç»Ÿæ“ä½œ**ï¼š`show_desktop`ã€`open_system_tool`ã€`lock_screen`ã€`power_control`
- **æ–‡ä»¶æ“ä½œ**ï¼š`create_folder`ã€`open_explorer`ã€`open_application`
- **ç½‘ç»œæ“ä½œ**ï¼š`open_browser`
- **å‘½ä»¤æ‰§è¡Œ**ï¼š`execute_powershell`ã€`cleanup_processes`
- **ä¿¡æ¯è¯»å–**ï¼š`screenshot`ã€`system_info`ã€`disk_space`ã€`list_desktop_files`
- **æ–‡æ¡£ç”Ÿæˆ**ï¼š`create_word_document`ã€`create_excel_document`
- **æ•°æ®æŸ¥è¯¢**ï¼š`stock_quote`

**ç‰¹æ€§**ï¼š
- Windowsç³»ç»Ÿä¼˜åŒ–
- è‡ªåŠ¨è¿›ç¨‹æ¸…ç†ï¼ˆæ¯30ç§’ï¼‰
- å·¥ä½œåŒºï¼šæ¡Œé¢ç›®å½•

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// åœ¨æ’ä»¶ä¸­è°ƒç”¨ desktop å·¥ä½œæµ
const stream = await this.getStream('desktop');
// é€šè¿‡ MCP å·¥å…·è°ƒç”¨æ¡Œé¢æ“ä½œ
// ä¾‹å¦‚ï¼šscreenshotã€open_browserã€execute_powershell ç­‰
```

### 3. tools å·¥ä½œæµ

**æ–‡ä»¶**: `core/system-Core/stream/tools.js`  
**ä¼˜å…ˆçº§**: 200  
**MCPå·¥å…·æ•°**: 4ä¸ª

**å·¥å…·**ï¼š
- `read` - è¯»å–æ–‡ä»¶
- `grep` - æœç´¢æ–‡æœ¬
- `write` - å†™å…¥æ–‡ä»¶
- `run` - æ‰§è¡Œå‘½ä»¤

**ç‰¹æ€§**ï¼š
- åŸºç¡€å·¥å…·é›†
- å·¥ä½œåŒºï¼šæ¡Œé¢ç›®å½•
- æ–‡ä»¶æœç´¢å’Œè‡ªåŠ¨åŒ¹é…

### 4. memory å·¥ä½œæµ

**æ–‡ä»¶**: `core/system-Core/stream/memory.js`  
**ä¼˜å…ˆçº§**: 1  
**MCPå·¥å…·æ•°**: 4ä¸ª

**å·¥å…·**ï¼š
- `query_memory` - æŸ¥è¯¢è®°å¿†
- `save_memory` - ä¿å­˜è®°å¿†
- `list_memories` - åˆ—å‡ºè®°å¿†
- `delete_memory` - åˆ é™¤è®°å¿†

**ç‰¹æ€§**ï¼š
- é•¿æœŸè®°å¿†å­˜å‚¨
- å‘é‡æ£€ç´¢æ”¯æŒ
- è®°å¿†ç›®å½•ï¼š`~/.xrk/memory`

**ä½¿ç”¨åœºæ™¯**ï¼š
- ä¿å­˜ç”¨æˆ·åå¥½å’Œä¹ æƒ¯
- è®°å½•é‡è¦å¯¹è¯å†…å®¹
- è·¨ä¼šè¯ä¿¡æ¯æŒä¹…åŒ–

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// åœ¨æ’ä»¶ä¸­è°ƒç”¨ memory å·¥ä½œæµ
const stream = await this.getStream('memory');
// é€šè¿‡ MCP å·¥å…·ç®¡ç†é•¿æœŸè®°å¿†
// query_memoryã€save_memoryã€list_memoriesã€delete_memory
```

### 5. database å·¥ä½œæµ

**æ–‡ä»¶**: `core/system-Core/stream/database.js`  
**MCPå·¥å…·æ•°**: 4ä¸ª

**å·¥å…·**ï¼š
- `query_knowledge` - æŸ¥è¯¢çŸ¥è¯†
- `save_knowledge` - ä¿å­˜çŸ¥è¯†
- `list_knowledge` - åˆ—å‡ºçŸ¥è¯†åº“
- `delete_knowledge` - åˆ é™¤çŸ¥è¯†

**ç‰¹æ€§**ï¼š
- çŸ¥è¯†åº“ç®¡ç†
- å…³é”®è¯æœç´¢
- å‘é‡æ£€ç´¢æ”¯æŒ

**ä½¿ç”¨åœºæ™¯**ï¼š
- ä¼ä¸šçŸ¥è¯†åº“ç®¡ç†
- æ–‡æ¡£æ£€ç´¢å’Œé—®ç­”
- ä¸“ä¸šçŸ¥è¯†å­˜å‚¨

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// åœ¨æ’ä»¶ä¸­è°ƒç”¨ database å·¥ä½œæµ
const stream = await this.getStream('database');
// é€šè¿‡ MCP å·¥å…·ç®¡ç†çŸ¥è¯†åº“
// query_knowledgeã€save_knowledgeã€list_knowledgeã€delete_knowledge
```

### 6. device å·¥ä½œæµ

**æ–‡ä»¶**: `core/system-Core/stream/device.js`  
**ä¼˜å…ˆçº§**: 50

**ç‰¹æ€§**ï¼š
- è®¾å¤‡AIäº¤äº’
- ASR/TTSé›†æˆ
- è¿ç»­å¯¹è¯æ”¯æŒ

---

## æ’ä»¶ï¼ˆPluginï¼‰

system-Core æä¾›äº†ä¸€ç»„å†…ç½®æ’ä»¶ï¼Œåˆ†åˆ«æ‰¿æ‹…ã€Œåè®®å¢å¼ºã€ä¸ã€Œè¿ç»´/ç®¡ç†/ç¤ºä¾‹ä¸šåŠ¡ã€ç­‰èŒè´£ï¼š

```mermaid
flowchart LR
    subgraph Plugins["ğŸ”Œ æ’ä»¶ï¼ˆPluginï¼‰"]
        direction TB
        Enhancers["ğŸ”§ å¢å¼ºå™¨æ’ä»¶<br/>OneBotEnhancer<br/>OPQEnhancer<br/>DeviceEnhancer<br/>StdinEnhancer"]
        Functions["âš™ï¸ åŠŸèƒ½æ’ä»¶<br/>add/restart/update<br/>sendLog/çŠ¶æ€<br/>è¿œç¨‹æŒ‡ä»¤<br/>ä¸»åŠ¨å¤è¯»<br/>æ¨¡æ‹Ÿå®šæ—¶è¾“å…¥"]
    end
    
    style Plugins fill:#4A90E2,stroke:#2E5C8A,stroke-width:2px,color:#fff
    style Enhancers fill:#50C878,stroke:#3FA060,stroke-width:2px,color:#fff
    style Functions fill:#FFA500,stroke:#CC8400,stroke-width:2px,color:#fff
```

### å¢å¼ºå™¨æ’ä»¶ï¼ˆåè®®/äº‹ä»¶å¢å¼ºï¼‰

- **OneBotEnhancer**  
  - OneBotv11 äº‹ä»¶å¢å¼ºæ’ä»¶ï¼ˆä½äº `core/system-Core/plugin/OneBotEnhancer.js`ï¼‰  
  - è´Ÿè´£ä¸º OneBot äº‹ä»¶æŒ‚è½½ `isOneBot/isPrivate/isGroup/friend/group/member` ç­‰å±æ€§ï¼Œå¹¶ç»Ÿä¸€æ—¥å¿—æ ¼å¼ã€åˆ«åä¸ onlyReplyAt ç­–ç•¥ã€‚
- **OPQEnhancer**  
  - OPQ åè®®å¢å¼ºæ’ä»¶ï¼Œè¡¥é½ OPQ äº‹ä»¶çš„ Tasker ç‰¹å®šå­—æ®µä¸æ—¥å¿—æ–‡æœ¬ã€‚
- **DeviceEnhancer**  
  - è®¾å¤‡äº‹ä»¶å¢å¼ºæ’ä»¶ï¼ˆ`DeviceEnhancer.js`ï¼‰ï¼Œä½¿ç”¨ `EventNormalizer.normalizeDevice` æ ‡å‡†åŒ–è®¾å¤‡äº‹ä»¶å­—æ®µï¼Œå¹¶ç»Ÿä¸€ `isDevice/tasker/logText` ç­‰å±æ€§ã€‚
- **StdinEnhancer**  
  - STDIN/API äº‹ä»¶å¢å¼ºæ’ä»¶ï¼ˆ`StdinEnhancer.js`ï¼‰ï¼Œä½¿ç”¨ `EventNormalizer.normalizeStdin` æ ‡å‡†åŒ–ä»æ§åˆ¶å°æˆ– `/api/stdin/*` è¿›å…¥çš„äº‹ä»¶ï¼Œç»Ÿä¸€ `isStdin/tasker` æ ‡è®°å’Œæ—¥å¿—ã€‚

> å¢å¼ºå™¨æ’ä»¶æœ¬èº«**ä¸ç›´æ¥å®ç°ä¸šåŠ¡å‘½ä»¤**ï¼Œè€Œæ˜¯ä¸ºåç»­æ‰€æœ‰ä¸šåŠ¡æ’ä»¶æä¾›ã€Œæ›´å¹²å‡€ã€ä¸€è‡´çš„äº‹ä»¶å¯¹è±¡ã€ã€‚

### åŠŸèƒ½æ’ä»¶ï¼ˆè¿ç»´ä¸ç¤ºä¾‹ä¸šåŠ¡ï¼‰

- **add** (`add.js`)  
  - æ¶ˆæ¯æ¨¡æ¿ä¸è¿ç¦è¯ç®¡ç†æ’ä»¶ï¼šæ”¯æŒ `#æ·»åŠ /#åˆ é™¤` æ¶ˆæ¯ã€`#è¿ç¦è¯` å¢åˆ æŸ¥ã€å…¨å±€/ç¾¤çº§ç²¾ç¡®ä¸æ¨¡ç³Šè¿ç¦è¯ã€å›¾ç‰‡è¿ç¦è¯ï¼Œä»¥åŠè¿ç¦è¯å¼€å…³ã€ç¦è¨€ç­–ç•¥ç­‰ã€‚
- **restart** (`restart.js`)  
  - è¿›ç¨‹çº§é‡å¯ä¸å¯åœæ’ä»¶ï¼šæä¾› `#é‡å¯/#å…³æœº/#å¼€æœº` å‘½ä»¤ï¼Œé€šè¿‡ Redis è®°å½•é‡å¯ä¸Šä¸‹æ–‡ä¸å…³æœºæ ‡è®°ï¼Œå¹¶åœ¨éœ€è¦æ—¶è°ƒç”¨ `process.exit(1)` è§¦å‘å®ˆæŠ¤è¿›ç¨‹é‡å¯ã€‚
- **update** (`update.js`)  
  - é¡¹ç›®ä¸ Core æ›´æ–°æ’ä»¶ï¼šæ”¯æŒ `#æ›´æ–°/#å¼ºåˆ¶æ›´æ–°` æŒ‡å®š Core æˆ–æ•´ä»“åº“ï¼Œ`#å…¨éƒ¨æ›´æ–°/#é™é»˜å…¨éƒ¨æ›´æ–°` æ‰¹é‡æ›´æ–° `core/*` ä¸é¡¹ç›®æ ¹ç›®å½•ï¼Œè‡ªåŠ¨æ‹‰å– Git æ—¥å¿—å¹¶åœ¨æ›´æ–°åè”åŠ¨ `restart` æ’ä»¶é‡å¯ã€‚
- **sendLog** (`sendLog.js`)  
  - è¿è¡Œæ—¥å¿—å‘é€æ’ä»¶ï¼šé€šè¿‡ `#æ—¥å¿—/#é”™è¯¯æ—¥å¿—/#è¿½è¸ªæ—¥å¿—/#debugæ—¥å¿—` ç­‰å‘½ä»¤ï¼ŒæŒ‰çº§åˆ«/å…³é”®è¯ç­›é€‰æœ€è¿‘æ—¥å¿—æ–‡ä»¶ï¼Œåˆ†æ‰¹ç”Ÿæˆè½¬å‘æ¶ˆæ¯å‘åˆ°ç¾¤/ç§èŠï¼Œæ”¯æŒé€šè¿‡é…ç½®è°ƒæ•´æ¯æ‰¹è¡Œæ•°ã€æ€»è¡Œæ•°ä¸å•è¡Œæœ€å¤§é•¿åº¦ã€‚
- **çŠ¶æ€**ï¼ˆ`çŠ¶æ€.js`ï¼Œç±»å `stattools`ï¼‰  
  - ç³»ç»ŸçŠ¶æ€æŸ¥è¯¢æ’ä»¶ï¼š`#çŠ¶æ€` æŸ¥çœ‹ CPU/å†…å­˜/ç£ç›˜ã€è¿›ç¨‹ã€ç½‘ç»œä¿¡æ¯ï¼Œä»¥åŠ Bot è¿è¡Œæ—¶é•¿ã€æ’ä»¶/å®šæ—¶ä»»åŠ¡æ•°é‡ã€æ—¥å¿—é…ç½®ç­‰ï¼ˆå†…éƒ¨ä½¿ç”¨ `systeminformation` åº“æ”¶é›†æ•°æ®ï¼‰ã€‚
- **è¿œç¨‹æŒ‡ä»¤** (`è¿œç¨‹æŒ‡ä»¤.js`)  
  - è¿œç¨‹å‘½ä»¤ä¸è°ƒè¯•ç»ˆç«¯æ’ä»¶ï¼šåŸºäº `config/cmd/tools.yaml` æƒé™é…ç½®ï¼Œæä¾›å®‰å…¨åŒ…è£¹çš„å‘½ä»¤æ‰§è¡Œã€JS è°ƒè¯•ã€è¾“å‡ºæˆªæ–­ä¸è½ç›˜ç­‰èƒ½åŠ›ï¼Œå±äºé«˜æƒé™ã€Œè¿œç¨‹è¿ç»´å·¥å…·ã€ã€‚
- **ä¸»åŠ¨å¤è¯»** (`ä¸»åŠ¨å¤è¯».js`)  
  - å¤è¯»ç¤ºä¾‹æ’ä»¶ï¼š`#å¤è¯»` åè¿›å…¥ä¸Šä¸‹æ–‡ï¼Œä¸‹ä¸€æ¡æ¶ˆæ¯ä¼šè¢«å®Œæ•´å¤è¯»å¹¶åœ¨æŒ‡å®šæ—¶é—´åè‡ªåŠ¨æ’¤å›ï¼Œæ¼”ç¤º `setContext/finish` çš„å…¸å‹ç”¨æ³•ã€‚
- **æ¨¡æ‹Ÿå®šæ—¶è¾“å…¥** (`æ¨¡æ‹Ÿå®šæ—¶è¾“å…¥.js`)  
  - å®šæ—¶ STDIN æ¨¡æ‹Ÿæ’ä»¶ï¼šæ¯å¤©å›ºå®šæ—¶é—´ï¼ˆå¦‚ 12:00ï¼‰æ„é€ æ¨¡æ‹Ÿ `stdin` äº‹ä»¶ï¼Œé€šè¿‡ `PluginsLoader.deal()` è§¦å‘æ’ä»¶ç³»ç»Ÿæ‰§è¡Œé¢„è®¾å‘½ä»¤ï¼ˆä¾‹å¦‚ `#ä½ æ˜¯è°`ï¼‰ï¼Œç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•å®šæ—¶ä»»åŠ¡ + ä¸šåŠ¡é“¾è·¯ã€‚

> ä»¥ä¸ŠåŠŸèƒ½æ’ä»¶å‡æ„å»ºåœ¨ `plugin` åŸºç±»ä¸ `PluginsLoader` ä¹‹ä¸Šï¼Œ**ä¸ä¿®æ”¹åº•å±‚åŸºç¡€è®¾æ–½ä»£ç **ï¼›ä½ å¯ä»¥åœ¨ `core/system-Core/plugin/` ä¸­å‚è€ƒè¿™äº›å®ç°ï¼Œç¼–å†™è‡ªå·±çš„ä¸šåŠ¡æ’ä»¶ã€‚

---

## ä¸šåŠ¡å±‚ä¸æ’ä»¶æ¶æ„

åœ¨ `system-Core` ä¸­ï¼Œ**ç»å¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘éƒ½é€šè¿‡æ’ä»¶ä¸šåŠ¡å±‚å®ç°**ï¼Œè€Œä¸æ˜¯å†™åœ¨åº•å±‚åŸºç¡€è®¾æ–½é‡Œï¼š

- **ä¸šåŠ¡æ‰¿è½½ä½ç½®**ï¼š
  - `core/system-Core/plugin/*.js`ï¼šå…·ä½“ä¸šåŠ¡æ’ä»¶ï¼ˆå‘½ä»¤ã€ç®¡ç†åŠŸèƒ½ã€æ—¥å¿—ã€çŠ¶æ€æŸ¥è¯¢ç­‰ï¼‰
  - `src/infrastructure/plugins/plugin.js`ï¼šæ’ä»¶åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€çš„ä¸šåŠ¡æ¥å£ï¼ˆè§„åˆ™ã€ä»»åŠ¡ã€äº‹ä»¶è®¢é˜…ã€ä¸Šä¸‹æ–‡ã€å·¥ä½œæµé›†æˆç­‰ï¼‰
  - `src/infrastructure/plugins/loader.js`ï¼š`PluginsLoader`ï¼Œä½œä¸ºæ’ä»¶ä¸šåŠ¡å±‚çš„è°ƒåº¦æ ¸å¿ƒ
- **åˆ†å±‚å…³ç³»ï¼ˆè‡ªä¸‹è€Œä¸Šï¼‰**ï¼š
  1. **Tasker å±‚**ï¼ˆå¦‚ `core/system-Core/tasker/OneBotv11.js`ï¼‰å°†å¹³å°æ¶ˆæ¯è½¬æ¢ä¸ºç»Ÿä¸€äº‹ä»¶
  2. **äº‹ä»¶ç›‘å¬å±‚**ï¼ˆ`core/system-Core/events/*.js`ï¼‰å»é‡å¹¶åˆ†å‘åˆ°æ’ä»¶ç³»ç»Ÿ
  3. **æ’ä»¶ä¸šåŠ¡å±‚**ï¼ˆ`PluginsLoader` + å„ä¸šåŠ¡æ’ä»¶ï¼‰å®Œæˆè§„åˆ™åŒ¹é…ã€æƒé™æ§åˆ¶ã€ä¸Šä¸‹æ–‡ä¸å·¥ä½œæµè°ƒç”¨
  4. **HTTP / Web æ§åˆ¶å°** åªä½œä¸ºå…¥å£å’Œç®¡ç†ç•Œé¢ï¼Œä¸ç›´æ¥æ‰¿è½½ä¸šåŠ¡

### æ’ä»¶ä¸šåŠ¡å±‚èŒè´£æ€»è§ˆ

- **ç»Ÿä¸€äº‹ä»¶å…¥å£**ï¼šæ‰€æœ‰æ¥è‡ª OneBotã€è®¾å¤‡ã€STDIN/API çš„äº‹ä»¶ï¼Œéƒ½ä¼šæœ€ç»ˆè¿›å…¥ `PluginsLoader.deal(e)`ï¼Œåœ¨è¿™é‡Œå®Œæˆæ ‡å‡†åŒ–ã€é¢„æ£€æŸ¥ä¸é™æµã€‚
- **ä¸šåŠ¡è§„åˆ™æ‰§è¡Œ**ï¼š
  - é€šè¿‡æ’ä»¶ `rule` é…ç½®å®ç°å‘½ä»¤/å…³é”®è¯/æ­£åˆ™åŒ¹é…
  - ä½¿ç”¨ `accept(e)` åšå‰ç½®è¿‡æ»¤ï¼ˆå¦‚åˆ«åã€æƒé™ã€æ¥æºç­›é€‰ï¼‰
  - æ”¯æŒæŒ‰ä¼˜å…ˆçº§åˆ†ç»„æ‰§è¡Œã€é»˜è®¤å¤„ç†å™¨ä¸ä¸Šä¸‹æ–‡å›è°ƒ
- **è·¨æ¨¡å—åä½œ**ï¼š
  - æ’ä»¶é€šè¿‡ `getStream()` è°ƒç”¨ AI å·¥ä½œæµï¼ˆchat/desktop/tools/memory/database/deviceï¼‰
  - é€šè¿‡äº‹ä»¶è®¢é˜…æœºåˆ¶ä¸å…¶ä»–æ’ä»¶/Tasker ååŒï¼ˆè¯¦è§ `plugins-loader.md` ä¸ `äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£`ï¼‰
- **è¿è¡Œæ—¶èƒ½åŠ›**ï¼š
  - å†·å´ / èŠ‚æµï¼ˆæŒ‰ç”¨æˆ·ã€ç¾¤ã€è®¾å¤‡ç»´åº¦ï¼‰
  - é»‘ç™½åå•ä¸å“åº”ç­–ç•¥ï¼ˆå¦‚ä»…åœ¨è¢« @ æˆ–å¸¦å‰ç¼€æ—¶å“åº”ï¼‰
  - å®šæ—¶ä»»åŠ¡ï¼ˆåŸºäº `node-schedule`ï¼‰ä¸æ‰§è¡Œç»Ÿè®¡

> **ç»“è®º**ï¼šåœ¨ `system-Core` ä¸­ï¼Œ**â€œä¸šåŠ¡å±‚ = æ’ä»¶ä¸šåŠ¡å±‚ + AI å·¥ä½œæµâ€**ã€‚  
> ä¼˜å…ˆå°†ä¸šåŠ¡å†™æˆæ’ä»¶ + å·¥ä½œæµï¼ŒHTTP ä»…ä½œä¸ºæš´éœ²èƒ½åŠ›ä¸ç®¡ç†å…¥å£ã€‚

æ›´å¤šæ’ä»¶ä¸šåŠ¡å±‚ç»†èŠ‚è¯·å‚è€ƒï¼š

- `docs/plugin-base.md` - æ’ä»¶åŸºç±»ä¸ä¸šåŠ¡æ’ä»¶å¼€å‘
- `docs/plugins-loader.md` - æ’ä»¶åŠ è½½ã€åŒ¹é…ä¸æ‰§è¡Œæµç¨‹
- `docs/äº‹ä»¶ç³»ç»Ÿæ ‡å‡†åŒ–æ–‡æ¡£.md` - äº‹ä»¶å‘½åè§„èŒƒä¸å­—æ®µè´£ä»»è¾¹ç•Œ

---

## Tasker

system-Core æä¾›äº†4ä¸ªTaskerï¼š

```mermaid
flowchart LR
    subgraph Taskers["ğŸ“¡ Taskerï¼ˆä»»åŠ¡å±‚ï¼‰"]
        direction TB
        OneBot["ğŸ“± OneBotv11 Tasker<br/>å®Œæ•´çš„OneBotv11åè®®æ”¯æŒ<br/>æ¶ˆæ¯æ®µè§£æ<br/>äº‹ä»¶æ ‡å‡†åŒ–"]
        GSUID["ğŸ”Œ GSUIDCORE Tasker<br/>GSUIDCOREåè®®æ”¯æŒ<br/>äº‹ä»¶è½¬æ¢"]
        QBQ["ğŸ¤– QBQBot Tasker<br/>QBQBotåè®®æ”¯æŒ<br/>äº‹ä»¶è½¬æ¢"]
        Stdin["âŒ¨ï¸ stdin Tasker<br/>æ ‡å‡†è¾“å…¥å¤„ç†<br/>å‘½ä»¤æ‰§è¡Œ<br/>äº‹ä»¶è§¦å‘"]
    end
    
    style Taskers fill:#4A90E2,stroke:#2E5C8A,stroke-width:2px,color:#fff
    style OneBot fill:#50C878,stroke:#3FA060,stroke-width:2px,color:#fff
    style GSUID fill:#FFA500,stroke:#CC8400,stroke-width:2px,color:#fff
    style QBQ fill:#9B59B6,stroke:#7D3C98,stroke-width:2px,color:#fff
    style Stdin fill:#3498DB,stroke:#2980B9,stroke-width:2px,color:#fff
```

### 1. OneBotv11 Tasker

**æ–‡ä»¶**: `core/system-Core/tasker/OneBotv11.js`

**ç‰¹æ€§**ï¼š
- âœ… å®Œæ•´çš„OneBotv11åè®®æ”¯æŒ
- âœ… æ¶ˆæ¯æ®µè§£æ
- âœ… äº‹ä»¶æ ‡å‡†åŒ–

### 2. GSUIDCORE Tasker

**æ–‡ä»¶**: `core/system-Core/tasker/GSUIDCORE.js`

**ç‰¹æ€§**ï¼š
- âœ… GSUIDCOREåè®®æ”¯æŒ
- âœ… äº‹ä»¶è½¬æ¢
- âœ… ä¸GSUIDCOREæ¡†æ¶æ— ç¼é›†æˆ
- âœ… æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# config/server_config/gsuidcore.yaml
bots:
  - uin: "123456789"
    name: "GSUIDCOREæœºå™¨äºº"
    api_url: "http://127.0.0.1:5700"
```

### 3. QBQBot Tasker

**æ–‡ä»¶**: `core/system-Core/tasker/QBQBot.js`

**ç‰¹æ€§**ï¼š
- âœ… QBQBotåè®®æ”¯æŒ
- âœ… äº‹ä»¶è½¬æ¢
- âœ… ä¸QBQBotæ¡†æ¶é›†æˆ
- âœ… æ”¯æŒHTTP APIè°ƒç”¨

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# config/server_config/qbqbot.yaml
bots:
  - uin: "123456789"
    name: "QBQBotæœºå™¨äºº"
    api_url: "http://127.0.0.1:5700"
```

### 4. stdin Tasker

**æ–‡ä»¶**: `core/system-Core/tasker/stdin.js`

**ç‰¹æ€§**ï¼š
- âœ… æ ‡å‡†è¾“å…¥å¤„ç†
- âœ… å‘½ä»¤æ‰§è¡Œ
- âœ… äº‹ä»¶è§¦å‘
- âœ… è™šæ‹ŸBotæ”¯æŒ
- âœ… HTTP APIé›†æˆ

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ§åˆ¶å°å‘½ä»¤æ‰§è¡Œ
- è„šæœ¬è‡ªåŠ¨åŒ–
- æµ‹è¯•å’Œè°ƒè¯•
- è¿œç¨‹æ§åˆ¶

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# é€šè¿‡HTTP APIå‘é€å‘½ä»¤
curl -X POST http://localhost:8080/api/stdin/command \
  -H "Content-Type: application/json" \
  -d '{
    "command": "#çŠ¶æ€",
    "user_info": {
      "user_id": "admin",
      "nickname": "ç®¡ç†å‘˜",
      "role": "master"
    }
  }'
```

---

## Webæ§åˆ¶å°

**ä½ç½®**: `core/system-Core/www/xrk/`  
**è®¿é—®è·¯å¾„**: `/xrk/`

### åŠŸèƒ½æ¨¡å—

```mermaid
flowchart LR
    subgraph WebConsole["ğŸŒ XRK Webæ§åˆ¶å°"]
        direction TB
        Overview["ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ<br/>å®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æº<br/>æœºå™¨äººçŠ¶æ€<br/>å·¥ä½œæµä¿¡æ¯"]
        AIChat["ğŸ’¬ AIå¯¹è¯<br/>æ–‡æœ¬/è¯­éŸ³/å›¾ç‰‡<br/>å¤šç§äº¤äº’æ–¹å¼"]
        Config["âš™ï¸ é…ç½®ç®¡ç†<br/>å¯è§†åŒ–é…ç½®ç¼–è¾‘<br/>è¡¨å•å’ŒJSONåŒæ¨¡å¼"]
        APIDebug["ğŸ”§ APIè°ƒè¯•<br/>å®Œæ•´çš„APIæµ‹è¯•å·¥å…·<br/>æ”¯æŒæ‰€æœ‰ç³»ç»Ÿæ¥å£"]
    end
    
    style WebConsole fill:#4A90E2,stroke:#2E5C8A,stroke-width:3px,color:#fff
    style Overview fill:#50C878,stroke:#3FA060,stroke-width:2px,color:#fff
    style AIChat fill:#9B59B6,stroke:#7D3C98,stroke-width:2px,color:#fff
    style Config fill:#FFA500,stroke:#CC8400,stroke-width:2px,color:#fff
    style APIDebug fill:#3498DB,stroke:#2980B9,stroke-width:2px,color:#fff
```

**æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ä¸åç«¯èƒ½åŠ›æ˜ å°„**ï¼š

1. **ç³»ç»Ÿæ¦‚è§ˆ**  
   - å®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œæµé‡ï¼‰ã€Bot åœ¨çº¿çŠ¶æ€å’Œè¿è¡Œæ—¶é•¿ã€‚  
   - å±•ç¤ºå·¥ä½œæµåŠ è½½æƒ…å†µã€æ’ä»¶æ•°é‡ä¸å®šæ—¶ä»»åŠ¡ç»Ÿè®¡ï¼ˆå¯¹åº” `core.js` å’Œ `plugin.js` çš„ç»Ÿè®¡æ¥å£ï¼‰ã€‚  
   - æ”¯æŒæŸ¥çœ‹æœ€è¿‘ 24 å°æ—¶çš„ç³»ç»ŸæŒ‡æ ‡æ›²çº¿ï¼ˆé€šè¿‡ `/api/system/status` ä¸ `/api/system/overview`ï¼‰ã€‚

2. **AIå¯¹è¯**  
   - æä¾›ç»Ÿä¸€çš„èŠå¤©ç•Œé¢ï¼Œæ”¯æŒæ–‡æœ¬è¾“å…¥ã€ASR è¯­éŸ³è¾“å…¥ä¸å›¾ç‰‡ä¸Šä¼ è¯†åˆ«ã€‚  
   - åº•å±‚é€šè¿‡ `/api/v3/chat/completions` ä¸ `/api/ai/stream` è°ƒç”¨å·¥ä½œæµï¼ˆchat/desktop/tools/...ï¼‰ï¼Œæ”¯æŒåœ¨å‰ç«¯åˆ‡æ¢ä¸åŒå·¥ä½œæµä¸äººæ ¼é¢„è®¾ã€‚  
   - æ”¯æŒæŸ¥çœ‹åŸå§‹è¯·æ±‚/å“åº”ä¸ token æ¶ˆè€—ï¼Œä¾¿äºè°ƒè¯•å·¥ä½œæµä¸ LLM é…ç½®ã€‚

3. **é…ç½®ç®¡ç†**  
   - åŸºäº `config.js` HTTP æ¨¡å—çš„ `/api/config/*` è·¯ç”±ï¼Œæä¾›ã€Œè¡¨å•æ¨¡å¼ï¼ˆSchema é©±åŠ¨ï¼‰ã€ä¸ã€ŒJSON æ¨¡å¼ã€åŒè§†å›¾ã€‚  
   - æ”¯æŒä¸€é”®å¤‡ä»½/æ¢å¤ã€å­é…ç½®è·¯å¾„ç¼–è¾‘ï¼ˆå¦‚åªç¼–è¾‘æŸä¸ª core çš„é…ç½®å­æ ‘ï¼‰ã€Schema æ ¡éªŒä¸ç¼“å­˜æ¸…ç†ã€‚  
   - å…¸å‹é…ç½®åŒ…æ‹¬ï¼šsystem é…ç½®ã€å„ LLM æä¾›å•†é…ç½®ã€ASR/TTSã€å·¥å…·ä¸ aistream é…ç½®ç­‰ã€‚

4. **APIè°ƒè¯•**  
   - å†…ç½®ç®€æ˜“ API Clientï¼Œå¯ä»¥ç›´æ¥é€‰æ‹© system-Core æš´éœ²çš„æ‰€æœ‰ HTTP è·¯ç”±è¿›è¡Œè°ƒç”¨ï¼ˆåŒ…æ‹¬æ’ä»¶ç®¡ç†ã€è®¾å¤‡ç®¡ç†ã€stdin æ¥å£ç­‰ï¼‰ã€‚  
   - æ”¯æŒå¡«å†™è¯·æ±‚ä½“ã€Headerã€é‰´æƒå‚æ•°ï¼ŒæŸ¥çœ‹å“åº” JSON / åŸå§‹æ–‡æœ¬ï¼Œä»¥åŠ WebSocket è°ƒè¯•ï¼ˆå¦‚ `/stdin` é¢‘é“ï¼‰ã€‚  
   - é€‚åˆè°ƒè¯•è‡ªå®šä¹‰ Core çš„ HTTP æ¥å£ã€éªŒè¯é…ç½®ä¸å·¥ä½œæµé›†æˆæ˜¯å¦æ­£ç¡®ã€‚

**å‰ç«¯ç‰¹æ€§**ï¼š
- å“åº”å¼å¸ƒå±€ï¼šé€‚é…æ¡Œé¢ä¸ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼Œä¾§è¾¹å¯¼èˆª + é¡¶éƒ¨çŠ¶æ€æ ç»“æ„ã€‚  
- å®æ—¶æ€§ï¼šé€šè¿‡ WebSocket ä¸è½®è¯¢ç»“åˆï¼Œå®æ—¶åˆ·æ–°ç³»ç»ŸçŠ¶æ€é¢æ¿ä¸ stdin è¾“å‡ºç­‰ä¿¡æ¯ã€‚  
- æ€§èƒ½ä¸ä½“éªŒï¼šè·¯ç”±çº§æ‡’åŠ è½½ã€é”™è¯¯è¾¹ç•Œä¸ç»Ÿä¸€ Toast æç¤ºï¼Œå°½é‡å‡å°‘é¡µé¢é˜»å¡ã€‚

**è®¿é—®æ–¹å¼**ï¼š
- æœ¬åœ°è®¿é—®ï¼š`http://localhost:8080/xrk/`
- è¿œç¨‹è®¿é—®ï¼š`http://your-server-ip:8080/xrk/`
- éœ€è¦è®¤è¯ï¼šé¦–æ¬¡è®¿é—®éœ€è¦ç™»å½•ï¼Œæˆ–ä½¿ç”¨ API Key è®¤è¯

**åŠŸèƒ½æ¨¡å—è¯¦è§£**ï¼š

1. **ç³»ç»Ÿæ¦‚è§ˆ**
   - å®æ—¶ç›‘æ§ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œæµé‡
   - å†å²æ•°æ®ï¼š24å°æ—¶ç³»ç»ŸæŒ‡æ ‡æ›²çº¿å›¾
   - BotçŠ¶æ€ï¼šåœ¨çº¿æœºå™¨äººåˆ—è¡¨ã€è¿è¡Œæ—¶é•¿
   - å·¥ä½œæµç»Ÿè®¡ï¼šå·²åŠ è½½å·¥ä½œæµæ•°é‡ã€MCPå·¥å…·æ•°é‡
   - æ’ä»¶ç»Ÿè®¡ï¼šå·²åŠ è½½æ’ä»¶æ•°é‡ã€å®šæ—¶ä»»åŠ¡æ•°é‡

2. **AIå¯¹è¯**
   - å¤šå·¥ä½œæµæ”¯æŒï¼šå¯åˆ‡æ¢ä¸åŒçš„å·¥ä½œæµï¼ˆchat/desktop/toolsç­‰ï¼‰
   - å¤šæ¨¡æ€è¾“å…¥ï¼šæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³è¾“å…¥
   - æµå¼è¾“å‡ºï¼šå®æ—¶æ˜¾ç¤ºAIå›å¤å†…å®¹
   - è°ƒè¯•æ¨¡å¼ï¼šæŸ¥çœ‹åŸå§‹è¯·æ±‚/å“åº”ã€tokenæ¶ˆè€—

3. **é…ç½®ç®¡ç†**
   - è¡¨å•æ¨¡å¼ï¼šåŸºäºSchemaçš„å¯è§†åŒ–è¡¨å•ç¼–è¾‘
   - JSONæ¨¡å¼ï¼šç›´æ¥ç¼–è¾‘JSONé…ç½®
   - é…ç½®éªŒè¯ï¼šå®æ—¶éªŒè¯é…ç½®æ ¼å¼å’Œå†…å®¹
   - ä¸€é”®å¤‡ä»½ï¼šé…ç½®ä¿®æ”¹å‰è‡ªåŠ¨å¤‡ä»½
   - å­é…ç½®ç¼–è¾‘ï¼šæ”¯æŒç¼–è¾‘SystemConfigçš„å­é…ç½®

4. **APIè°ƒè¯•**
   - æ¥å£åˆ—è¡¨ï¼šè‡ªåŠ¨å‘ç°æ‰€æœ‰HTTP APIæ¥å£
   - è¯·æ±‚æ„å»ºï¼šå¯è§†åŒ–æ„å»ºHTTPè¯·æ±‚
   - å“åº”æŸ¥çœ‹ï¼šæ ¼å¼åŒ–æ˜¾ç¤ºJSONå“åº”
   - WebSocketè°ƒè¯•ï¼šæ”¯æŒWebSocketè¿æ¥æµ‹è¯•
   - å†å²è®°å½•ï¼šä¿å­˜æœ€è¿‘è°ƒç”¨çš„APIè¯·æ±‚

---

## é…ç½®ç®¡ç†

system-Core æä¾›äº†å®Œæ•´çš„é…ç½®ç®¡ç†åŠŸèƒ½ï¼š

### é…ç½®ç±»å‹

1. **ç³»ç»Ÿé…ç½®** (`system.js`)
   - æœåŠ¡å™¨é…ç½®
   - AI Streamé…ç½®ï¼ˆLLM/ASR/TTSï¼‰
   - MCPé…ç½®
   - åå‘ä»£ç†é…ç½®
   - å®‰å…¨é…ç½®

2. **LLMæä¾›å•†é…ç½®**
   - `gptgod_llm.js`
   - `volcengine_llm.js`
   - `xiaomimimo_llm.js`
   - `openai_llm.js`
   - `openai_compat_llm.js`
   - `gemini_llm.js`
   - `anthropic_llm.js`
   - `azure_openai_llm.js`

3. **ASR/TTSé…ç½®**
   - `volcengine_asr.js`
   - `volcengine_tts.js`

4. **å·¥å…·é…ç½®**
   - `tools.js`

### é…ç½®ç‰¹æ€§

- âœ… **SchemaéªŒè¯**ï¼šåŸºäºJSON Schemaçš„é…ç½®éªŒè¯
- âœ… **æ‰å¹³åŒ–ç»“æ„**ï¼šå‡å°‘å‰ç«¯åµŒå¥—æ“ä½œ
- âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šé…ç½®ä¿®æ”¹å‰è‡ªåŠ¨å¤‡ä»½
- âœ… **å­é…ç½®æ”¯æŒ**ï¼šSystemConfigæ”¯æŒå­é…ç½®ï¼ˆé€šè¿‡`path`å‚æ•°ï¼‰
- âœ… **Webç•Œé¢**ï¼šå¯è§†åŒ–é…ç½®ç¼–è¾‘

---

## æ€»ç»“

system-Core æ˜¯ XRK-AGT çš„æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›äº†ï¼š

- âœ… **10ä¸ªHTTP APIæ¨¡å—**ï¼šè¦†ç›–ç³»ç»Ÿç®¡ç†ã€æœºå™¨äººç®¡ç†ã€é…ç½®ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ã€æ’ä»¶ç®¡ç†ã€AIæœåŠ¡ã€MCPæœåŠ¡ã€è®¾å¤‡ç®¡ç†ã€æ ‡å‡†è¾“å…¥ã€æ•°æ®ç¼–è¾‘
- âœ… **6ä¸ªå·¥ä½œæµ**ï¼š53ä¸ªMCPå·¥å…·ï¼Œè¦†ç›–èŠå¤©ã€æ¡Œé¢ã€å·¥å…·ã€è®°å¿†ã€çŸ¥è¯†åº“ã€è®¾å¤‡
- âœ… **4ä¸ªTasker**ï¼šæ”¯æŒOneBotv11ã€GSUIDCOREã€QBQBotã€stdin
- âœ… **Webæ§åˆ¶å°**ï¼šä¼ä¸šçº§ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç³»ç»Ÿç›‘æ§ã€APIè°ƒè¯•ã€é…ç½®ç®¡ç†
- âœ… **å®Œæ•´é…ç½®ç³»ç»Ÿ**ï¼šæ”¯æŒå¤šç§é…ç½®ç±»å‹ï¼ŒSchemaéªŒè¯ï¼Œå¯è§†åŒ–ç¼–è¾‘

æ‰€æœ‰åŠŸèƒ½å¼€ç®±å³ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®å³å¯ä½¿ç”¨ã€‚

---

## ç›¸å…³æ–‡æ¡£

- **[HTTP API åŸºç±»](http-api.md)** - äº†è§£å¦‚ä½•å¼€å‘è‡ªå®šä¹‰API
- **[API åŠ è½½å™¨](api-loader.md)** - äº†è§£APIè‡ªåŠ¨åŠ è½½æœºåˆ¶
- **[AI Stream](aistream.md)** - äº†è§£å·¥ä½œæµå¼€å‘
- **[MCP æŒ‡å—](mcp-guide.md)** - äº†è§£MCPå·¥å…·æ³¨å†Œ
- **[å·¥å‚ç³»ç»Ÿ](factory.md)** - äº†è§£AIæœåŠ¡æä¾›å•†é…ç½®
- **[åº”ç”¨å¼€å‘æŒ‡å—](app-dev.md)** - äº†è§£Webæ§åˆ¶å°å¼€å‘

---

*æœ€åæ›´æ–°ï¼š2026-02-06*
