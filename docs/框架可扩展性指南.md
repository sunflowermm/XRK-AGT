# XRK-AGT æ¡†æ¶å¯æ‰©å±•æ€§æŒ‡å—

> **æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»XRK-AGTæ¡†æ¶çš„å¯æ‰©å±•æ€§è®¾è®¡ï¼Œå¸®åŠ©å¼€å‘è€…å……åˆ†åˆ©ç”¨æ¡†æ¶çš„æ‰©å±•èƒ½åŠ›ï¼Œå¿«é€Ÿæ„å»ºè‡ªå®šä¹‰åŠŸèƒ½ã€‚**

## ğŸ“š ç›®å½•å¯¼èˆª

- [å¯æ‰©å±•æ€§æ¦‚è¿°](#å¯æ‰©å±•æ€§æ¦‚è¿°)
- [æ ¸å¿ƒæ‰©å±•ç‚¹](#æ ¸å¿ƒæ‰©å±•ç‚¹)
- [æ’ä»¶ç³»ç»Ÿæ‰©å±•](#æ’ä»¶ç³»ç»Ÿæ‰©å±•)
- [å·¥ä½œæµç³»ç»Ÿæ‰©å±•](#å·¥ä½œæµç³»ç»Ÿæ‰©å±•)
- [Taskeræ‰©å±•](#taskeræ‰©å±•)
- [äº‹ä»¶ç³»ç»Ÿæ‰©å±•](#äº‹ä»¶ç³»ç»Ÿæ‰©å±•)
- [HTTP/APIæ‰©å±•](#httpapiæ‰©å±•)
- [æ¸²æŸ“å™¨æ‰©å±•](#æ¸²æŸ“å™¨æ‰©å±•)
- [é…ç½®ç³»ç»Ÿæ‰©å±•](#é…ç½®ç³»ç»Ÿæ‰©å±•)
- [åŠ è½½å™¨æ‰©å±•](#åŠ è½½å™¨æ‰©å±•)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ‰©å±•ç¤ºä¾‹](#æ‰©å±•ç¤ºä¾‹)

---

## å¯æ‰©å±•æ€§æ¦‚è¿°

XRK-AGTæ¡†æ¶é‡‡ç”¨**åˆ†å±‚æ¶æ„ + åŸºç±»è®¾è®¡ + åŠ è½½å™¨æœºåˆ¶**ï¼Œå®ç°äº†é«˜åº¦çš„å¯æ‰©å±•æ€§ï¼š

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **åŸºç¡€è®¾æ–½ä¸ä¸šåŠ¡åˆ†ç¦»**ï¼šåŸºç¡€è®¾æ–½å±‚æä¾›é€šç”¨èƒ½åŠ›ï¼Œä¸šåŠ¡å±‚ä¸“æ³¨å…·ä½“å®ç°
2. **åŸºç±»æŠ½è±¡**ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½åŸºäºåŸºç±»ï¼Œé€šè¿‡ç»§æ‰¿å¿«é€Ÿæ‰©å±•
3. **è‡ªåŠ¨åŠ è½½**ï¼šé€šè¿‡åŠ è½½å™¨è‡ªåŠ¨å‘ç°å’ŒåŠ è½½æ‰©å±•
4. **æ ‡å‡†åŒ–æ¥å£**ï¼šç»Ÿä¸€çš„æ¥å£è§„èŒƒï¼Œæ˜“äºé›†æˆå’Œç»´æŠ¤
5. **æ— ç‰¹åŒ–é€»è¾‘**ï¼šåº•å±‚ä»£ç ä¸åŒ…å«ä»»ä½•é’ˆå¯¹ç‰¹å®šä¸šåŠ¡åœºæ™¯çš„ç¡¬ç¼–ç 

### æ‰©å±•èƒ½åŠ›çŸ©é˜µ

```mermaid
flowchart TB
    subgraph Extension["æ‰©å±•èƒ½åŠ›"]
        A["æ’ä»¶æ‰©å±•<br/>pluginåŸºç±»"]
        B["å·¥ä½œæµæ‰©å±•<br/>AIStreamåŸºç±»"]
        C["Taskeræ‰©å±•<br/>åè®®é€‚é…å™¨"]
        D["äº‹ä»¶ç›‘å¬å™¨æ‰©å±•<br/>EventListeneråŸºç±»"]
        E["HTTP APIæ‰©å±•<br/>HttpApiåŸºç±»"]
        F["æ¸²æŸ“å™¨æ‰©å±•<br/>RendereråŸºç±»"]
        G["é…ç½®æ‰©å±•<br/>ConfigBaseåŸºç±»"]
        H["åŠ è½½å™¨æ‰©å±•<br/>è‡ªå®šä¹‰åŠ è½½å™¨"]
    end
    
    subgraph Infrastructure["åŸºç¡€è®¾æ–½å±‚"]
        I["åŸºç±»åº“"]
        J["åŠ è½½å™¨"]
        K["å·¥å…·ç±»"]
    end
    
    A --> I
    B --> I
    C --> I
    D --> I
    E --> I
    F --> I
    G --> I
    H --> J
    
    style Extension fill:#E6F3FF
    style Infrastructure fill:#FFE6CC
```

---

## æ ¸å¿ƒæ‰©å±•ç‚¹

### 1. æ’ä»¶ç³»ç»Ÿæ‰©å±•

**åŸºç±»ä½ç½®**: `src/infrastructure/plugins/plugin.js`

**æ‰©å±•èƒ½åŠ›**:
- âœ… æ¶ˆæ¯å¤„ç†ï¼ˆè§„åˆ™åŒ¹é…ã€æƒé™æ§åˆ¶ï¼‰
- âœ… å®šæ—¶ä»»åŠ¡ï¼ˆcronè¡¨è¾¾å¼ï¼‰
- âœ… äº‹ä»¶è®¢é˜…ï¼ˆè·¨å¹³å°äº‹ä»¶ç›‘å¬ï¼‰
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆä¼šè¯çŠ¶æ€ï¼‰
- âœ… å·¥ä½œæµé›†æˆï¼ˆAIStreamè°ƒç”¨ï¼‰

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºæ’ä»¶ç±»<br/>ç»§æ‰¿plugin"] --> B["å®šä¹‰æ„é€ å‡½æ•°<br/>é…ç½®name/event/priority"]
    B --> C["å®ç°acceptæ–¹æ³•<br/>å‰ç½®æ£€æŸ¥"]
    C --> D["å®šä¹‰ruleè§„åˆ™<br/>æ¶ˆæ¯åŒ¹é…"]
    D --> E["å®ç°å¤„ç†æ–¹æ³•<br/>ä¸šåŠ¡é€»è¾‘"]
    E --> F["å¯é€‰ï¼šå®šæ—¶ä»»åŠ¡<br/>taské…ç½®"]
    F --> G["å¯é€‰ï¼šäº‹ä»¶è®¢é˜…<br/>eventSubscribe"]
    G --> H["æ”¾ç½®åˆ°core/plugin/<br/>è‡ªåŠ¨åŠ è½½"]
    
    style A fill:#E6F3FF
    style H fill:#90EE90
```

**å…³é”®æ‰©å±•ç‚¹**:

1. **è§„åˆ™åŒ¹é…ç³»ç»Ÿ**
   ```javascript
   // æ”¯æŒå¤šç§è§„åˆ™æ ¼å¼
   rule: [
     { reg: '^#æµ‹è¯•$', fnc: 'test' },           // æ­£åˆ™åŒ¹é…
     { reg: /^#å‘½ä»¤$/, fnc: 'command' },       // æ­£åˆ™å¯¹è±¡
     { reg: '^#å¤æ‚', fnc: 'complex', priority: 100 }  // å¸¦ä¼˜å…ˆçº§
   ]
   ```

2. **äº‹ä»¶è®¢é˜…ç³»ç»Ÿ**
   ```javascript
   // è·¨å¹³å°äº‹ä»¶ç›‘å¬
   eventSubscribe: [
     { eventType: 'message', handler: this.handleMessage },
     { eventType: 'onebot.*', handler: this.handleOneBot },
     { eventType: 'device.notice', handler: this.handleDevice }
   ]
   ```

3. **ä¸Šä¸‹æ–‡ç®¡ç†**
   ```javascript
   // è®¾ç½®ä¸Šä¸‹æ–‡
   this.setContext('type', isGroup, time);
   
   // è·å–ä¸Šä¸‹æ–‡
   const ctx = this.getContext('type', isGroup);
   
   // ç»“æŸä¸Šä¸‹æ–‡
   this.finish('type', isGroup);
   ```

### 2. å·¥ä½œæµç³»ç»Ÿæ‰©å±•

**åŸºç±»ä½ç½®**: `src/infrastructure/aistream/aistream.js`

**æ‰©å±•èƒ½åŠ›**:
- âœ… è‡ªå®šä¹‰å·¥ä½œæµï¼ˆç»§æ‰¿AIStreamï¼‰
- âœ… å‡½æ•°æ³¨å†Œï¼ˆFunction Callingï¼‰
- âœ… Embeddingæä¾›å•†æ‰©å±•
- âœ… å·¥ä½œæµåˆå¹¶ï¼ˆåŠŸèƒ½ç»„åˆï¼‰
- âœ… åŠ¨æ€Promptç”Ÿæˆ

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºAIStreamå­ç±»"] --> B["é…ç½®åŸºç¡€ä¿¡æ¯<br/>name/description/priority"]
    B --> C["é…ç½®AIå‚æ•°<br/>temperature/maxTokens"]
    C --> D["é…ç½®Embedding<br/>enabledï¼ˆmodeè‡ªåŠ¨ä»cfgè¯»å–ï¼‰"]
    D --> E["å®ç°initæ–¹æ³•<br/>æ³¨å†Œå‡½æ•°"]
    E --> F["å¯é€‰ï¼šå®ç°buildSystemPrompt<br/>æ„å»ºç³»ç»Ÿæç¤º"]
    F --> G["å¯é€‰ï¼šå®ç°buildChatContext<br/>æ„å»ºä¸Šä¸‹æ–‡"]
    G --> H["æ³¨å†Œå‡½æ•°<br/>registerFunction"]
    H --> I["æ”¾ç½®åˆ°core/stream/<br/>è‡ªåŠ¨åŠ è½½"]
    
    style A fill:#E6F3FF
    style I fill:#90EE90
```

**å…³é”®æ‰©å±•ç‚¹**:

1. **å‡½æ•°æ³¨å†Œç³»ç»Ÿ**
   ```javascript
   // æ”¯æŒåŠ¨æ€prompt
   this.registerFunction('my_function', {
     description: 'åŠŸèƒ½æè¿°',
     prompt: () => `[å‘½ä»¤:å‚æ•°] - åŠ¨æ€ä¿¡æ¯ï¼š${this.getInfo()}`,
     parser: (text, context) => { /* è§£æé€»è¾‘ */ },
     handler: async (params, context) => { /* æ‰§è¡Œé€»è¾‘ */ },
     enabled: true
   });
   ```

2. **Embeddingæä¾›å•†æ‰©å±•**
   ```javascript
   // æ”¯æŒå¤šç§æä¾›å•†
   embedding: {
     enabled: true,
     // embedding é…ç½®è‡ªåŠ¨ä» cfg è¯»å–ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
   }
   ```

3. **å·¥ä½œæµåˆå¹¶**
   ```javascript
   // è‡ªåŠ¨åˆå¹¶è¾…åŠ©å·¥ä½œæµ
   await stream.process(e, question, {
     mergeStreams: ['desktop', 'memory'],
     enableTodo: true,
     enableMemory: true
   });
   ```

### 3. Taskeræ‰©å±•

**æ‰©å±•ä½ç½®**: `core/tasker/`

**æ‰©å±•èƒ½åŠ›**:
- âœ… åè®®é€‚é…å™¨ï¼ˆæ–°å¹³å°æ¥å…¥ï¼‰
- âœ… äº‹ä»¶ç”Ÿæˆï¼ˆç»Ÿä¸€äº‹ä»¶æ¨¡å‹ï¼‰
- âœ… å¯¹è±¡å°è£…ï¼ˆå¹³å°ç‰¹å®šå¯¹è±¡ï¼‰

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºTaskerç±»"] --> B["å®šä¹‰åŸºç¡€å±æ€§<br/>id/name/path"]
    B --> C["å®ç°loadæ–¹æ³•<br/>åˆå§‹åŒ–è¿æ¥"]
    C --> D["å®ç°æ¶ˆæ¯å¤„ç†<br/>handleMessage"]
    D --> E["è½¬æ¢å¹³å°æ¶ˆæ¯<br/>ç»Ÿä¸€äº‹ä»¶æ ¼å¼"]
    E --> F["è§¦å‘Bot.emäº‹ä»¶<br/>äº‹ä»¶æ ‡å‡†åŒ–"]
    F --> G["æ³¨å†Œåˆ°Bot.tasker<br/>è‡ªåŠ¨åŠ è½½"]
    
    style A fill:#E6F3FF
    style G fill:#90EE90
```

**å…³é”®æ‰©å±•ç‚¹**:

1. **äº‹ä»¶ç”Ÿæˆ**
   ```javascript
   // é€šè¿‡Bot.emè§¦å‘æ ‡å‡†åŒ–äº‹ä»¶
   Bot.em('tasker.message', {
     event_id: `tasker_${Date.now()}`,
     tasker: 'mytasker',
     user_id: data.user_id,
     message: [{ type: 'text', text: data.text }]
   });
   ```

2. **å¯¹è±¡å°è£…**
   ```javascript
   // é€šè¿‡å¢å¼ºæ’ä»¶æŒ‚è½½å¹³å°ç‰¹å®šå¯¹è±¡
   // åœ¨enhanceræ’ä»¶ä¸­
   e.friend = Bot[self_id].pickFriend(user_id);
   e.group = Bot[self_id].pickGroup(group_id);
   ```

### 4. äº‹ä»¶ç›‘å¬å™¨æ‰©å±•

**åŸºç±»ä½ç½®**: `src/infrastructure/listener/EventListener.js`

**æ‰©å±•èƒ½åŠ›**:
- âœ… äº‹ä»¶ç›‘å¬ï¼ˆè·¨å¹³å°äº‹ä»¶ï¼‰
- âœ… äº‹ä»¶é¢„å¤„ç†ï¼ˆå»é‡ã€æ ‡è®°ï¼‰
- âœ… äº‹ä»¶åˆ†å‘ï¼ˆè°ƒç”¨PluginsLoaderï¼‰

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºEventListenerå­ç±»"] --> B["å®šä¹‰ç›‘å¬äº‹ä»¶<br/>eventTypes"]
    B --> C["å®ç°handleæ–¹æ³•<br/>äº‹ä»¶å¤„ç†"]
    C --> D["äº‹ä»¶å»é‡<br/>é¿å…é‡å¤å¤„ç†"]
    D --> E["äº‹ä»¶æ ‡è®°<br/>æ·»åŠ å…ƒæ•°æ®"]
    E --> F["è°ƒç”¨PluginsLoader<br/>åˆ†å‘åˆ°æ’ä»¶"]
    F --> G["æ”¾ç½®åˆ°core/events/<br/>è‡ªåŠ¨åŠ è½½"]
    
    style A fill:#E6F3FF
    style G fill:#90EE90
```

### 5. HTTP/APIæ‰©å±•

**åŸºç±»ä½ç½®**: `src/infrastructure/http/HttpApi.js`

**æ‰©å±•èƒ½åŠ›**:
- âœ… REST APIï¼ˆè·¯ç”±æ³¨å†Œï¼‰
- âœ… WebSocketï¼ˆå®æ—¶é€šä¿¡ï¼‰
- âœ… ä¸­é—´ä»¶ï¼ˆè®¤è¯ã€æ—¥å¿—ç­‰ï¼‰

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºHttpApiå­ç±»"] --> B["å®šä¹‰è·¯ç”±<br/>registerRoutes"]
    B --> C["å®ç°å¤„ç†æ–¹æ³•<br/>ä¸šåŠ¡é€»è¾‘"]
    C --> D["æ³¨å†ŒWebSocket<br/>å®æ—¶é€šä¿¡"]
    D --> E["é…ç½®ä¸­é—´ä»¶<br/>è®¤è¯/æ—¥å¿—"]
    E --> F["æ”¾ç½®åˆ°core/http/<br/>è‡ªåŠ¨åŠ è½½"]
    
    style A fill:#E6F3FF
    style F fill:#90EE90
```

### 6. æ¸²æŸ“å™¨æ‰©å±•

**åŸºç±»ä½ç½®**: `src/infrastructure/renderer/Renderer.js`

**æ‰©å±•èƒ½åŠ›**:
- âœ… æ¨¡æ¿æ¸²æŸ“ï¼ˆHTMLæ¨¡æ¿ï¼‰
- âœ… å›¾ç‰‡ç”Ÿæˆï¼ˆPuppeteer/Playwrightï¼‰
- âœ… æ–‡ä»¶ç›‘å¬ï¼ˆè‡ªåŠ¨é‡è½½ï¼‰

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºRendererå­ç±»"] --> B["é…ç½®æ¸²æŸ“å™¨<br/>id/type/render"]
    B --> C["å®ç°æ¸²æŸ“æ–¹æ³•<br/>renderImage/renderHTML"]
    C --> D["æ¨¡æ¿å¤„ç†<br/>dealTpl"]
    D --> E["æ–‡ä»¶ç›‘å¬<br/>watch"]
    E --> F["æ³¨å†Œåˆ°Bot.renderer<br/>è‡ªåŠ¨åŠ è½½"]
    
    style A fill:#E6F3FF
    style F fill:#90EE90
```

### 7. é…ç½®ç³»ç»Ÿæ‰©å±•

**åŸºç±»ä½ç½®**: `src/infrastructure/commonconfig/commonconfig.js`

**æ‰©å±•èƒ½åŠ›**:
- âœ… é…ç½®æ–‡ä»¶ç®¡ç†ï¼ˆYAML/JSONï¼‰
- âœ… åŠ¨æ€è·¯å¾„ï¼ˆå‡½æ•°å¼è·¯å¾„ï¼‰
- âœ… é…ç½®éªŒè¯ï¼ˆSchemaéªŒè¯ï¼‰
- âœ… é…ç½®å¤‡ä»½ï¼ˆè‡ªåŠ¨å¤‡ä»½ï¼‰

**æ‰©å±•æµç¨‹å›¾**:

```mermaid
flowchart TB
    A["åˆ›å»ºConfigBaseå­ç±»"] --> B["å®šä¹‰é…ç½®å…ƒæ•°æ®<br/>name/displayName"]
    B --> C["å®šä¹‰æ–‡ä»¶è·¯å¾„<br/>filePathé™æ€æˆ–åŠ¨æ€"]
    C --> D["å®šä¹‰Schema<br/>é…ç½®ç»“æ„éªŒè¯"]
    D --> E["å®ç°read/write<br/>è¯»å†™é…ç½®"]
    E --> F["è‡ªåŠ¨éªŒè¯<br/>Schemaæ ¡éªŒ"]
    
    style A fill:#E6F3FF
    style F fill:#90EE90
```

---

## æ’ä»¶ç³»ç»Ÿæ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
import plugin from '#infrastructure/plugins/plugin.js';
import StreamLoader from '#infrastructure/aistream/loader.js';

export default class MyPlugin extends plugin {
  constructor() {
    super({
      name: 'æˆ‘çš„æ’ä»¶',
      event: 'message',  // ç›‘å¬æ¶ˆæ¯äº‹ä»¶
      priority: 5000,   // ä¼˜å…ˆçº§ï¼ˆè¶Šå°è¶Šå…ˆæ‰§è¡Œï¼‰
      
      // è§„åˆ™åŒ¹é…
      rule: [
        { reg: '^#æµ‹è¯•$', fnc: 'test' },
        { reg: '^#å¤æ‚å‘½ä»¤', fnc: 'complex', priority: 100 }
      ],
      
      // å®šæ—¶ä»»åŠ¡
      task: [
        {
          name: 'å®šæ—¶ä»»åŠ¡',
          cron: '0 0 * * *',  // æ¯å¤©0ç‚¹æ‰§è¡Œ
          fnc: 'scheduledTask',
          immediate: false
        }
      ],
      
      // äº‹ä»¶è®¢é˜…
      eventSubscribe: [
        { eventType: 'onebot.notice', handler: this.handleNotice },
        { eventType: 'device.*', handler: this.handleDevice }
      ]
    });
  }

  // å‰ç½®æ£€æŸ¥
  async accept(e) {
    // å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæƒé™æ£€æŸ¥ã€ä¸Šä¸‹æ–‡æ£€æŸ¥ç­‰
    return true;
  }

  // è§„åˆ™å¤„ç†æ–¹æ³•
  async test(e) {
    await this.reply('æµ‹è¯•æˆåŠŸ');
  }

  async complex(e) {
    // è°ƒç”¨å·¥ä½œæµ
    const stream = StreamLoader.getStream('chat');
    await stream.process(e, e.msg, {
      enableTodo: true,
      enableMemory: true
    });
  }

  // å®šæ—¶ä»»åŠ¡
  async scheduledTask() {
    BotUtil.makeLog('info', 'å®šæ—¶ä»»åŠ¡æ‰§è¡Œ', 'MyPlugin');
  }

  // äº‹ä»¶è®¢é˜…å¤„ç†
  async handleNotice(e) {
    // å¤„ç†OneBoté€šçŸ¥äº‹ä»¶
  }

  async handleDevice(e) {
    // å¤„ç†è®¾å¤‡äº‹ä»¶
  }
}
```

### æ‰©å±•ç‚¹è¯¦è§£

#### 1. è§„åˆ™åŒ¹é…ç³»ç»Ÿ

æ”¯æŒå¤šç§è§„åˆ™æ ¼å¼ï¼Œçµæ´»åŒ¹é…æ¶ˆæ¯ï¼š

```javascript
rule: [
  // å­—ç¬¦ä¸²æ­£åˆ™
  { reg: '^#æµ‹è¯•$', fnc: 'test' },
  
  // æ­£åˆ™å¯¹è±¡
  { reg: /^#å‘½ä»¤\d+$/, fnc: 'command' },
  
  // å¸¦ä¼˜å…ˆçº§
  { reg: '^#é‡è¦', fnc: 'important', priority: 1 },
  
  // å¸¦æƒé™æ£€æŸ¥
  { reg: '^#ç®¡ç†å‘˜', fnc: 'admin', permission: 'master' }
]
```

#### 2. ä¸Šä¸‹æ–‡ç®¡ç†

æ”¯æŒä¼šè¯çŠ¶æ€ç®¡ç†ï¼š

```javascript
// è®¾ç½®ä¸Šä¸‹æ–‡ï¼ˆ30ç§’æœ‰æ•ˆï¼‰
this.setContext('waiting_input', e.isGroup, 30);

// è·å–ä¸Šä¸‹æ–‡
const ctx = this.getContext('waiting_input', e.isGroup);
if (ctx) {
  // å¤„ç†ä¸Šä¸‹æ–‡ç›¸å…³é€»è¾‘
  this.finish('waiting_input', e.isGroup);
}
```

#### 3. å·¥ä½œæµé›†æˆ

æ’ä»¶å¯ä»¥æ— ç¼è°ƒç”¨å·¥ä½œæµï¼š

```javascript
// è·å–å·¥ä½œæµ
const stream = StreamLoader.getStream('chat');

// è°ƒç”¨å·¥ä½œæµ
await stream.process(e, question, {
  mergeStreams: ['desktop'],
  enableTodo: true,
  enableMemory: true,
  enableDatabase: true
});
```

---

## å·¥ä½œæµç³»ç»Ÿæ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
import AIStream from '#infrastructure/aistream/aistream.js';
import BotUtil from '#utils/botutil.js';

export default class MyWorkflow extends AIStream {
  constructor() {
    super({
      name: 'my-workflow',
      description: 'æˆ‘çš„è‡ªå®šä¹‰å·¥ä½œæµ',
      version: '1.0.0',
      author: 'YourName',
      priority: 100,
      
      // AIé…ç½®
      config: {
        enabled: true,
        temperature: 0.7,
        maxTokens: 4000
      },
      
      // Embeddingé…ç½®
      embedding: {
        enabled: true,
        // embedding é…ç½®è‡ªåŠ¨ä» cfg è¯»å–ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
      }
    });
  }

  async init() {
    await super.init();
    await this.initEmbedding();
    this.registerAllFunctions();
    BotUtil.makeLog('info', `[${this.name}] å·¥ä½œæµå·²åˆå§‹åŒ–`, 'MyWorkflow');
  }

  registerAllFunctions() {
    // æ³¨å†Œå‡½æ•°ï¼ˆæ”¯æŒåŠ¨æ€promptï¼‰
    this.registerFunction('my_function', {
      description: 'æˆ‘çš„åŠŸèƒ½',
      prompt: () => {
        // åŠ¨æ€è·å–ä¿¡æ¯
        const info = this.getDynamicInfo();
        return `[æˆ‘çš„åŠŸèƒ½:å‚æ•°] - åŠŸèƒ½æè¿°\nå½“å‰ä¿¡æ¯ï¼š${info}`;
      },
      parser: (text, context) => {
        const functions = [];
        const reg = /\[æˆ‘çš„åŠŸèƒ½:([^\]]+)\]/g;
        let match;
        while ((match = reg.exec(text)) !== null) {
          functions.push({
            type: 'my_function',
            params: { param: match[1].trim() }
          });
        }
        return {
          functions,
          cleanText: text.replace(reg, '').trim()
        };
      },
      handler: async (params, context) => {
        const { param } = params || {};
        // å¤„ç†é€»è¾‘
        context.myResult = 'æ‰§è¡Œç»“æœ';
        
        // åœ¨å·¥ä½œæµä¸­è®°å½•ç¬”è®°
        if (context.workflowId) {
          await this.storeNote(
            context.workflowId,
            `æ‰§è¡Œç»“æœï¼š${context.myResult}`,
            'my_function',
            true
          );
        }
      },
      enabled: true
    });
  }

  // å¯é€‰å®ç°ï¼šæ„å»ºç³»ç»Ÿæç¤ºè¯ï¼ˆå¦‚æœæœªå®ç°ï¼ŒåŸºç±»è¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰
  buildSystemPrompt(context) {
    return `ã€äººè®¾ã€‘
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚

ã€å¯ç”¨åŠŸèƒ½ã€‘
${this.buildFunctionsPrompt()}

ã€æ‰§è¡Œè§„åˆ™ã€‘
1. è§„åˆ™1
2. è§„åˆ™2`;
  }

  // å¯é€‰å®ç°ï¼šæ„å»ºèŠå¤©ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœæœªå®ç°ï¼ŒåŸºç±»è¿”å›ç©ºæ•°ç»„ï¼‰
  async buildChatContext(e, question) {
    const messages = [];
    
    // æ·»åŠ ç³»ç»Ÿæç¤ºè¯
    const systemPrompt = this.buildSystemPrompt({ e, question });
    if (systemPrompt) {
    messages.push({
      role: 'system',
        content: systemPrompt
    });
    }
    
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    messages.push({
      role: 'user',
      content: typeof question === 'string' ? question : (question?.content || '')
    });
    
    return messages;
  }

  getDynamicInfo() {
    // åŠ¨æ€è·å–ä¿¡æ¯
    return 'å®æ—¶ä¿¡æ¯';
  }
}
```

### æ‰©å±•ç‚¹è¯¦è§£

#### 1. å‡½æ•°æ³¨å†Œç³»ç»Ÿ

æ”¯æŒå¤šç§å‡½æ•°æ³¨å†Œæ–¹å¼ï¼š

```javascript
// é™æ€prompt
prompt: `[å‘½ä»¤:å‚æ•°] - åŠŸèƒ½æè¿°`

// åŠ¨æ€promptï¼ˆæ¨èï¼‰
prompt: () => {
  const info = this.getInfo();
  return `[å‘½ä»¤:å‚æ•°] - åŠŸèƒ½æè¿°\nå½“å‰ä¿¡æ¯ï¼š${info}`;
}

// å¤æ‚è§£æ
parser: (text, context) => {
  // æ”¯æŒå¤šå‘½ä»¤è§£æ
  // æ”¯æŒä¸Šä¸‹æ–‡æ„ŸçŸ¥
  // æ”¯æŒå‚æ•°éªŒè¯
  return { functions: [], cleanText: text };
}

// å¼‚æ­¥å¤„ç†
handler: async (params, context) => {
  // æ”¯æŒå¼‚æ­¥æ“ä½œ
  // æ”¯æŒä¸Šä¸‹æ–‡ä¼ é€’
  // æ”¯æŒé”™è¯¯å¤„ç†
}
```

#### 2. Embeddingæä¾›å•†æ‰©å±•

Embedding é…ç½®è‡ªåŠ¨ä» cfg è¯»å–ï¼š

```javascript
// Embedding é…ç½®ï¼ˆè‡ªåŠ¨ä» cfg è¯»å–ï¼‰
embedding: {
  enabled: true
  // mode è‡ªåŠ¨ä» cfg.aistream.embedding.mode è¯»å–ï¼ˆlocal æˆ– remoteï¼‰
  // local: ä½¿ç”¨æœ¬åœ° BM25 ç®—æ³•ï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰
  // remote: ä½¿ç”¨è¿œç¨‹ API æ¥å£ï¼ˆéœ€è¦åœ¨ cfg.aistream.embedding.remote ä¸­é…ç½® apiUrlã€apiKeyã€apiModelï¼‰
}
```

#### 3. å·¥ä½œæµåˆå¹¶æœºåˆ¶

æ”¯æŒå·¥ä½œæµåŠŸèƒ½åˆå¹¶ï¼š

```javascript
// ä¸»å·¥ä½œæµ
const mainStream = StreamLoader.getStream('chat');

// åˆå¹¶è¾…åŠ©å·¥ä½œæµ
await mainStream.process(e, question, {
  mergeStreams: ['desktop', 'memory', 'database'],
  enableTodo: true
});

// åˆå¹¶åçš„å·¥ä½œæµåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼Œä½†ä¿ç•™ä¸»å·¥ä½œæµçš„äººè®¾
```

---

## Taskeræ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
// core/tasker/MyTasker.js

class MyTasker {
  id = 'mytasker';
  name = 'MyTasker';
  path = this.name;

  load() {
    // åˆå§‹åŒ–è¿æ¥
    Bot.wsf[this.path].push((ws) => {
      ws.on('message', (data) => this.handleMessage(data));
      ws.on('error', (error) => this.handleError(error));
    });
  }

  handleMessage(data) {
    // è½¬æ¢å¹³å°æ¶ˆæ¯ä¸ºç»Ÿä¸€äº‹ä»¶æ ¼å¼
    Bot.em('mytasker.message', {
      event_id: `mytasker_${Date.now()}`,
      tasker: 'mytasker',
      tasker_id: this.id,
      tasker_name: this.name,
      user_id: data.user_id,
      sender: {
        user_id: data.user_id,
        nickname: data.nickname
      },
      message: [{ type: 'text', text: data.text }],
      raw_message: data.text,
      time: Date.now(),
      bot: Bot[this.id],
      reply: async (msg) => {
        // å®ç°å›å¤é€»è¾‘
        await this.sendMessage(data.user_id, msg);
      }
    });
  }

  handleError(error) {
    BotUtil.makeLog('error', `Taskeré”™è¯¯: ${error.message}`, 'MyTasker');
  }

  async sendMessage(userId, message) {
    // å®ç°å‘é€æ¶ˆæ¯é€»è¾‘
  }
}

// æ³¨å†ŒTasker
Bot.tasker.push(new MyTasker());
```

### æ‰©å±•ç‚¹è¯¦è§£

#### 1. äº‹ä»¶ç”Ÿæˆ

Taskeréœ€è¦å°†å¹³å°æ¶ˆæ¯è½¬æ¢ä¸ºç»Ÿä¸€äº‹ä»¶æ ¼å¼ï¼š

```javascript
Bot.em('tasker.message', {
  // åŸºç¡€å­—æ®µï¼ˆå¿…å¡«ï¼‰
  event_id: string,      // äº‹ä»¶ID
  tasker: string,        // Taskerç±»å‹
  tasker_id: string,     // Tasker ID
  tasker_name: string,   // Taskeråç§°
  user_id: string,       // ç”¨æˆ·ID
  message: Array,        // æ¶ˆæ¯æ•°ç»„
  raw_message: string,   // åŸå§‹æ¶ˆæ¯
  time: number,          // æ—¶é—´æˆ³
  bot: BotInstance,      // Botå®ä¾‹
  reply: Function,       // å›å¤æ–¹æ³•
  
  // å¯é€‰å­—æ®µ
  sender: Object,        // å‘é€è€…ä¿¡æ¯
  group_id: string,     // ç¾¤ç»„IDï¼ˆç¾¤æ¶ˆæ¯æ—¶ï¼‰
  // ... å…¶ä»–å¹³å°ç‰¹å®šå­—æ®µ
});
```

#### 2. å¢å¼ºæ’ä»¶

å¹³å°ç‰¹å®šå¯¹è±¡é€šè¿‡å¢å¼ºæ’ä»¶æŒ‚è½½ï¼š

```javascript
// core/plugin/enhancer/MyTaskerEnhancer.js
export default class MyTaskerEnhancer extends plugin {
  constructor() {
    super({
      name: 'MyTaskerå¢å¼ºæ’ä»¶',
      event: 'mytasker.message',
      priority: 1
    });
  }

  async accept(e) {
    // æŒ‚è½½å¹³å°ç‰¹å®šå¯¹è±¡
    e.friend = this.getFriend(e.user_id);
    e.group = this.getGroup(e.group_id);
    e.isGroup = !!e.group_id;
    e.isPrivate = !e.isGroup;
    
    return true;
  }
}
```

---

## äº‹ä»¶ç³»ç»Ÿæ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
import EventListener from '#infrastructure/listener/EventListener.js';

export default class MyEventListener extends EventListener {
  constructor() {
    super({
      name: 'MyEventListener',
      eventTypes: ['mytasker.message', 'mytasker.notice']
    });
  }

  async handle(e) {
    // äº‹ä»¶å»é‡
    if (this.isDuplicate(e)) {
      return;
    }

    // äº‹ä»¶æ ‡è®°
    e.processed = true;
    e.processedBy = this.name;

    // åˆ†å‘åˆ°æ’ä»¶
    await PluginsLoader.deal(e);
  }

  isDuplicate(e) {
    // å®ç°å»é‡é€»è¾‘
    const key = `${e.tasker}_${e.event_id}`;
    if (this.processedEvents.has(key)) {
      return true;
    }
    this.processedEvents.set(key, Date.now());
    return false;
  }
}
```

---

## HTTP/APIæ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
import HttpApi from '#infrastructure/http/HttpApi.js';

export default class MyAPI extends HttpApi {
  constructor() {
    super({
      name: 'MyAPI',
      path: '/api/my',
      description: 'æˆ‘çš„API'
    });
  }

  registerRoutes(app) {
    // REST API
    app.get('/api/my/status', this.handleStatus.bind(this));
    app.post('/api/my/action', this.handleAction.bind(this));
    
    // WebSocket
    this.registerWebSocket('/ws/my', this.handleWebSocket.bind(this));
  }

  async handleStatus(req, res) {
    res.json({ status: 'ok' });
  }

  async handleAction(req, res) {
    const { action } = req.body;
    // å¤„ç†é€»è¾‘
    res.json({ success: true });
  }

  handleWebSocket(ws, req) {
    ws.on('message', (data) => {
      // å¤„ç†WebSocketæ¶ˆæ¯
      ws.send(JSON.stringify({ response: 'ok' }));
    });
  }
}
```

---

## æ¸²æŸ“å™¨æ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
import Renderer from '#infrastructure/renderer/Renderer.js';

export default class MyRenderer extends Renderer {
  constructor() {
    super({
      id: 'my-renderer',
      type: 'image',
      render: 'renderImage'
    });
  }

  async renderImage(data) {
    // å¤„ç†æ¨¡æ¿
    const htmlPath = await this.dealTpl('my-template', {
      tplFile: 'resources/html/my-template.html',
      data: data
    });

    // ä½¿ç”¨Puppeteer/Playwrightæ¸²æŸ“
    const imagePath = await this.renderWithPuppeteer(htmlPath);
    
    return imagePath;
  }
}
```

---

## é…ç½®ç³»ç»Ÿæ‰©å±•

### å®Œæ•´æ‰©å±•ç¤ºä¾‹

```javascript
import ConfigBase from '#infrastructure/commonconfig/commonconfig.js';

export default class MyConfig extends ConfigBase {
  constructor() {
    super({
      name: 'myconfig',
      displayName: 'æˆ‘çš„é…ç½®',
      description: 'è‡ªå®šä¹‰é…ç½®ç¤ºä¾‹',
      filePath: 'config/myconfig.yaml',
      fileType: 'yaml',
      schema: {
        fields: {
          enabled: {
            type: 'boolean',
            default: true,
            description: 'æ˜¯å¦å¯ç”¨'
          },
          port: {
            type: 'number',
            default: 8080,
            description: 'ç«¯å£å·'
          },
          settings: {
            type: 'object',
            fields: {
              key: {
                type: 'string',
                default: 'value',
                description: 'è®¾ç½®é¡¹'
              }
            }
          }
        }
      }
    });
  }
}

// ä½¿ç”¨
const config = new MyConfig();
const data = await config.read();
await config.set('enabled', true);
await config.write({ enabled: true, port: 8080 });
```

### åŠ¨æ€è·¯å¾„æ”¯æŒ

```javascript
// æ”¯æŒå‡½æ•°å¼è·¯å¾„
filePath: (cfg) => {
  return `config/server_bots/${cfg.server.port}/myconfig.yaml`;
}
```

---

## åŠ è½½å™¨æ‰©å±•

### è‡ªå®šä¹‰åŠ è½½å™¨

æ¡†æ¶çš„åŠ è½½å™¨éƒ½æ˜¯å¯æ‰©å±•çš„ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰åŠ è½½å™¨ï¼š

```javascript
// src/infrastructure/my-loader/MyLoader.js

class MyLoader {
  constructor() {
    this.items = new Map();
    this.loaded = false;
  }

  async load() {
    if (this.loaded) return;
    
    const files = await this.getFiles();
    for (const file of files) {
      await this.loadItem(file);
    }
    
    this.loaded = true;
  }

  async getFiles() {
    // è·å–æ–‡ä»¶åˆ—è¡¨
  }

  async loadItem(file) {
    // åŠ è½½å•ä¸ªé¡¹ç›®
  }
}

export default new MyLoader();
```

---

## æœ€ä½³å®è·µ

### 1. æ‰©å±•å¼€å‘æµç¨‹

```mermaid
flowchart TB
    A["ç¡®å®šæ‰©å±•ç±»å‹"] --> B["é€‰æ‹©å¯¹åº”åŸºç±»"]
    B --> C["é˜…è¯»åŸºç±»æ–‡æ¡£"]
    C --> D["å®ç°å¿…è¦æ–¹æ³•"]
    D --> E["æµ‹è¯•æ‰©å±•åŠŸèƒ½"]
    E --> F["æ”¾ç½®åˆ°å¯¹åº”ç›®å½•"]
    F --> G["è‡ªåŠ¨åŠ è½½ç”Ÿæ•ˆ"]
    
    style A fill:#E6F3FF
    style G fill:#90EE90
```

### 2. æ‰©å±•å‘½åè§„èŒƒ

- **æ’ä»¶**: `core/plugin/example/my-plugin.js`
- **å·¥ä½œæµ**: `core/stream/my-workflow.js`
- **Tasker**: `core/tasker/MyTasker.js`
- **äº‹ä»¶ç›‘å¬å™¨**: `core/events/my-listener.js`
- **HTTP API**: `core/http/my-api.js`
- **æ¸²æŸ“å™¨**: `src/renderers/my-renderer.js`

### 3. æ‰©å±•ä¼˜å…ˆçº§

- **æ’ä»¶**: `priority` è¶Šå°è¶Šå…ˆæ‰§è¡Œ
- **å·¥ä½œæµ**: `priority` è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
- **è§„åˆ™åŒ¹é…**: `priority` è¶Šå°è¶Šå…ˆåŒ¹é…

### 4. æ‰©å±•æµ‹è¯•

```javascript
// æµ‹è¯•æ’ä»¶
const plugin = new MyPlugin();
await plugin.init();
const result = await plugin.test(e);

// æµ‹è¯•å·¥ä½œæµ
const stream = StreamLoader.getStream('my-workflow');
const response = await stream.process(e, 'æµ‹è¯•æ¶ˆæ¯');

// æµ‹è¯•API
const api = new MyAPI();
await api.registerRoutes(app);
```

### 5. æ‰©å±•è°ƒè¯•

- ä½¿ç”¨ `BotUtil.makeLog()` è®°å½•æ—¥å¿—
- æŸ¥çœ‹åŠ è½½å™¨ç»Ÿè®¡ä¿¡æ¯
- æ£€æŸ¥æ‰©å±•æ˜¯å¦æ­£ç¡®æ³¨å†Œ
- éªŒè¯æ‰©å±•æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨

---

## æ‰©å±•ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå®Œæ•´æ’ä»¶æ‰©å±•

```javascript
import plugin from '#infrastructure/plugins/plugin.js';
import StreamLoader from '#infrastructure/aistream/loader.js';

export default class CompletePlugin extends plugin {
  constructor() {
    super({
      name: 'å®Œæ•´æ’ä»¶ç¤ºä¾‹',
      event: 'message',
      priority: 5000,
      rule: [
        { reg: '^#æµ‹è¯•$', fnc: 'test' },
        { reg: '^#å·¥ä½œæµ', fnc: 'workflow' }
      ],
      task: [
        {
          name: 'å®šæ—¶ä»»åŠ¡',
          cron: '0 0 * * *',
          fnc: 'scheduledTask'
        }
      ],
      eventSubscribe: [
        { eventType: 'onebot.notice', handler: this.handleNotice }
      ]
    });
  }

  async accept(e) {
    // æƒé™æ£€æŸ¥
    if (e.user_id !== 'admin') {
      return false;
    }
    return true;
  }

  async test(e) {
    await this.reply('æµ‹è¯•æˆåŠŸ');
  }

  async workflow(e) {
    const stream = StreamLoader.getStream('chat');
    await stream.process(e, e.msg, {
      enableTodo: true
    });
  }

  async scheduledTask() {
    BotUtil.makeLog('info', 'å®šæ—¶ä»»åŠ¡æ‰§è¡Œ', 'CompletePlugin');
  }

  async handleNotice(e) {
    // å¤„ç†é€šçŸ¥äº‹ä»¶
  }
}
```

### ç¤ºä¾‹2ï¼šå®Œæ•´å·¥ä½œæµæ‰©å±•

```javascript
import AIStream from '#infrastructure/aistream/aistream.js';

export default class CompleteWorkflow extends AIStream {
  constructor() {
    super({
      name: 'complete-workflow',
      description: 'å®Œæ•´å·¥ä½œæµç¤ºä¾‹',
      version: '1.0.0',
      priority: 100,
      config: {
        temperature: 0.7,
        maxTokens: 4000
      },
      embedding: {
        enabled: true
        // mode è‡ªåŠ¨ä» cfg è¯»å–
      }
    });
  }

  async init() {
    await super.init();
    await this.initEmbedding();
    this.registerAllFunctions();
  }

  registerAllFunctions() {
    // æ³¨å†Œå¤šä¸ªå‡½æ•°
    this.registerFunction('function1', { /* ... */ });
    this.registerFunction('function2', { /* ... */ });
  }

  buildSystemPrompt(context) {
    return `ã€äººè®¾ã€‘
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚

ã€å¯ç”¨åŠŸèƒ½ã€‘
${this.buildFunctionsPrompt()}`;
  }

  async buildChatContext(e, question) {
    // æ„å»ºä¸Šä¸‹æ–‡
    return messages;
  }
}
```

---

## æ‰©å±•èƒ½åŠ›æ€»ç»“

### æ‰©å±•èƒ½åŠ›çŸ©é˜µ

| æ‰©å±•ç±»å‹ | åŸºç±»ä½ç½® | æ‰©å±•ç›®å½• | è‡ªåŠ¨åŠ è½½ | ä¼˜å…ˆçº§æ”¯æŒ | çƒ­é‡è½½ |
|---------|---------|---------|---------|-----------|--------|
| æ’ä»¶ | `plugin.js` | `core/plugin/` | âœ… | âœ… | âœ… |
| å·¥ä½œæµ | `aistream.js` | `core/stream/` | âœ… | âœ… | âœ… |
| Tasker | - | `core/tasker/` | âœ… | - | âœ… |
| äº‹ä»¶ç›‘å¬å™¨ | `EventListener.js` | `core/events/` | âœ… | âœ… | âœ… |
| HTTP API | `HttpApi.js` | `core/http/` | âœ… | âœ… | âœ… |
| æ¸²æŸ“å™¨ | `Renderer.js` | `src/renderers/` | âœ… | - | âœ… |
| é…ç½® | `ConfigBase.js` | ä»»æ„ä½ç½® | - | - | - |

### æ‰©å±•ä¼˜åŠ¿

1. **é›¶é…ç½®æ‰©å±•**ï¼šæ”¾ç½®åˆ°å¯¹åº”ç›®å½•å³å¯è‡ªåŠ¨åŠ è½½
2. **æ ‡å‡†åŒ–æ¥å£**ï¼šç»Ÿä¸€çš„åŸºç±»å’Œæ¥å£è§„èŒƒ
3. **çµæ´»ç»„åˆ**ï¼šæ”¯æŒåŠŸèƒ½åˆå¹¶å’Œç»„åˆ
4. **çƒ­é‡è½½æ”¯æŒ**ï¼šä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡è½½
5. **å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**ï¼šæä¾›initã€cleanupç­‰ç”Ÿå‘½å‘¨æœŸé’©å­

---

## ç›¸å…³æ–‡æ¡£

- **[å·¥ä½œæµç³»ç»Ÿå®Œæ•´æ–‡æ¡£](å·¥ä½œæµç³»ç»Ÿå®Œæ•´æ–‡æ¡£.md)** - å·¥ä½œæµç³»ç»Ÿè¯¦ç»†æ–‡æ¡£
- **[æ’ä»¶åŸºç±»æ–‡æ¡£](plugin-base.md)** - æ’ä»¶åŸºç±»å®Œæ•´API
- **[AIStreamæ–‡æ¡£](aistream.md)** - AIStreamåŸºç±»å®Œæ•´API
- **[é¡¹ç›®æ¦‚è§ˆ](../PROJECT_OVERVIEW.md)** - é¡¹ç›®æ•´ä½“æ¶æ„

---

## æ€»ç»“

XRK-AGTæ¡†æ¶é€šè¿‡**åˆ†å±‚æ¶æ„ + åŸºç±»è®¾è®¡ + åŠ è½½å™¨æœºåˆ¶**ï¼Œå®ç°äº†æé«˜çš„å¯æ‰©å±•æ€§ï¼š

- âœ… **7å¤§æ‰©å±•ç‚¹**ï¼šæ’ä»¶ã€å·¥ä½œæµã€Taskerã€äº‹ä»¶ç›‘å¬å™¨ã€HTTP APIã€æ¸²æŸ“å™¨ã€é…ç½®
- âœ… **æ ‡å‡†åŒ–æ¥å£**ï¼šç»Ÿä¸€çš„åŸºç±»å’Œæ¥å£è§„èŒƒ
- âœ… **è‡ªåŠ¨åŠ è½½**ï¼šæ”¾ç½®åˆ°å¯¹åº”ç›®å½•å³å¯è‡ªåŠ¨åŠ è½½
- âœ… **çµæ´»ç»„åˆ**ï¼šæ”¯æŒåŠŸèƒ½åˆå¹¶å’Œç»„åˆ
- âœ… **å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**ï¼šæä¾›initã€cleanupç­‰ç”Ÿå‘½å‘¨æœŸé’©å­

å¼€å‘è€…å¯ä»¥é€šè¿‡ç»§æ‰¿åŸºç±»ã€å®ç°å¿…è¦æ–¹æ³•ï¼Œå¿«é€Ÿæ‰©å±•æ¡†æ¶åŠŸèƒ½ï¼Œæ— éœ€ä¿®æ”¹åº•å±‚ä»£ç ã€‚

