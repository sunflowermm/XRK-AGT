<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="XRK-AGT - åŸºäºYunzai-Botçš„å‘æ—¥è‘µæœºå™¨äººæ¡†æ¶">
    <title>XRK-AGT | ä¸‹ä¸€ä»£æœºå™¨äººæ¡†æ¶</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #050507;
            --bg-card: rgba(20, 20, 25, 0.6);
            --bg-card-hover: rgba(30, 30, 40, 0.8);
            --primary: #FFD700; /* å‘æ—¥è‘µé‡‘ */
            --primary-glow: rgba(255, 215, 0, 0.4);
            --accent: #7C3AED; /* ç´«è‰² */
            --accent-glow: rgba(124, 58, 237, 0.4);
            --text-main: #FFFFFF;
            --text-muted: #94A3B8;
            --border: rgba(255, 255, 255, 0.1);
            --font-main: 'Outfit', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-main);
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        .ambient-light {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(124, 58, 237, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(255, 215, 0, 0.08), transparent 25%);
            pointer-events: none;
        }

        /* å¯¼èˆªæ  */
        nav {
            position: fixed;
            top: 0; width: 100%;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(12px);
            background: rgba(5, 5, 7, 0.7);
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.02em;
        }

        .logo span { background: linear-gradient(135deg, #FFF, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            font-size: 0.95rem;
        }

        .nav-links a:hover { color: var(--text-main); }

        /* é€šç”¨å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Hero åŒºåŸŸ */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding-top: 4rem;
        }

        .hero-badge {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent);
            color: #d8b4fe;
            padding: 0.5rem 1rem;
            border-radius: 99px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: inline-block;
        }

        .hero h1 {
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(180deg, #FFFFFF 0%, #94A3B8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-muted);
            max-width: 600px;
            margin-bottom: 3rem;
        }

        .btn-group { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; }

        .btn {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .btn-primary {
            background: var(--text-main);
            color: var(--bg-dark);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            border-color: var(--border);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--text-main);
        }

        /* å¡ç‰‡ç½‘æ ¼ */
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 3rem;
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 6rem;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            background: var(--bg-card-hover);
            border-color: var(--accent);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
        }

        .card h3 { font-size: 1.5rem; margin: 1rem 0 0.5rem; }
        .card p { color: var(--text-muted); font-size: 0.95rem; flex-grow: 1; }
        .card-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        
        .repo-link {
            margin-top: 1.5rem;
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .repo-link:hover { gap: 10px; }

        /* æ¸¸æˆåŒºåŸŸ - é‡æ„æ ¸å¿ƒ */
        .game-wrapper {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto 6rem;
            background: #111;
            border-radius: 24px;
            border: 2px solid var(--border);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            aspect-ratio: 16/9;
        }

        /* è§†é¢‘å±‚ */
        #webcam {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* é•œåƒ */
            opacity: 0.4;
            filter: grayscale(30%) contrast(1.2);
        }

        /* æ¸¸æˆç”»å¸ƒå±‚ */
        #gameCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        /* UIå±‚ */
        .game-ui {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 2rem;
        }

        .hud-top {
            display: flex;
            justify-content: space-between;
            font-family: var(--font-code);
        }

        .score-box {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .score-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .score-val { font-size: 1.8rem; font-weight: 700; color: var(--primary); }

        .game-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 7, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            transition: opacity 0.3s;
        }

        .game-overlay.hidden { opacity: 0; pointer-events: none; }

        .game-overlay h2 { font-size: 3rem; margin-bottom: 1rem; color: #fff; }
        .game-overlay p { color: var(--text-muted); margin-bottom: 2rem; max-width: 400px; text-align: center; }

        .start-btn {
            background: linear-gradient(135deg, var(--primary), #F59E0B);
            border: none;
            padding: 1rem 3rem;
            font-size: 1.2rem;
            font-weight: 800;
            color: #000;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 30px var(--primary-glow);
            transition: transform 0.2s;
            pointer-events: auto;
        }
        
        .start-btn:hover { transform: scale(1.05); }

        /* é¡µè„š */
        footer {
            border-top: 1px solid var(--border);
            padding: 4rem 2rem;
            text-align: center;
            background: rgba(5,5,7,0.8);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .footer-links a { color: var(--text-muted); text-decoration: none; transition: color 0.2s; }
        .footer-links a:hover { color: var(--primary); }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .hero h1 { font-size: 3rem; }
            .game-wrapper { border-radius: 0; border-left: none; border-right: none; }
        }

        /* éšè—çš„è¾…åŠ©Canvasç”¨äºè¿ç®— */
        #motionCanvas { display: none; }
    </style>
</head>
<body>

    <div class="ambient-light"></div>

    <nav>
        <div class="logo">
            <span style="font-size: 1.8rem;">ğŸŒ»</span>
            <div>XRK-AGT</div>
        </div>
        <ul class="nav-links">
            <li><a href="#home">é¦–é¡µ</a></li>
            <li><a href="#repos">ä»“åº“</a></li>
            <li><a href="#features">ç‰¹æ€§</a></li>
            <li><a href="#game">ä½“éªŒ</a></li>
            <li><a href="#about">å…³äº</a></li>
        </ul>
    </nav>

    <section id="home" class="hero container">
        <div class="hero-badge">âš¡ Next Gen Bot Framework</div>
        <h1>ä¸ºåˆ›æ–°è€Œç”Ÿ<br>å‘æ—¥è‘µæœºå™¨äººæ¡†æ¶</h1>
        <p>åŸºäº Yunzai-Bot çš„é«˜æ€§èƒ½ã€æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆã€‚å†…ç½®å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿä¸ AI å¯¹è¯èƒ½åŠ›ï¼Œå¼€ç®±å³ç”¨ã€‚</p>
        <div class="btn-group">
            <a href="#game" class="btn btn-primary">ğŸ® ç«‹å³ä½“éªŒ</a>
            <a href="https://gitcode.com/Xrkseek/XRK-AGT" target="_blank" class="btn btn-secondary">ğŸ“¦ GitCode ä»“åº“</a>
        </div>
    </section>

    <section id="repos" class="container" style="padding-top: 6rem;">
        <h2 class="section-title">æºç ä»“åº“</h2>
        <div class="grid">
            <div class="card">
                <div class="card-icon">ğŸš€</div>
                <h3>GitCode (æé€Ÿ)</h3>
                <p>å›½å†…è®¿é—®é¦–é€‰ï¼Œæä¾›æœ€å¿«çš„å…‹éš†é€Ÿåº¦å’Œç¨³å®šçš„æ–‡æ¡£æœåŠ¡ã€‚</p>
                <a href="https://gitcode.com/Xrkseek/XRK-AGT" target="_blank" class="repo-link">è®¿é—®ä»“åº“ â†’</a>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ±</div>
                <h3>Gitee é•œåƒ</h3>
                <p>å®˜æ–¹å®æ—¶åŒæ­¥é•œåƒï¼Œé€‚åˆå·²æœ‰ Gitee è´¦å·çš„å¼€å‘è€…ä½¿ç”¨ã€‚</p>
                <a href="https://gitee.com/xrkseek/xrk-yunzai" target="_blank" class="repo-link">è®¿é—®ä»“åº“ â†’</a>
            </div>
            <div class="card">
                <div class="card-icon">ğŸŒ</div>
                <h3>GitHub ä¸»ç«™</h3>
                <p>å‚ä¸å…¨çƒå¼€æºåä½œï¼Œæäº¤ PR æˆ– Issue çš„æœ€ä½³åœºæ‰€ã€‚</p>
                <a href="https://github.com/sunflowermm/XRK-AGT" target="_blank" class="repo-link">è®¿é—®ä»“åº“ â†’</a>
            </div>
        </div>
    </section>

    <section id="game" class="container" style="padding-top: 4rem;">
        <h2 class="section-title">ğŸŒ» åŠ¨ä½œæ„Ÿåº”æ¼”ç¤º</h2>
        <p style="text-align: center; margin-bottom: 2rem; color: var(--text-muted);">
            æ— éœ€ç‰¹æ®Šè®¾å¤‡ï¼Œä½¿ç”¨æ‘„åƒå¤´å³å¯ä½“éªŒã€‚<br>æŒ¥åŠ¨æ‰‹è‡‚æ”¶é›†å±å¹•ä¸Šçš„å‘æ—¥è‘µï¼Œå°†å®ƒä»¬æ”¾å…¥å³ä¸‹è§’çš„ç¯®å­ï¼
        </p>

        <div class="game-wrapper">
            <video id="webcam" autoplay playsinline muted></video>
            <canvas id="gameCanvas"></canvas>
            <canvas id="motionCanvas"></canvas>

            <div class="game-ui">
                <div class="hud-top">
                    <div class="score-box">
                        <div class="score-label">å¾—åˆ†</div>
                        <div class="score-val" id="ui-score">0</div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">å‰©ä½™</div>
                        <div class="score-val" id="ui-left">0</div>
                    </div>
                    <div class="score-box">
                        <div class="score-label">è¿å‡»</div>
                        <div class="score-val" id="ui-combo" style="color: #F59E0B">x0</div>
                    </div>
                </div>
            </div>

            <div id="startOverlay" class="game-overlay">
                <h2>å‡†å¤‡å¥½äº†å—ï¼Ÿ</h2>
                <p>è¯·ç¡®ä¿ç¯å¢ƒå…‰çº¿å……è¶³ï¼Œå¹¶å…è®¸æµè§ˆå™¨ä½¿ç”¨æ‘„åƒå¤´ã€‚<br>ç«™åœ¨è·ç¦»å±å¹•çº¦ 1 ç±³å¤„ã€‚</p>
                <button class="start-btn" onclick="game.init()">å¯åŠ¨å¼•æ“</button>
            </div>
            
            <div id="endOverlay" class="game-overlay hidden">
                <h2>ä»»åŠ¡å®Œæˆï¼</h2>
                <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore" style="color: var(--primary); font-weight: bold;">0</span></p>
                <button class="start-btn" onclick="game.restart()">å†æ¥ä¸€æ¬¡</button>
            </div>
        </div>
    </section>

    <section id="about" class="container" style="padding: 6rem 2rem;">
        <h2 class="section-title">è‡´è°¢ä¸ç¤¾åŒº</h2>
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="card" style="background: rgba(255,255,255,0.03);">
                <h3>Yunzai-Bot V3</h3>
                <p>æ„Ÿè°¢ä¹ç¥ (Le-niao) æ„å»ºçš„åšå®åŸºç¡€ã€‚</p>
            </div>
            <div class="card" style="background: rgba(255,255,255,0.03);">
                <h3>Miao-Yunzai</h3>
                <p>æ„Ÿè°¢å–µå–µæä¾›çš„ä¼˜ç§€åŠŸèƒ½æ‰©å±•æ€è·¯ã€‚</p>
            </div>
            <div class="card" style="background: rgba(255,255,255,0.03);">
                <h3>TRSS-Yunzai</h3>
                <p>æ„Ÿè°¢æ—¶é›¨åœ¨å¤šå¹³å°é€‚é…ä¸Šçš„è´¡çŒ®ã€‚</p>
            </div>
        </div>
    </section>

    <footer>
        <div class="logo" style="justify-content: center; margin-bottom: 1rem;">
            <span>ğŸŒ»</span> XRK-AGT
        </div>
        <div class="footer-links">
            <a href="https://gitee.com/xrkseek" target="_blank">ä½œè€…ä¸»é¡µ</a>
            <a href="#">ä½¿ç”¨æ–‡æ¡£</a>
            <a href="#">åŠ å…¥ Q ç¾¤: 1056289662</a>
            <a href="#">æ”¯æŒæˆ‘ä»¬</a>
        </div>
        <p style="color: var(--text-muted); font-size: 0.9rem;">Â© 2024 XRK-AGT Team. Built for the future.</p>
    </footer>

    <script>
        /**
         * æ ¸å¿ƒæ¸¸æˆå¼•æ“ç±»
         * åŒ…å«ï¼šæ‘„åƒå¤´ç®¡ç†ã€ä¼˜åŒ–çš„åŠ¨ä½œæ£€æµ‹ç®—æ³•ã€ç‰©ç†æ¸²æŸ“å¾ªç¯
         */
        class MotionGame {
            constructor() {
                this.video = document.getElementById('webcam');
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // åŠ¨ä½œæ£€æµ‹ä¸“ç”¨çš„å°ç”»å¸ƒï¼ˆä½åˆ†è¾¨ç‡ä»¥æé«˜æ€§èƒ½ï¼‰
                this.mCanvas = document.getElementById('motionCanvas');
                this.mCtx = this.mCanvas.getContext('2d', { willReadFrequently: true });
                
                // æ¸¸æˆçŠ¶æ€
                this.width = 0;
                this.height = 0;
                this.isRunning = false;
                this.score = 0;
                this.combo = 0;
                this.comboTimer = null;
                
                // å®ä½“
                this.items = [];
                this.particles = [];
                this.hand = { x: 0, y: 0, targetX: 0, targetY: 0, radius: 60, active: false };
                this.basket = { x: 0, y: 0, w: 180, h: 140 };

                // åŠ¨ä½œæ£€æµ‹å‚æ•°
                this.prevFrame = null;
                this.blendFactor = 0.2; // åŠ¨ä½œå¹³æ»‘ç³»æ•° (Lerp)
                this.threshold = 25; // åƒç´ å˜åŒ–é˜ˆå€¼
                this.sampleStride = 4; // é‡‡æ ·æ­¥é•¿ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
            }

            async init() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: { ideal: 1280 }, height: { ideal: 720 }, facingMode: 'user' } 
                    });
                    this.video.srcObject = stream;
                    
                    // ç­‰å¾…è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆ
                    this.video.onloadedmetadata = () => {
                        this.resize();
                        document.getElementById('startOverlay').classList.add('hidden');
                        document.getElementById('endOverlay').classList.add('hidden');
                        this.startLevel();
                        this.isRunning = true;
                        this.loop();
                    };
                } catch (e) {
                    alert('æ— æ³•è®¿é—®æ‘„åƒå¤´ã€‚è¯·æ£€æŸ¥æƒé™è®¾ç½®æˆ–ä½¿ç”¨ HTTPS è®¿é—®ã€‚');
                    console.error(e);
                }
            }

            resize() {
                // è®¾ç½®æ˜¾ç¤ºç”»å¸ƒä¸ºå®¹å™¨å¤§å°
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.width = rect.width;
                this.height = rect.height;
                this.canvas.width = this.width;
                this.canvas.height = this.height;

                // è®¾ç½®è¿ç®—ç”»å¸ƒä¸ºä½åˆ†è¾¨ç‡ (ä¾‹å¦‚ 100xN)
                this.mWidth = 100;
                this.mHeight = Math.floor(this.mWidth * (this.height / this.width));
                this.mCanvas.width = this.mWidth;
                this.mCanvas.height = this.mHeight;

                // æ›´æ–°ç¯®å­ä½ç½® (å³ä¸‹è§’)
                this.basket.x = this.width - this.basket.w - 30;
                this.basket.y = this.height - this.basket.h - 20;
            }

            startLevel() {
                this.items = [];
                this.score = 0;
                this.combo = 0;
                this.updateUI();
                
                // ç”Ÿæˆå‘æ—¥è‘µ
                for(let i=0; i<15; i++) {
                    this.spawnItem();
                }
            }

            spawnItem() {
                this.items.push({
                    x: Math.random() * (this.width - 100) + 50,
                    y: Math.random() * (this.height * 0.4) + 50,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    size: 40 + Math.random() * 20,
                    rotation: Math.random() * Math.PI,
                    grabbed: false,
                    scale: 0, // å‡ºç°åŠ¨ç”»
                    targetScale: 1
                });
            }

            // æ ¸å¿ƒç®—æ³•ï¼šåŸºäºè´¨å¿ƒåŠ æƒçš„åŠ¨ä½œæ£€æµ‹
            detectMotion() {
                if (this.video.readyState !== 4) return;

                // 1. å°†è§†é¢‘å¸§ç»˜åˆ¶åˆ°ä½åˆ†ç”»å¸ƒ
                this.mCtx.drawImage(this.video, 0, 0, this.mWidth, this.mHeight);
                
                // 2. è·å–åƒç´ æ•°æ®
                const frame = this.mCtx.getImageData(0, 0, this.mWidth, this.mHeight);
                const length = frame.data.length;
                const data = frame.data;

                if (!this.prevFrame) {
                    this.prevFrame = data;
                    return;
                }

                let sumX = 0;
                let sumY = 0;
                let totalMovement = 0;

                // 3. éå†åƒç´  (ä½¿ç”¨æ­¥é•¿ä¼˜åŒ–)
                // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦é•œåƒç¿»è½¬Xåæ ‡é€»è¾‘ï¼Œå› ä¸ºç»˜åˆ¶çš„ç”»é¢å·²ç»è¢«CSSç¿»è½¬äº†ï¼Œ
                // ä½†Canvasæ•°æ®æ˜¯åŸå§‹çš„ã€‚ä¸ºäº†é€»è¾‘ç»Ÿä¸€ï¼Œæˆ‘ä»¬è®¡ç®—åŸå§‹åæ ‡ï¼Œæœ€ååœ¨æ¸²æŸ“å…‰æ ‡æ—¶å¤„ç†ã€‚
                for (let i = 0; i < length; i += 4 * this.sampleStride) {
                    const rDiff = Math.abs(data[i] - this.prevFrame[i]);
                    const gDiff = Math.abs(data[i+1] - this.prevFrame[i+1]);
                    const bDiff = Math.abs(data[i+2] - this.prevFrame[i+2]);
                    
                    if (rDiff + gDiff + bDiff > this.threshold * 3) {
                        const pixelIndex = i / 4;
                        const x = pixelIndex % this.mWidth;
                        const y = Math.floor(pixelIndex / this.mWidth);
                        
                        // ç´¯åŠ åæ ‡ä»¥è®¡ç®—è´¨å¿ƒ
                        // é‡è¦ï¼šè§†é¢‘æ˜¯é•œåƒçš„ï¼Œæ‰€ä»¥ X è½´éœ€è¦åè½¬è®¡ç®—
                        const mirroredX = this.mWidth - x - 1; 

                        sumX += mirroredX;
                        sumY += y;
                        totalMovement++;
                    }
                }

                // 4. è®¡ç®—å¹³å‡ä½ç½® (è´¨å¿ƒ)
                if (totalMovement > 10) { // åªæœ‰è¶³å¤Ÿçš„å™ªç‚¹æ‰è®¤ä¸ºæ˜¯åŠ¨ä½œ
                    const avgX = (sumX / totalMovement) * (this.width / this.mWidth);
                    const avgY = (sumY / totalMovement) * (this.height / this.mHeight);

                    this.hand.targetX = avgX;
                    this.hand.targetY = avgY;
                    this.hand.active = true;
                } else {
                    this.hand.active = false;
                }

                // 5. ä¿å­˜å½“å‰å¸§ç”¨äºä¸‹ä¸€å¸§å¯¹æ¯” (æ·±æ‹·è´)
                this.prevFrame = new Uint8ClampedArray(data);
            }

            update() {
                // å¹³æ»‘æ‰‹éƒ¨ç§»åŠ¨ (Lerp)
                if (this.hand.active) {
                    this.hand.x += (this.hand.targetX - this.hand.x) * this.blendFactor;
                    this.hand.y += (this.hand.targetY - this.hand.y) * this.blendFactor;
                }

                // ç‰©ç†æ›´æ–°
                this.items.forEach((item, index) => {
                    // å‡ºç°åŠ¨ç”»
                    if (item.scale < item.targetScale) item.scale += 0.05;

                    if (!item.grabbed) {
                        // æ¼‚æµ®
                        item.x += item.vx;
                        item.y += item.vy;
                        
                        // è¾¹ç•Œåå¼¹
                        if (item.x < item.size || item.x > this.width - item.size) item.vx *= -1;
                        if (item.y < item.size || item.y > this.height - item.size) item.vy *= -1;

                        // æŠ“å–æ£€æµ‹
                        if (this.hand.active) {
                            const dx = this.hand.x - item.x;
                            const dy = this.hand.y - item.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            if (dist < this.hand.radius + item.size) {
                                item.grabbed = true;
                                this.createParticles(item.x, item.y, '#FFD700', 5);
                            }
                        }
                    } else {
                        // è·Ÿéšæ‰‹éƒ¨
                        const dx = this.hand.x - item.x;
                        const dy = this.hand.y - item.y;
                        item.x += dx * 0.15; // ç¨å¾®æœ‰ç‚¹å»¶è¿Ÿæ„Ÿï¼Œæ„Ÿè§‰æ›´æœ‰é‡é‡
                        item.y += dy * 0.15;

                        // ç¯®å­æ£€æµ‹
                        if (item.x > this.basket.x && item.y > this.basket.y) {
                            this.collectItem(index);
                        }
                        
                        // å¦‚æœæ‰‹éƒ¨æ¶ˆå¤±ï¼ˆåœæ­¢è¿åŠ¨ï¼‰ï¼Œç‰©å“æ‰è½
                        if (!this.hand.active) {
                            item.grabbed = false;
                        }
                    }
                });

                // ç²’å­æ›´æ–°
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    let p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 0.02;
                    if (p.life <= 0) this.particles.splice(i, 1);
                }

                // èƒœåˆ©æ£€æµ‹
                if (this.items.length === 0 && this.particles.length === 0) {
                    this.gameOver();
                }
            }

            collectItem(index) {
                const item = this.items[index];
                this.items.splice(index, 1);
                
                // å¾—åˆ†é€»è¾‘
                this.score += 10 + (this.combo * 2);
                this.combo++;
                this.createParticles(item.x, item.y, '#7C3AED', 15); // ç´«è‰²çˆ†ç‚¸
                
                // è¿å‡»é‡ç½®è®¡æ—¶å™¨
                if (this.comboTimer) clearTimeout(this.comboTimer);
                this.comboTimer = setTimeout(() => { this.combo = 0; this.updateUI(); }, 2000);

                this.updateUI();
            }

            createParticles(x, y, color, count) {
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 4 + 1;
                    this.particles.push({
                        x: x, y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        color: color,
                        life: 1.0,
                        size: Math.random() * 4 + 2
                    });
                }
            }

            draw() {
                this.ctx.clearRect(0, 0, this.width, this.height);

                // ç»˜åˆ¶ç¯®å­
                this.ctx.save();
                this.ctx.fillStyle = 'rgba(20, 20, 30, 0.6)';
                this.ctx.strokeStyle = '#7C3AED';
                this.ctx.lineWidth = 3;
                this.ctx.shadowColor = '#7C3AED';
                this.ctx.shadowBlur = 15;
                this.ctx.beginPath();
                this.ctx.roundRect(this.basket.x, this.basket.y, this.basket.w, this.basket.h, 20);
                this.ctx.fill();
                this.ctx.stroke();
                this.ctx.fillStyle = '#fff';
                this.ctx.font = '40px Arial';
                this.ctx.fillText('ğŸ§º', this.basket.x + this.basket.w/2 - 20, this.basket.y + this.basket.h/2 + 10);
                this.ctx.restore();

                // ç»˜åˆ¶å‘æ—¥è‘µ
                this.ctx.font = '40px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.items.forEach(item => {
                    this.ctx.save();
                    this.ctx.translate(item.x, item.y);
                    this.ctx.scale(item.scale, item.scale);
                    if (item.grabbed) {
                        this.ctx.scale(1.2, 1.2); // æŠ“å–æ—¶å˜å¤§
                        this.ctx.shadowColor = '#FFD700';
                        this.ctx.shadowBlur = 20;
                    }
                    this.ctx.fillText('ğŸŒ»', 0, 0);
                    this.ctx.restore();
                });

                // ç»˜åˆ¶ç²’å­
                this.particles.forEach(p => {
                    this.ctx.globalAlpha = p.life;
                    this.ctx.fillStyle = p.color;
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                this.ctx.globalAlpha = 1;

                // ç»˜åˆ¶æ‰‹éƒ¨å…‰æ ‡
                if (this.hand.active) {
                    this.ctx.save();
                    this.ctx.beginPath();
                    this.ctx.arc(this.hand.x, this.hand.y, 40, 0, Math.PI * 2);
                    this.ctx.strokeStyle = 'rgba(255, 215, 0, 0.8)';
                    this.ctx.lineWidth = 4;
                    this.ctx.stroke();
                    
                    // å†…éƒ¨å…‰æ™•
                    const gradient = this.ctx.createRadialGradient(this.hand.x, this.hand.y, 10, this.hand.x, this.hand.y, 40);
                    gradient.addColorStop(0, 'rgba(255, 215, 0, 0.4)');
                    gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');
                    this.ctx.fillStyle = gradient;
                    this.ctx.fill();
                    this.ctx.restore();
                }
            }

            updateUI() {
                document.getElementById('ui-score').innerText = this.score;
                document.getElementById('ui-left').innerText = this.items.length;
                const comboEl = document.getElementById('ui-combo');
                comboEl.innerText = 'x' + this.combo;
                comboEl.style.transform = this.combo > 1 ? 'scale(1.5)' : 'scale(1)';
                comboEl.style.transition = 'transform 0.1s';
            }

            gameOver() {
                this.isRunning = false;
                document.getElementById('finalScore').innerText = this.score;
                document.getElementById('endOverlay').classList.remove('hidden');
            }

            restart() {
                document.getElementById('endOverlay').classList.add('hidden');
                this.startLevel();
                this.isRunning = true;
                this.loop();
            }

            loop() {
                if (!this.isRunning) return;
                this.detectMotion(); // è®¡ç®—åŠ¨ä½œ
                this.update();       // æ›´æ–°ç‰©ç†
                this.draw();         // æ¸²æŸ“ç”»é¢
                requestAnimationFrame(() => this.loop());
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆå®ä¾‹
        const game = new MotionGame();
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            if (game.isRunning) game.resize();
        });

        // å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>